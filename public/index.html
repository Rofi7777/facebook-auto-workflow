<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Platform Baby Toy Content Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        /* èªè¨€åˆ‡æ›å™¨æ¨£å¼ */
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .language-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .language-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .language-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.4);
        }
        
        .language-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            min-width: 180px;
            z-index: 1000;
        }
        
        .language-menu.active {
            display: block;
        }
        
        .language-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-option:hover {
            background: #f0f8ff;
        }
        
        .language-option.active {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .header p {
            color: #666;
            font-size: 18px;
        }
        
        /* åˆ†é åˆ‡æ›æ¨£å¼ */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #87CEEB;
            background: white;
            color: #87CEEB;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.3);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border-color: transparent;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .workflow-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-panel, .output-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .panel-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input:not([type="checkbox"]):not([type="radio"]),
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #87CEEB;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 10px;
            width: 100%;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 60px;
            box-sizing: border-box;
            width: 100%;
        }
        
        .checkbox-item label {
            flex: 1;
            font-size: 14px;
            cursor: pointer;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            display: block;
            width: 100%;
        }
        
        .checkbox-item:hover {
            border-color: #87CEEB;
            background: #f8f9fa;
        }
        
        .checkbox-item input[type="radio"],
        .checkbox-item input[type="checkbox"] {
            width: auto;
            flex: 0 0 auto;
            margin: 0;
        }
        
        .file-upload {
            border: 2px dashed #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s;
            cursor: pointer;
        }
        
        .file-upload:hover {
            border-color: #87CEEB;
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .image-preview-container {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .image-preview-container.show {
            display: block;
        }
        
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            border: 2px solid #e1e5e9;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        
        .image-preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview-item .remove-btn:hover {
            background: rgba(255, 0, 0, 1);
        }
        
        .selected-count {
            margin-top: 10px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #87CEEB;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-container {
            display: none;
            margin-top: 30px;
        }
        
        .platform-result {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .platform-result h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .platform-result .content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }
        
        .platform-result .hashtags {
            color: #007bff;
            font-weight: 500;
        }
        
        .hashtags-bilingual {
            margin-top: 15px;
            color: #1976d2;
            font-size: 0.9em;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .bilingual-content .language-section {
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #e0e0e0;
            background: #fafafa;
            border-radius: 0 8px 8px 0;
        }
        
        .bilingual-analysis {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .bilingual-analysis .language-section {
            padding: 8px;
            margin: 4px 0;
            border-left: 3px solid #e0e0e0;
            background: #ffffff;
            border-radius: 0 6px 6px 0;
        }
        
        .platform-result .image-preview {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .analysis-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .analysis-section h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .pain-point, .scenario {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid #87CEEB;
        }
        
        /* å°è©±è¦–çª—æ¨£å¼ */
        .chat-advisor-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-top: 20px;
            display: none;
        }
        
        .chat-advisor-container.active {
            display: block;
        }
        
        .chat-header {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e5e9;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .chat-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        
        .chat-message.user {
            flex-direction: row-reverse;
        }
        
        .chat-message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            line-height: 1.5;
        }
        
        .chat-message.ai .chat-message-content {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
        }
        
        .chat-message.user .chat-message-content {
            background: white;
            color: #333;
            border: 2px solid #e1e5e9;
        }
        
        .chat-message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .chat-message.ai .chat-message-avatar {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
        }
        
        .chat-message.user .chat-message-avatar {
            background: #e1e5e9;
        }
        
        .suggested-questions {
            margin-bottom: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }
        
        .suggested-questions h4 {
            margin-bottom: 10px;
            color: #856404;
            font-size: 14px;
        }
        
        .suggested-question-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #ffc107;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #856404;
        }
        
        .suggested-question-btn:hover {
            background: #ffc107;
            color: white;
            transform: translateX(5px);
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .chat-input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            padding: 12px 100px 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 14px;
            resize: none;
            font-family: inherit;
            max-height: 100px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #87CEEB;
        }
        
        .chat-file-upload-btn {
            position: absolute;
            right: 50px;
            bottom: 8px;
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .chat-file-upload-btn:hover {
            background: #87CEEB;
            color: white;
        }
        
        .chat-send-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.4);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .chat-file-preview {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .chat-file-item {
            background: #f0f0f0;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .chat-file-remove {
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        
        .chat-file-remove:hover {
            color: #ff4444;
        }
        
        @media (max-width: 768px) {
            .workflow-container {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .checkbox-item {
                min-height: 70px;
                padding: 12px;
            }
            
            .checkbox-item label {
                font-size: 13px;
                line-height: 1.3;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <!-- èªè¨€åˆ‡æ›å™¨ -->
            <div class="language-switcher">
                <div class="language-dropdown">
                    <button class="language-btn" onclick="toggleLanguageMenu()">
                        ğŸŒ <span id="currentLanguageDisplay">ç¹é«”ä¸­æ–‡</span> â–¼
                    </button>
                    <div class="language-menu" id="languageMenu">
                        <div class="language-option active" onclick="selectLanguage('zh-TW')">
                            ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡
                        </div>
                        <div class="language-option" onclick="selectLanguage('en')">
                            ğŸ‡¬ğŸ‡§ English
                        </div>
                        <div class="language-option" onclick="selectLanguage('vi')">
                            ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t
                        </div>
                    </div>
                </div>
            </div>
            
            <img id="brandLogo" src="" alt="Brand Logo" style="max-height: 120px; margin-bottom: 15px; border-radius: 10px; display: none;">
            <h1 id="brandTitle" data-i18n="app_title">ğŸ§¸ Googoogaga Multi-Platform Generator</h1>
            <p id="brandSlogan" data-i18n="app_subtitle_line1">CÃ¹ng bÃ© khÃ¡m phÃ¡ tháº¿ giá»›i diá»‡u ká»³ má»—i ngÃ y</p>
            <p data-i18n="app_subtitle_line2">AI é©…å‹•çš„å¤šå¹³å°å¬°å¹¼å…’ç©å…·è¡ŒéŠ·å…§å®¹ç”Ÿæˆå™¨</p>
            
            <!-- åˆ†é åˆ‡æ›å°èˆª -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchPage('page1')">
                    <span data-i18n="tab_image_generation">ğŸ¨ AI åœ–ç‰‡ç”Ÿæˆ</span>
                </button>
                <button class="tab-btn" onclick="switchPage('page2')">
                    <span data-i18n="tab_ads_advisor">ğŸ“Š AI å»£å‘Šé¡§å•</span>
                </button>
                <button class="tab-btn" onclick="switchPage('page3')">
                    <span data-i18n="tab_course_editor">ğŸ“š AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶</span>
                </button>
            </div>
        </div>
        
        <!-- Page 1: AI åœ–ç‰‡ç”Ÿæˆ -->
        <div id="page1" class="page-content active">
        <div class="workflow-container">
            <div class="input-panel">
                <h2 class="panel-title">ğŸ“ <span data-i18n="product_info_input">ç”¢å“è³‡è¨Šè¼¸å…¥</span></h2>
                
                <form id="productForm">
                    <div class="form-group">
                        <label for="industryCategory" data-i18n="industry_category">ç”¢æ¥­é¡åˆ¥ / Industry Category</label>
                        <select id="industryCategory" name="industryCategory" required>
                            <option value="mother-kids" data-i18n="industry_mother_kids">ğŸ‘¶ Mother & Kids (æ¯å¬°ç”¨å“)</option>
                            <option value="fashion" data-i18n="industry_fashion">ğŸ‘— Fashion (æ™‚å°šæœé£¾)</option>
                            <option value="art-toy" data-i18n="industry_art_toy">ğŸ¨ Art Toy (è—è¡“ç©å…·)</option>
                            <option value="others" data-i18n="industry_others">âœ¨ Others (å…¶ä»–)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productName" data-i18n="product_name">ç”¢å“åç¨± / Product Name</label>
                        <input type="text" id="productName" name="productName" data-i18n-placeholder="product_name_placeholder" placeholder="è¼¸å…¥ç”¢å“åç¨±" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription" data-i18n="product_description">ç”¢å“æè¿° (å¯é¸)</label>
                        <textarea id="productDescription" name="productDescription" data-i18n-placeholder="product_description_placeholder" placeholder="æè¿°ç”¢å“ç‰¹è‰²ã€åŠŸèƒ½ã€é©ç”¨å¹´é½¡ç­‰..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="image_upload">ç”¢å“åœ–ç‰‡ / Product Image (æ”¯æŒ1-5å¼µåœ–ç‰‡åŒæ™‚ä¸Šå‚³)</label>
                        <div class="file-upload" onclick="document.getElementById('imageUpload').click()">
                            <input type="file" id="imageUpload" accept="image/*" multiple>
                            <p data-i18n="image_upload_text">ğŸ“¸ ä¸Šå‚³ç©å…·åœ–ç‰‡ (Upload toy images - æœ€å¤š5å¼µ)</p>
                            <small data-i18n="image_upload_hint">æ”¯æ´ JPG, PNG (æ¯å¼µæœ€å¤§ 10MBï¼Œæœ€å¤š5å¼µåœ–ç‰‡)</small>
                        </div>
                        <div id="imagePreviewContainer" class="image-preview-container"></div>
                        <div id="selectedImageCount" class="selected-count" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="target_platform">ç›®æ¨™å¹³å° / Target Platforms</label>
                        <div class="checkbox-group" id="platformsGroup">
                            <!-- Platforms will be loaded dynamically -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="language">å…§å®¹èªè¨€ / Content Language</label>
                        <select id="language" name="language">
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡ (Traditional Chinese)</option>
                            <option value="vi">Tiáº¿ng Viá»‡t (Vietnamese)</option>
                            <option value="bilingual">é›™èª (Bilingual)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="generateImages" name="generateImages" onchange="toggleScenarioOptions()">
                            <span data-i18n="generate_image_checkbox">è‡ªå‹•ç”Ÿæˆè¡ŒéŠ·åœ–ç‰‡ (Generate Marketing Images)</span>
                        </label>
                    </div>
                    
                    <!-- æ¨¡ç‰¹å…’å’Œå ´æ™¯è¨­å®šé¸é … -->
                    <div class="form-group" id="modelSceneOptionsGroup" style="display: none;">
                        <h4 style="color: #FF6B4A; margin-bottom: 15px;">ğŸ‘¥ <span data-i18n="model_settings">æ¨¡ç‰¹å…’è¨­å®š</span></h4>
                        
                        <div class="form-group">
                            <label for="modelNationality" data-i18n="model_nationality">æ¨¡ç‰¹å…’åœ‹ç±</label>
                            <select id="modelNationality" name="modelNationality">
                                <option value="taiwan" data-i18n="nationality_taiwan">å°ç£</option>
                                <option value="usa" data-i18n="nationality_usa">ç¾åœ‹</option>
                                <option value="russia" data-i18n="nationality_russia">ä¿„ç¾…æ–¯</option>
                                <option value="brazil" data-i18n="nationality_brazil">å·´è¥¿</option>
                                <option value="custom" data-i18n="nationality_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customNationalityInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customNationalityText" placeholder="è«‹è¼¸å…¥æ¨¡ç‰¹å…’åœ‹ç±æˆ–ç¨®æ—æè¿° (ä¾‹å¦‚: æ—¥æœ¬ã€éŸ“åœ‹ã€æ··è¡€ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_nationality_placeholder">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modelCombination" data-i18n="model_combination">äººç‰©çµ„åˆ</label>
                            <select id="modelCombination" name="modelCombination">
                                <option value="parents_baby" data-i18n="combination_parents_baby">çˆ¸åª½èˆ‡å¬°å…’</option>
                                <option value="mom_baby" data-i18n="combination_mom_baby">åª½åª½èˆ‡å¬°å…’</option>
                                <option value="dad_baby" data-i18n="combination_dad_baby">çˆ¸çˆ¸èˆ‡å¬°å…’</option>
                                <option value="couple" data-i18n="combination_couple">å¤«å¦»</option>
                                <option value="custom" data-i18n="combination_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customCombinationInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customCombinationText" placeholder="è«‹è¼¸å…¥äººç‰©çµ„åˆæè¿° (ä¾‹å¦‚: ç¥–çˆ¶æ¯èˆ‡å­«å­ã€ä¸‰ä»£åŒå ‚ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_combination_placeholder">
                            </div>
                        </div>
                        
                        <h4 style="color: #4ECDC4; margin-top: 20px; margin-bottom: 15px;">ğŸŒ <span data-i18n="scene_settings">å ´æ™¯è¨­å®š</span></h4>
                        
                        <div class="form-group">
                            <label for="sceneLocation" data-i18n="scene_location">å ´æ™¯åœ°é»</label>
                            <select id="sceneLocation" name="sceneLocation">
                                <option value="city" data-i18n="location_city">åŸå¸‚</option>
                                <option value="beach" data-i18n="location_beach">æµ·é‚Š</option>
                                <option value="mountain" data-i18n="location_mountain">å±±å€</option>
                                <option value="park" data-i18n="location_park">å…¬åœ’</option>
                                <option value="custom" data-i18n="location_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customLocationInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customLocationText" placeholder="è«‹è¼¸å…¥å ´æ™¯åœ°é»æè¿° (ä¾‹å¦‚: å’–å•¡å»³ã€éŠæ¨‚å ´ã€æ£®æ—ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_location_placeholder">
                            </div>
                        </div>
                    </div>
                    
                    <!-- å ´æ™¯é¸æ“‡é¸é … -->
                    <div class="form-group" id="scenarioOptionsGroup" style="display: none;">
                        <label data-i18n="usage_scenario_selection">ä½¿ç”¨å ´æ™¯é¸æ“‡ / Usage Scenario Selection</label>
                        <div class="checkbox-group" id="scenarioGroup">
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_parent_child" name="scenarioType" value="è¦ªå­äº’å‹•" checked>
                                <label for="scenario_parent_child">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ <span data-i18n="scenario_parent_child">è¦ªå­äº’å‹• (Parent-Child Interaction)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_child_solo" name="scenarioType" value="å°å­©å–®äººä½¿ç”¨">
                                <label for="scenario_child_solo">ğŸ§’ <span data-i18n="scenario_child_solo">å°å­©å–®äººä½¿ç”¨ (Child Solo Play)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_outdoor_travel" name="scenarioType" value="å¤–å‡ºæ—…éŠ">
                                <label for="scenario_outdoor_travel">ğŸŒ <span data-i18n="scenario_outdoor_travel">å¤–å‡ºæ—…éŠ (Outdoor Travel)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_home_play" name="scenarioType" value="å±…å®¶éŠæˆ²">
                                <label for="scenario_home_play">ğŸ  <span data-i18n="scenario_home_play">å±…å®¶éŠæˆ² (Home Play)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_personal_styling" name="scenarioType" value="å€‹äººç©¿æ­">
                                <label for="scenario_personal_styling">ğŸ‘” <span data-i18n="scenario_personal_styling">å€‹äººç©¿æ­ (Personal Styling)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_office_home_decor" name="scenarioType" value="è¾¦å…¬å®¤/å±…å®¶ä½ˆç½®">
                                <label for="scenario_office_home_decor">ğŸ¢ <span data-i18n="scenario_office_home_decor">è¾¦å…¬å®¤/å±…å®¶ä½ˆç½® (Office/Home Decoration)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_other" name="scenarioType" value="å…¶ä»–">
                                <label for="scenario_other">âœ¨ <span data-i18n="scenario_other">å…¶ä»– (Other Creative)</span></label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" id="analyzeBtn">
                        ğŸ§  <span data-i18n="analyze_generate_button">åˆ†æç”¢å“ä¸¦ç”Ÿæˆå…§å®¹</span>
                    </button>
                    
                    <button type="button" class="btn" id="switchScenarioBtn" style="display: none; background: #28a745;">
                        ğŸ”„ <span data-i18n="switch_scenario_button">åˆ‡æ›å ´æ™¯é‡æ–°ç”Ÿæˆ (åŒç”¢å“ä¸åŒå¹³å°)</span>
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="generateScenariosBtn" style="display: none;">
                        ğŸ¬ <span data-i18n="generate_scenarios_button">ç”Ÿæˆè¡ŒéŠ·å ´æ™¯</span>
                    </button>
                </form>
                
                <div id="status" class="status"></div>
            </div>
            
            <div class="output-panel">
                <h2 class="panel-title">ğŸ“Š <span data-i18n="ai_analysis_result">AI åˆ†æçµæœ</span></h2>
                <div id="analysisResults">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        ä¸Šå‚³ç”¢å“åœ–ç‰‡ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                    </p>
                </div>
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px;">
                <h2 class="panel-title">ğŸ¯ å¤šå¹³å°å…§å®¹ç”Ÿæˆçµæœ</h2>
                <div id="platformResults"></div>
            </div>
        </div>
        
        <div class="scenarios-container" id="scenariosContainer" style="display: none;">
            <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; margin-top: 30px;">
                <h2 class="panel-title">ğŸ¬ AI ç”Ÿæˆè¡ŒéŠ·å ´æ™¯</h2>
                <div id="scenarioResults"></div>
            </div>
        </div>
        </div>
        <!-- End of Page 1 -->

        <!-- Page 2: AI å»£å‘Šé¡§å• -->
        <div id="page2" class="page-content">
            <div class="workflow-container">
                <!-- å·¦å´ï¼šè³‡æ–™è¼¸å…¥å€ -->
                <div class="input-panel">
                    <h2 class="panel-title">ğŸ“¤ <span data-i18n="data_input_area">è³‡æ–™è¼¸å…¥å€</span></h2>
                    
                    <form id="adsAnalysisForm">
                        <div class="form-group">
                            <label for="brandName" data-i18n="brand_name">å“ç‰Œåç¨± / Brand Name (é¸å¡«)</label>
                            <input type="text" id="brandName" name="brandName" data-i18n-placeholder="brand_name_placeholder" placeholder="è¼¸å…¥å“ç‰Œåç¨±">
                        </div>
                        
                        <div class="form-group">
                            <label for="adProductName" data-i18n="product_name_optional">ç”¢å“åç¨± / Product Name (é¸å¡«)</label>
                            <input type="text" id="adProductName" name="adProductName" data-i18n-placeholder="product_name_optional_placeholder" placeholder="è¼¸å…¥ç”¢å“åç¨±">
                        </div>
                        
                        <div class="form-group">
                            <label for="coreProduct" data-i18n="core_product">æ ¸å¿ƒç”¢å“ / Core Product (é¸å¡«)</label>
                            <textarea id="coreProduct" name="coreProduct" data-i18n-placeholder="core_product_placeholder" placeholder="æè¿°æ ¸å¿ƒç”¢å“ç‰¹è‰²..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="targetMarket" data-i18n="target_market">ç›®æ¨™èˆ‡å¸‚å ´ / Target Market (é¸å¡«)</label>
                            <textarea id="targetMarket" name="targetMarket" data-i18n-placeholder="target_market_placeholder" placeholder="æè¿°ç›®æ¨™å®¢ç¾¤èˆ‡å¸‚å ´å®šä½..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="file_upload">æª”æ¡ˆä¸Šå‚³ / File Upload (é¸å¡«ï¼Œæ”¯æ´ 1-10 å€‹æª”æ¡ˆ)</label>
                            <div class="file-upload" onclick="document.getElementById('adsFileUpload').click()">
                                <input type="file" id="adsFileUpload" accept="image/*,.pdf,.xlsx,.xls,.doc,.docx,.csv" multiple>
                                <p data-i18n="file_upload_text">ğŸ“ ä¸Šå‚³å»£å‘Šè³‡æ–™æª”æ¡ˆ</p>
                                <small data-i18n="file_upload_hint">æ”¯æ´ Image, PDF, Excel, Word, CSV (æ¯å€‹æª”æ¡ˆæœ€å¤§ 10MBï¼Œæœ€å¤š10å€‹æª”æ¡ˆ)</small>
                            </div>
                            <div id="adsFilePreviewContainer" class="image-preview-container"></div>
                            <div id="selectedAdsFileCount" class="selected-count" style="display: none;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="platform_selection">å¹³å°å‹¾é¸ / Platform Selection</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_tiktok" name="adsPlatform" value="TikTok">
                                    <label for="platform_tiktok" data-i18n="platform_tiktok">ğŸ“± TikTok Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_shopee" name="adsPlatform" value="Shopee">
                                    <label for="platform_shopee" data-i18n="platform_shopee">ğŸ›ï¸ Shopee Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_meta" name="adsPlatform" value="Meta">
                                    <label for="platform_meta" data-i18n="platform_meta">ğŸ‘¥ Meta Ads (Facebook/Instagram)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_zalo" name="adsPlatform" value="Zalo">
                                    <label for="platform_zalo" data-i18n="platform_zalo">ğŸ’¬ Zalo Ads</label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn" id="analyzeAdsBtn">
                            ğŸ§  <span data-i18n="start_analysis">é–‹å§‹åˆ†æ (Start Analysis)</span>
                        </button>
                    </form>
                    
                    <div id="adsStatus" class="status"></div>
                    
                    <!-- AI å»£å‘Šé¡§å•å°è©±è¦–çª— -->
                    <div class="chat-advisor-container" id="chatAdvisorContainer">
                        <div class="chat-header">
                            ğŸ’¬ <span data-i18n="chat_advisor_title">AI å»£å‘Šé¡§å•å°è©±</span>
                        </div>
                        
                        <!-- å»ºè­°å•é¡Œå€ -->
                        <div class="suggested-questions" id="suggestedQuestions" style="display: none;">
                            <h4 data-i18n="ai_suggested_questions">AI å»ºè­°çš„å•é¡Œï¼š</h4>
                            <div id="suggestedQuestionsList"></div>
                        </div>
                        
                        <!-- å°è©±è¨Šæ¯å€ -->
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message ai">
                                <div class="chat-message-avatar">ğŸ¤–</div>
                                <div class="chat-message-content">
                                    æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI å»£å‘Šé¡§å•ã€‚å®Œæˆå»£å‘Šåˆ†æå¾Œï¼Œæˆ‘æœƒç‚ºæ‚¨æä¾›ä¸‰å€‹å°ˆæ¥­å•é¡Œå¹«åŠ©æ‚¨æ·±å…¥æ€è€ƒï¼Œæ‚¨ä¹Ÿå¯ä»¥éš¨æ™‚å‘æˆ‘æå•æˆ–ä¸Šå‚³æ›´å¤šè³‡æ–™é€²è¡Œåˆ†æã€‚
                                </div>
                            </div>
                        </div>
                        
                        <!-- å°è©±è¼¸å…¥å€ -->
                        <div class="chat-input-area">
                            <div class="chat-input-wrapper">
                                <div class="chat-file-preview" id="chatFilePreview"></div>
                                <textarea 
                                    class="chat-input" 
                                    id="chatInput" 
                                    placeholder="è¼¸å…¥æ‚¨çš„å•é¡Œ..." 
                                    rows="1"
                                    data-i18n-placeholder="chat_placeholder"
                                ></textarea>
                                <input type="file" id="chatFileUpload" accept="image/*,.pdf,.xlsx,.xls,.doc,.docx,.csv" multiple style="display: none;">
                                <button class="chat-file-upload-btn" onclick="document.getElementById('chatFileUpload').click()" title="ä¸Šå‚³æª”æ¡ˆ">
                                    ğŸ“
                                </button>
                            </div>
                            <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
                                â¤
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å³å´ï¼šAI åˆ†æçµæœå€ -->
                <div class="output-panel">
                    <h2 class="panel-title">ğŸ¤– <span data-i18n="ai_analysis_results_area">AI åˆ†æçµæœå€</span></h2>
                    <div id="adsAnalysisResults">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            ä¸Šå‚³å»£å‘Šè³‡æ–™ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                        </p>
                    </div>
                    
                    <!-- å ±å‘Šæ“ä½œæŒ‰éˆ• -->
                    <div id="reportActions" style="display: none; margin-top: 20px; text-align: center; gap: 10px;">
                        <button class="btn" onclick="exportPDF()" style="background: #28a745;">
                            ğŸ“„ åŒ¯å‡º PDF
                        </button>
                        <button class="btn btn-secondary" onclick="reanalyze()">
                            ğŸ”„ é‡æ–°åˆ†æ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Page 2 -->

        <!-- Page 3: AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶ -->
        <div id="page3" class="page-content">
            <div class="workflow-container">
                <!-- å·¦å´ï¼šèª²ç¨‹åƒæ•¸è¨­å®š -->
                <div class="input-panel">
                    <h2 class="panel-title">ğŸ“š <span data-i18n="course_parameters">èª²ç¨‹åƒæ•¸è¨­å®š</span></h2>
                    
                    <form id="courseForm">
                        <!-- 1. è½è€…å¹´é½¡ -->
                        <div class="form-group">
                            <label for="targetAge" data-i18n="target_age">è½è€…å¹´é½¡ / Target Age</label>
                            <select id="targetAge" name="targetAge" onchange="handleAgeChange()" required>
                                <option value="3-5">3-5 æ­²</option>
                                <option value="6-8">6-8 æ­²</option>
                                <option value="9-11">9-11 æ­²</option>
                                <option value="12-14">12-14 æ­²</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="number" id="customAgeText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥å¹´é½¡æ•¸å­—" min="1" max="18">
                        </div>

                        <!-- 2. ç§‘åˆ¥ -->
                        <div class="form-group">
                            <label for="category" data-i18n="category">ç§‘åˆ¥ / Category</label>
                            <select id="category" name="category" onchange="updateTopicOptions(); handleCategoryChange()" required>
                                <option value="social">ç¤¾æœƒ Social</option>
                                <option value="science">è‡ªç„¶ Science</option>
                                <option value="math">æ•¸å­¸ Math</option>
                                <option value="language">èªæ–‡ Language</option>
                                <option value="art">è—è¡“ Art</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customCategoryText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©ç§‘åˆ¥">
                        </div>

                        <!-- 3. ä¸»é¡Œ -->
                        <div class="form-group">
                            <label for="topic" data-i18n="topic">ä¸»é¡Œ / Topic</label>
                            <select id="topic" name="topic" onchange="handleTopicChange()" required>
                                <option value="å®¶åº­">å®¶åº­</option>
                                <option value="äº¤é€šå·¥å…·">äº¤é€šå·¥å…·</option>
                                <option value="ç¤¾æœƒè§’è‰²">ç¤¾æœƒè§’è‰²</option>
                                <option value="æ–‡åŒ–ç¯€æ—¥">æ–‡åŒ–ç¯€æ—¥</option>
                                <option value="å®‰å…¨æ•™è‚²">å®‰å…¨æ•™è‚²</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customTopicText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©ä¸»é¡Œ">
                        </div>

                        <!-- 4. èª²ç¨‹æ™‚é–“ -->
                        <div class="form-group">
                            <label for="duration" data-i18n="duration">èª²ç¨‹æ™‚é–“ / Duration (minutes)</label>
                            <select id="duration" name="duration" onchange="handleDurationChange()" required>
                                <option value="30">30 åˆ†é˜</option>
                                <option value="60">60 åˆ†é˜</option>
                                <option value="90">90 åˆ†é˜</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="number" id="customDurationText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥æ™‚é–“ (åˆ†é˜)" min="10" max="240">
                        </div>

                        <!-- 5. èª²ç¶±ç·¨æ’é¢¨æ ¼ -->
                        <div class="form-group">
                            <label for="style" data-i18n="style">èª²ç¶±ç·¨æ’é¢¨æ ¼ / Style</label>
                            <select id="style" name="style" onchange="handleStyleChange()" required>
                                <option value="story-based">æ•…äº‹å¼•å°å¼ Story-based</option>
                                <option value="picture-book">æ’ç•«ç¹ªæœ¬é¢¨ Picture-book</option>
                                <option value="singapore-style">æ€è¾¨å¼ Singapore-style</option>
                                <option value="gamified">éŠæˆ²åŒ– Gamified</option>
                                <option value="montessori">Montessori è’™å¼</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customStyleText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©é¢¨æ ¼">
                        </div>

                        <!-- 6. è¼¸å‡ºæ ¼å¼ (å¤šé¸) -->
                        <div class="form-group">
                            <label data-i18n="output_types">è¼¸å‡ºæ ¼å¼ / Output Types (å¯å¤šé¸)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outline" name="outputTypes" value="outline" checked>
                                    <label for="outline">ğŸ“‹ èª²ç¶± Outline</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="lessonPlan" name="outputTypes" value="lessonPlan">
                                    <label for="lessonPlan">ğŸ“ æ•™æ¡ˆ Lesson Plan</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="story" name="outputTypes" value="story">
                                    <label for="story">ğŸ“– æ•…äº‹ Story-based Content</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="worksheet" name="outputTypes" value="worksheet">
                                    <label for="worksheet">âœï¸ Worksheet ç·´ç¿’é¡Œ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="slides" name="outputTypes" value="slides">
                                    <label for="slides">ğŸ–¼ï¸ Slides (PPT Script)</label>
                                </div>
                            </div>
                        </div>

                        <!-- 7. èªè¨€ -->
                        <div class="form-group">
                            <label for="courseLanguage" data-i18n="course_language">èªè¨€ / Language</label>
                            <select id="courseLanguage" name="courseLanguage" required>
                                <option value="chinese">ä¸­æ–‡ Chinese</option>
                                <option value="english">è‹±æ–‡ English</option>
                                <option value="vietnamese">è¶Šæ–‡ Vietnamese</option>
                                <option value="chinese-english">ä¸­è‹±é›™èª Chinese-English</option>
                                <option value="english-vietnamese">è‹±è¶Šé›™èª English-Vietnamese</option>
                                <option value="trilingual">ä¸‰èªç‰ˆ Trilingual (ä¸­è‹±è¶Š)</option>
                            </select>
                        </div>

                        <!-- 8. æ˜¯å¦è¦åœ–ç‰‡ -->
                        <div class="form-group">
                            <label for="includeImages" data-i18n="include_images">æ˜¯å¦è¦åœ–ç‰‡ / Include Images</label>
                            <select id="includeImages" name="includeImages" required>
                                <option value="yes">æ˜¯ Yes (ä½¿ç”¨ Nano Banana)</option>
                                <option value="no" selected>å¦ No</option>
                            </select>
                        </div>

                        <!-- ç”ŸæˆæŒ‰éˆ• -->
                        <button type="button" class="btn" id="generateCourseBtn" onclick="generateCourse()">
                            ğŸ“ ç”Ÿæˆèª²ç¨‹ Generate Course
                        </button>
                    </form>
                </div>

                <!-- å³å´ï¼šèª²ç¨‹é è¦½èˆ‡ä¸‹è¼‰ -->
                <div class="output-panel">
                    <h2 class="panel-title">ğŸ“– <span data-i18n="course_preview">èª²ç¨‹å…§å®¹é è¦½</span></h2>
                    
                    <div id="coursePreview" style="max-height: 600px; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            é¸æ“‡èª²ç¨‹åƒæ•¸ä¸¦é»æ“Šç”ŸæˆæŒ‰éˆ•é–‹å§‹ AI èª²ç¨‹ç·¨è¼¯
                        </p>
                    </div>

                    <!-- ä¸‹è¼‰æŒ‰éˆ•å€åŸŸ -->
                    <div id="downloadActions" style="display: none; margin-top: 20px; text-align: center; gap: 10px;">
                        <button class="btn" onclick="downloadWord()" style="background: #2b579a;">
                            ğŸ“„ Download Word
                        </button>
                        <button class="btn" onclick="downloadPDF()" style="background: #d32f2f;">
                            ğŸ“• Download PDF
                        </button>
                    </div>

                    <!-- ç‹€æ…‹é¡¯ç¤º -->
                    <div id="courseStatus" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
                </div>
            </div>
        </div>
        <!-- End of Page 3 -->

    </div>

    <script>
        let uploadedImagePath = null;
        let productAnalysis = null;
        let painPointsAnalysis = null;
        let generatedContent = null;
        
        const form = document.getElementById('productForm');
        const statusDiv = document.getElementById('status');
        const fileUpload = document.getElementById('imageUpload');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const generateScenariosBtn = document.getElementById('generateScenariosBtn');
        
        // File upload handling - Multi-image support
        let selectedFiles = [];
        
        fileUpload.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            // Limit to maximum 5 files
            if (files.length > 5) {
                alert('æœ€å¤šåªèƒ½é¸æ“‡5å¼µåœ–ç‰‡');
                files.splice(5);
                
                // Reset the input to selected files
                const dt = new DataTransfer();
                files.forEach(file => dt.items.add(file));
                e.target.files = dt.files;
            }
            
            selectedFiles = files;
            updateFileUploadDisplay();
            updateImagePreview();
        });
        
        function updateFileUploadDisplay() {
            const uploadText = fileUpload.parentElement.querySelector('p');
            
            if (selectedFiles.length === 0) {
                uploadText.textContent = 'ğŸ“¸ ä¸Šå‚³ç©å…·åœ–ç‰‡ (Upload toy images - æœ€å¤š5å¼µ)';
            } else if (selectedFiles.length === 1) {
                uploadText.textContent = `å·²é¸æ“‡: ${selectedFiles[0].name}`;
            } else {
                uploadText.textContent = `å·²é¸æ“‡: ${selectedFiles.length} å¼µåœ–ç‰‡`;
            }
        }
        
        function updateImagePreview() {
            const previewContainer = document.getElementById('imagePreviewContainer');
            const countDisplay = document.getElementById('selectedImageCount');
            
            if (selectedFiles.length === 0) {
                previewContainer.classList.remove('show');
                countDisplay.style.display = 'none';
                return;
            }
            
            previewContainer.classList.add('show');
            countDisplay.style.display = 'block';
            countDisplay.textContent = `å·²é¸æ“‡ ${selectedFiles.length}/5 å¼µåœ–ç‰‡`;
            
            let html = '<div class="image-preview-grid">';
            
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.querySelector(`[data-file-index="${index}"]`);
                    if (previewItem) {
                        previewItem.querySelector('img').src = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
                
                html += `
                    <div class="image-preview-item" data-file-index="${index}">
                        <img src="" alt="é è¦½åœ–ç‰‡ ${index + 1}">
                        <button class="remove-btn" onclick="removeImage(${index})">Ã—</button>
                    </div>
                `;
            });
            
            html += '</div>';
            previewContainer.innerHTML = html;
        }
        
        function removeImage(index) {
            selectedFiles.splice(index, 1);
            
            // Update the file input
            const dt = new DataTransfer();
            selectedFiles.forEach(file => dt.items.add(file));
            fileUpload.files = dt.files;
            
            updateFileUploadDisplay();
            updateImagePreview();
        }
        
        // Custom input box display/hide handling
        const modelNationalitySelect = document.getElementById('modelNationality');
        const customNationalityInput = document.getElementById('customNationalityInput');
        const modelCombinationSelect = document.getElementById('modelCombination');
        const customCombinationInput = document.getElementById('customCombinationInput');
        const sceneLocationSelect = document.getElementById('sceneLocation');
        const customLocationInput = document.getElementById('customLocationInput');
        
        if (modelNationalitySelect && customNationalityInput) {
            modelNationalitySelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customNationalityInput.style.display = 'block';
                } else {
                    customNationalityInput.style.display = 'none';
                }
            });
        }
        
        if (modelCombinationSelect && customCombinationInput) {
            modelCombinationSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customCombinationInput.style.display = 'block';
                } else {
                    customCombinationInput.style.display = 'none';
                }
            });
        }
        
        if (sceneLocationSelect && customLocationInput) {
            sceneLocationSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customLocationInput.style.display = 'block';
                } else {
                    customLocationInput.style.display = 'none';
                }
            });
        }
        
        // Status display
        function showStatus(message, type) {
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        // Loading state management
        function setLoading(isLoading) {
            analyzeBtn.disabled = isLoading;
            if (isLoading) {
                analyzeBtn.innerHTML = '<span class="loading"></span>AI åˆ†æä¸­...';
            } else {
                analyzeBtn.innerHTML = 'ğŸ§  åˆ†æç”¢å“ä¸¦ç”Ÿæˆå…§å®¹';
            }
        }
        
        // Main form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            setLoading(true);
            
            try {
                const formData = new FormData();
                const industryCategory = document.getElementById('industryCategory').value;
                const productName = document.getElementById('productName').value;
                const productDescription = document.getElementById('productDescription').value;
                const imageFiles = Array.from(document.getElementById('imageUpload').files);
                const language = document.getElementById('language').value;
                const generateImages = document.getElementById('generateImages').checked;
                
                // ç²å–å ´æ™¯é¡å‹é¸æ“‡
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                }
                
                // ç²å–æ¨¡ç‰¹å…’å’Œå ´æ™¯è¨­å®š
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                if (generateImages) {
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                // Get selected platforms
                const selectedPlatforms = Array.from(document.querySelectorAll('#platformsGroup input[type="checkbox"]:checked')).map(cb => cb.value);
                
                if (selectedPlatforms.length === 0) {
                    throw new Error('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç›®æ¨™å¹³å°');
                }
                
                // Step 1: Upload images if provided
                let uploadedImagePaths = [];
                if (imageFiles.length > 0) {
                    showStatus(`ğŸ“¤ ä¸Šå‚³ ${imageFiles.length} å¼µåœ–ç‰‡ä¸­...`, 'info');
                    const imageFormData = new FormData();
                    
                    // Append all image files
                    imageFiles.forEach((file, index) => {
                        imageFormData.append('images', file);
                    });
                    imageFormData.append('productName', productName);
                    imageFormData.append('productDescription', productDescription || '');
                    
                    const imageResponse = await fetch('/api/upload-image', {
                        method: 'POST',
                        body: imageFormData
                    });
                    
                    if (!imageResponse.ok) {
                        throw new Error('åœ–ç‰‡ä¸Šå‚³å¤±æ•—');
                    }
                    
                    const imageResult = await imageResponse.json();
                    uploadedImagePaths = imageResult.paths || [];
                    uploadedImagePath = uploadedImagePaths[0]; // For backward compatibility
                }
                
                // Step 2: AI Product Analysis  
                if (uploadedImagePaths.length > 0 || productDescription) {
                    showStatus(`ğŸ§  AI ç”¢å“åˆ†æä¸­... (${language})`, 'info');
                    console.log('ğŸŒ Selected language for analysis:', language);
                    
                    const analysisResponse = await fetch('/api/analyze-product', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            imagePaths: uploadedImagePaths,
                            imagePath: uploadedImagePaths[0], // For backward compatibility
                            productInfo: {
                                name: productName,
                                description: productDescription,
                                industryCategory: industryCategory
                            },
                            language: language
                        })
                    });
                    
                    if (analysisResponse.ok) {
                        const analysisResult = await analysisResponse.json();
                        productAnalysis = analysisResult.productAnalysis;
                        painPointsAnalysis = analysisResult.painPointsAnalysis;
                        
                        displayAnalysisResults(productAnalysis, painPointsAnalysis);
                    } else {
                        showStatus('âš ï¸ AI åˆ†æå¤±æ•—ï¼Œä½¿ç”¨åŸºç¤æ¨¡å¼ç”Ÿæˆå…§å®¹', 'info');
                    }
                }
                
                // Step 3: Generate platform content
                showStatus('ğŸ¯ ç”Ÿæˆå¤šå¹³å°å…§å®¹ä¸­...', 'info');
                
                const contentResponse = await fetch('/api/generate-platform-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis || {
                            name: productName,
                            description: productDescription,
                            productType: productName,
                            industryCategory: industryCategory
                        },
                        painPointsAnalysis: painPointsAnalysis || {},
                        platforms: selectedPlatforms,
                        language: language,
                        generateImages: generateImages,
                        scenarioType: scenarioType,
                        productImagePath: uploadedImagePath,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!contentResponse.ok) {
                    throw new Error('å…§å®¹ç”Ÿæˆå¤±æ•—');
                }
                
                const contentResult = await contentResponse.json();
                generatedContent = contentResult.results;
                displayPlatformResults(contentResult.results);
                showStatus('âœ… å¤šå¹³å°å…§å®¹ç”Ÿæˆå®Œæˆï¼', 'success');
                
                // Show scenario generation and switch scenario buttons
                generateScenariosBtn.style.display = 'block';
                document.getElementById('switchScenarioBtn').style.display = 'block';
                
            } catch (error) {
                showStatus(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        });
        
        // Scenario generation button handler
        generateScenariosBtn.addEventListener('click', async function() {
            if (!productAnalysis || !generatedContent) {
                showStatus('âš ï¸ è«‹å…ˆå®Œæˆç”¢å“åˆ†æå’Œå…§å®¹ç”Ÿæˆ', 'error');
                return;
            }
            
            try {
                showStatus('ğŸ¬ AI ç”Ÿæˆè¡ŒéŠ·å ´æ™¯ä¸­...', 'info');
                generateScenariosBtn.disabled = true;
                generateScenariosBtn.innerHTML = '<span class="loading"></span>å ´æ™¯ç”Ÿæˆä¸­...';
                
                // é‡æ–°ç²å–å ´æ™¯é¡å‹é¸æ“‡å’Œæ¨¡ç‰¹å…’å ´æ™¯è¨­å®š
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                const generateImages = document.getElementById('generateImages').checked;
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                const scenarioResponse = await fetch('/api/generate-scenarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis,
                        contentData: generatedContent,
                        productImagePath: uploadedImagePath,
                        scenarioType: scenarioType,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!scenarioResponse.ok) {
                    throw new Error('å ´æ™¯ç”Ÿæˆå¤±æ•—');
                }
                
                const scenarioResult = await scenarioResponse.json();
                displayScenariosResults(scenarioResult.scenarios);
                showStatus('âœ… è¡ŒéŠ·å ´æ™¯ç”Ÿæˆå®Œæˆï¼', 'success');
                
            } catch (error) {
                showStatus(`âŒ å ´æ™¯ç”ŸæˆéŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                generateScenariosBtn.disabled = false;
                generateScenariosBtn.innerHTML = 'ğŸ¬ ç”Ÿæˆè¡ŒéŠ·å ´æ™¯';
            }
        });
        
        // Switch scenario button handler - Quick platform switching without re-entering product info
        const switchScenarioBtn = document.getElementById('switchScenarioBtn');
        switchScenarioBtn.addEventListener('click', async function() {
            if (!productAnalysis || !painPointsAnalysis) {
                showStatus('âš ï¸ è«‹å…ˆå®Œæˆç”¢å“åˆ†æ', 'error');
                return;
            }
            
            try {
                // Get selected platforms
                const selectedPlatforms = Array.from(document.querySelectorAll('#platformsGroup input[type="checkbox"]:checked')).map(cb => cb.value);
                
                if (selectedPlatforms.length === 0) {
                    showStatus('âš ï¸ è«‹é¸æ“‡è‡³å°‘ä¸€å€‹ç›®æ¨™å¹³å°', 'error');
                    return;
                }
                
                const language = document.getElementById('language').value;
                const generateImages = document.getElementById('generateImages').checked;
                const industryCategory = document.getElementById('industryCategory').value;
                
                // ç²å–å ´æ™¯é¡å‹é¸æ“‡å’Œæ¨¡ç‰¹å…’å ´æ™¯è¨­å®š
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                showStatus('ğŸ”„ ä½¿ç”¨ç›¸åŒç”¢å“è³‡è¨Šï¼Œåˆ‡æ›å¹³å°é‡æ–°ç”Ÿæˆå…§å®¹...', 'info');
                switchScenarioBtn.disabled = true;
                switchScenarioBtn.innerHTML = '<span class="loading"></span>é‡æ–°ç”Ÿæˆä¸­...';
                
                // Generate platform content with existing product analysis
                const contentResponse = await fetch('/api/generate-platform-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis,
                        painPointsAnalysis: painPointsAnalysis,
                        platforms: selectedPlatforms,
                        language: language,
                        generateImages: generateImages,
                        scenarioType: scenarioType,
                        productImagePath: uploadedImagePath,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!contentResponse.ok) {
                    throw new Error('å…§å®¹ç”Ÿæˆå¤±æ•—');
                }
                
                const contentResult = await contentResponse.json();
                generatedContent = contentResult.results;
                displayPlatformResults(contentResult.results);
                showStatus('âœ… å ´æ™¯åˆ‡æ›æˆåŠŸï¼æ–°å¹³å°å…§å®¹å·²ç”Ÿæˆï¼', 'success');
                
            } catch (error) {
                showStatus(`âŒ å ´æ™¯åˆ‡æ›éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                switchScenarioBtn.disabled = false;
                switchScenarioBtn.innerHTML = 'ğŸ”„ åˆ‡æ›å ´æ™¯é‡æ–°ç”Ÿæˆ (åŒç”¢å“ä¸åŒå¹³å°)';
            }
        });
        
        // Display AI analysis results
        function displayAnalysisResults(productAnalysis, painPointsAnalysis) {
            const resultsDiv = document.getElementById('analysisResults');
            
            let html = '<div class="analysis-section">';
            html += `<h4>ğŸ§¸ ${t('product_analysis_result')}</h4>`;
            
            if (productAnalysis.productType) {
                html += `<p><strong>${t('product_type')}:</strong> ${productAnalysis.productType}</p>`;
            }
            if (productAnalysis.ageRange) {
                html += `<p><strong>${t('age_range')}:</strong> ${productAnalysis.ageRange}</p>`;
            }
            if (productAnalysis.educationalValue) {
                // Handle array or string format
                const eduValue = Array.isArray(productAnalysis.educationalValue) 
                    ? productAnalysis.educationalValue.join('ã€') 
                    : productAnalysis.educationalValue;
                html += `<p><strong>${t('educational_value')}:</strong> ${eduValue}</p>`;
            }
            if (productAnalysis.features) {
                html += `<p><strong>${t('product_features')}:</strong> ${Array.isArray(productAnalysis.features) ? productAnalysis.features.join('ã€') : productAnalysis.features}</p>`;
            }
            if (productAnalysis.safetyFeatures) {
                html += `<p><strong>${t('safety_features')}:</strong> ${Array.isArray(productAnalysis.safetyFeatures) ? productAnalysis.safetyFeatures.join('ã€') : productAnalysis.safetyFeatures}</p>`;
            }
            if (productAnalysis.materials) {
                html += `<p><strong>${t('materials')}:</strong> ${productAnalysis.materials}</p>`;
            }
            if (productAnalysis.colors) {
                html += `<p><strong>${t('colors')}:</strong> ${Array.isArray(productAnalysis.colors) ? productAnalysis.colors.join('ã€') : productAnalysis.colors}</p>`;
            }
            if (productAnalysis.usageScenarios) {
                html += `<p><strong>${t('usage_scenarios')}:</strong> ${Array.isArray(productAnalysis.usageScenarios) ? productAnalysis.usageScenarios.join('ã€') : productAnalysis.usageScenarios}</p>`;
            }
            
            html += '</div>';
            
            if (painPointsAnalysis.painPoints) {
                html += '<div class="analysis-section">';
                html += `<h4>ğŸ’¡ ${t('identified_pain_points')}</h4>`;
                painPointsAnalysis.painPoints.forEach(pain => {
                    // Check if bilingual format (contains /) 
                    if (pain.category && pain.category.includes('/')) {
                        const [zhCategory, viCategory] = pain.category.split('/');
                        const [zhDesc, viDesc] = pain.description ? pain.description.split('/') : ['', ''];
                        const [zhTarget, viTarget] = pain.targetAudience ? pain.targetAudience.split('/') : ['', ''];
                        const [zhSeverity, viSeverity] = pain.severity ? pain.severity.split('/') : ['', ''];
                        
                        html += `<div class="pain-point bilingual-analysis">
                            <div class="language-section">
                                <h6 style="color: #d32f2f; margin-bottom: 5px;">ğŸ‡¹ğŸ‡¼</h6>
                                <strong>${zhCategory.trim()}:</strong> ${zhDesc.trim()}
                                <br><small style="color: #666;">${t('target')}: ${zhTarget.trim()} (${zhSeverity.trim()})</small>
                            </div>
                            <div class="language-section" style="margin-top: 8px;">
                                <h6 style="color: #1976d2; margin-bottom: 5px;">ğŸ‡»ğŸ‡³</h6>
                                <strong>${viCategory.trim()}:</strong> ${viDesc.trim()}
                                <br><small style="color: #666;">${t('target')}: ${viTarget.trim()} (${viSeverity.trim()})</small>
                            </div>
                        </div>`;
                    } else {
                        html += `<div class="pain-point">
                            <strong>${pain.category}:</strong> ${pain.description}
                            <small style="color: #666;"> (${pain.severity})</small>
                        </div>`;
                    }
                });
                html += '</div>';
            }
            
            if (painPointsAnalysis.usageScenarios) {
                html += '<div class="analysis-section">';
                html += `<h4>ğŸ¬ ${t('usage_scenario_suggestions')}</h4>`;
                painPointsAnalysis.usageScenarios.forEach(scenario => {
                    // Check if bilingual format
                    if (scenario.scenario && scenario.scenario.includes('/')) {
                        const scenarioParts = scenario.scenario.split('/');
                        const zhScenario = scenarioParts[0] || '';
                        const viScenario = scenarioParts[1] || scenarioParts[0] || '';
                        
                        const contextParts = scenario.context ? scenario.context.split('/') : ['', ''];
                        const zhContext = contextParts[0] || '';
                        const viContext = contextParts[1] || contextParts[0] || '';
                        
                        const benefitsParts = scenario.benefits ? scenario.benefits.split('/') : ['', ''];
                        const zhBenefits = benefitsParts[0] || '';
                        const viBenefits = benefitsParts[1] || benefitsParts[0] || '';
                        
                        const emotionsParts = scenario.emotions ? scenario.emotions.split('/') : ['', ''];
                        const zhEmotions = emotionsParts[0] || '';
                        const viEmotions = emotionsParts[1] || emotionsParts[0] || '';
                        
                        html += `<div class="scenario bilingual-analysis">
                            <div class="language-section">
                                <h6 style="color: #d32f2f; margin-bottom: 5px;">ğŸ‡¹ğŸ‡¼</h6>
                                <strong>${zhScenario.trim()}:</strong> ${zhContext.trim()}
                                <br><small style="color: #28a745;">${zhBenefits.trim()}</small>
                                <br><small style="color: #ff9800;">${t('emotions')}: ${zhEmotions.trim()}</small>
                            </div>
                            <div class="language-section" style="margin-top: 8px;">
                                <h6 style="color: #1976d2; margin-bottom: 5px;">ğŸ‡»ğŸ‡³</h6>
                                <strong>${viScenario.trim()}:</strong> ${viContext.trim()}
                                <br><small style="color: #28a745;">${viBenefits.trim()}</small>
                                <br><small style="color: #ff9800;">${t('emotions')}: ${viEmotions.trim()}</small>
                            </div>
                        </div>`;
                    } else {
                        html += `<div class="scenario">
                            <strong>${scenario.scenario}:</strong> ${scenario.context}
                            <br><small style="color: #28a745;">${scenario.benefits}</small>
                        </div>`;
                    }
                });
                html += '</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // åœ–ç‰‡ä¸‹è¼‰åŠŸèƒ½
        function downloadFile(filePath, filename) {
            try {
                const downloadUrl = `/api/download-image?path=${encodeURIComponent(filePath)}`;
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = filename || 'download';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus(`ğŸ“¥ æ­£åœ¨ä¸‹è¼‰: ${filename}`, 'info');
            } catch (error) {
                showStatus(`âŒ ä¸‹è¼‰å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // Display platform-specific results with download functionality
        function displayPlatformResults(results) {
            const resultsContainer = document.getElementById('resultsContainer');
            const platformResults = document.getElementById('platformResults');
            
            let html = '';
            
            Object.entries(results).forEach(([platform, result]) => {
                const config = result.platformConfig || {};
                const content = result.content;
                
                html += `<div class="platform-result">
                    <h3>
                        ${getPlatformIcon(platform)} ${config.displayName || platform.toUpperCase()}
                        ${result.status === 'success' ? 'âœ…' : 'âš ï¸'}
                    </h3>`;
                
                if (result.status === 'success' && content) {
                    // Handle bilingual content format
                    if (typeof content.mainContent === 'object' && content.mainContent['zh-TW'] && content.mainContent['vi']) {
                        // Bilingual format
                        html += `<div class="content bilingual-content">
                            <div class="language-section">
                                <h5 style="color: #d32f2f; margin-bottom: 8px;">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</h5>
                                <div>${content.mainContent['zh-TW']}</div>
                            </div>
                            <div class="language-section" style="margin-top: 15px;">
                                <h5 style="color: #1976d2; margin-bottom: 8px;">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</h5>
                                <div>${content.mainContent['vi']}</div>
                            </div>
                        </div>`;
                        
                        // Bilingual hashtags
                        if (content.hashtags && typeof content.hashtags === 'object') {
                            html += `<div class="hashtags-bilingual">
                                <div style="margin-bottom: 8px;">
                                    <strong>ğŸ‡¹ğŸ‡¼:</strong> ${content.hashtags['zh-TW']?.join(' ') || ''}
                                </div>
                                <div>
                                    <strong>ğŸ‡»ğŸ‡³:</strong> ${content.hashtags['vi']?.join(' ') || ''}
                                </div>
                            </div>`;
                        }
                        
                        // Bilingual CTA
                        if (content.cta && typeof content.cta === 'object') {
                            html += `<div style="margin-top: 10px;">
                                <div style="margin-bottom: 5px;"><strong>ğŸ‡¹ğŸ‡¼ CTA:</strong> ${content.cta['zh-TW'] || ''}</div>
                                <div><strong>ğŸ‡»ğŸ‡³ CTA:</strong> ${content.cta['vi'] || ''}</div>
                            </div>`;
                        }
                    } else {
                        // Standard single-language format
                        html += `<div class="content">${content.mainContent || content.rawContent}</div>`;
                        
                        if (content.hashtags && content.hashtags.length > 0) {
                            html += `<div class="hashtags">${content.hashtags.join(' ')}</div>`;
                        }
                        
                        if (content.cta) {
                            html += `<div style="margin-top: 10px;"><strong>CTA:</strong> ${content.cta}</div>`;
                        }
                    }
                    
                    // é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡æˆ–è¨­è¨ˆæè¿°ï¼ˆå¸¶ä¸‹è¼‰åŠŸèƒ½ï¼‰
                    if (result.generatedImageDescription) {
                        html += `<div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">`;
                        
                        if (result.isRealImage) {
                            html += `
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <strong>ğŸ¨ AI ç”Ÿæˆåœ–ç‰‡:</strong>
                                    <button onclick="downloadFile('${result.path}', '${platform}_generated_image.png')" 
                                            class="btn btn-small" style="background: #4CAF50; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">
                                        ğŸ“¥ ä¸‹è¼‰åœ–ç‰‡
                                    </button>
                                </div>
                                <small style="color: #1976d2;">âœ… çœŸå¯¦ AI åœ–ç‰‡å·²ç”Ÿæˆ (${Math.round(result.size/1024)}KB)</small>`;
                        } else {
                            html += `
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <strong>ğŸ“‹ å°ˆæ¥­è¨­è¨ˆè¦æ ¼:</strong>
                                    <button onclick="downloadFile('${result.path}', '${platform}_design_spec.md')" 
                                            class="btn btn-small" style="background: #2196F3; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">
                                        ğŸ“¥ ä¸‹è¼‰è¦æ ¼
                                    </button>
                                </div>
                                <small style="color: #666;">ğŸ“ å¯ç”¨æ–¼å°ˆæ¥­è¨­è¨ˆå·¥å…· (DALL-E, Midjourney, Stable Diffusion)</small>`;
                        }
                        
                        html += `</div>`;
                    }
                } else {
                    html += `<div class="content" style="color: #dc3545;">
                        éŒ¯èª¤: ${result.error}
                        <br>å‚™ç”¨å…§å®¹: ${result.fallback}
                    </div>`;
                }
                
                html += '</div>';
            });
            
            platformResults.innerHTML = html;
            resultsContainer.style.display = 'block';
        }
        
        function getPlatformIcon(platform) {
            const icons = {
                shopee: 'ğŸ›’',
                tiktok: 'ğŸµ',
                instagram: 'ğŸ“¸',
                facebook: 'ğŸ‘'
            };
            return icons[platform] || 'ğŸ“±';
        }
        
        // Display scenarios results with download functionality
        function displayScenariosResults(scenarios) {
            const scenariosContainer = document.getElementById('scenariosContainer');
            const scenarioResults = document.getElementById('scenarioResults');
            
            let html = '';
            
            scenarios.forEach((scenario, index) => {
                html += `<div class="platform-result" style="margin-bottom: 25px;">
                    <h3 style="color: #4a90e2;">
                        ğŸ¬ å ´æ™¯ ${scenario.scenarioIndex}: ${scenario.name}
                        ${scenario.imageError ? 'âš ï¸' : 'âœ…'}
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #333; margin-bottom: 8px;">ğŸ“ å ´æ™¯æè¿°</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            ${scenario.description}
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <strong>ğŸ’­ æƒ…æ„Ÿæ°›åœ:</strong> ${scenario.emotion}<br>
                                <strong>ğŸ¯ é©åˆå¹³å°:</strong> ${scenario.suitablePlatforms?.join(', ') || 'é€šç”¨'}
                            </div>
                            <div>
                                <strong>ğŸ¨ è¦–è¦ºé‡é»:</strong> ${scenario.visualFocus}
                            </div>
                        </div>
                    </div>`;
                
                if (scenario.imageDescription) {
                    html += `<div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ–¼ï¸ åœ–ç‰‡è¨­è¨ˆæè¿°</h4>
                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6;">
                            ${scenario.imageDescription}
                        </div>
                    </div>`;
                }
                
                // é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡æˆ–è¨­è¨ˆæŒ‡å°ï¼ˆå¸¶ä¸‹è¼‰åŠŸèƒ½ï¼‰
                if (scenario.isRealImage && scenario.path) {
                    html += `<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <h4 style="color: #2e7d2e; margin: 0;">ğŸ¨ AI ç”Ÿæˆå ´æ™¯åœ–ç‰‡</h4>
                            <button onclick="downloadFile('${scenario.path}', 'scenario_${scenario.scenarioIndex}_${scenario.name.replace(/[^a-zA-Z0-9]/g, '_')}.png')" 
                                    class="btn btn-small" style="background: #4CAF50; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                                ğŸ“¥ ä¸‹è¼‰å ´æ™¯åœ–ç‰‡
                            </button>
                        </div>
                        <p style="color: #2e7d2e; margin: 0;">âœ… çœŸå¯¦ AI åœ–ç‰‡å·²ç”Ÿæˆ (${Math.round(scenario.size/1024)}KB)</p>
                    </div>`;
                } else if (scenario.designGuidePath || scenario.path) {
                    const filePath = scenario.designGuidePath || scenario.path;
                    const fileName = `scenario_${scenario.scenarioIndex}_${scenario.name.replace(/[^a-zA-Z0-9]/g, '_')}_guide.md`;
                    
                    html += `<div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <h4 style="color: #7b1fa2; margin: 0;">ğŸ“‹ å°ˆæ¥­è¨­è¨ˆæŒ‡å°æ–‡ä»¶</h4>
                            <button onclick="downloadFile('${filePath}', '${fileName}')" 
                                    class="btn btn-small" style="background: #9C27B0; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                                ğŸ“¥ ä¸‹è¼‰è¨­è¨ˆæŒ‡å°
                            </button>
                        </div>
                        <p style="color: #666; font-size: 14px; margin: 0;">ğŸ“ åŒ…å«å®Œæ•´è¨­è¨ˆè¦æ ¼ï¼Œå¯ç”¨æ–¼å°ˆæ¥­è¨­è¨ˆå·¥å…· (DALL-E, Midjourney, Stable Diffusion)</p>
                    </div>`;
                }
                
                if (scenario.imageError) {
                    html += `<div style="background: #ffebee; padding: 15px; border-radius: 8px; border-left: 4px solid #f44336;">
                        <strong style="color: #d32f2f;">åœ–ç‰‡ç”ŸæˆéŒ¯èª¤:</strong> ${scenario.imageError}
                    </div>`;
                }
                
                html += '</div>';
            });
            
            scenarioResults.innerHTML = html;
            scenariosContainer.style.display = 'block';
        }
        
        // Toggle scenario options based on generateImages checkbox
        function toggleScenarioOptions() {
            const generateImages = document.getElementById('generateImages').checked;
            const modelSceneOptionsGroup = document.getElementById('modelSceneOptionsGroup');
            const scenarioOptionsGroup = document.getElementById('scenarioOptionsGroup');
            
            if (generateImages) {
                modelSceneOptionsGroup.style.display = 'block';
                scenarioOptionsGroup.style.display = 'block';
            } else {
                modelSceneOptionsGroup.style.display = 'none';
                scenarioOptionsGroup.style.display = 'none';
            }
        }

        // Load brand configuration and populate UI
        async function loadBrandConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                // Update brand elements
                const logoElement = document.getElementById('brandLogo');
                logoElement.src = config.brand.logoPath;
                logoElement.alt = `${config.brand.name} Logo`;
                logoElement.style.display = 'block';
                // brandTitle and brandSlogan now use data-i18n attributes for automatic translation
                // Title and slogan will be updated by updatePageLanguage() function
                document.title = `${config.brand.name} Multi-Platform Content Generator`;
                
                // Populate platforms
                const platformsGroup = document.getElementById('platformsGroup');
                platformsGroup.innerHTML = '';
                config.platforms.forEach(platform => {
                    const item = document.createElement('div');
                    item.className = 'checkbox-item';
                    item.innerHTML = `
                        <input type="checkbox" id="platform_${platform.value}" value="${platform.value}" checked>
                        <label for="platform_${platform.value}">${platform.label}</label>
                    `;
                    platformsGroup.appendChild(item);
                });
                
                console.log('Brand configuration loaded:', config);
            } catch (error) {
                console.error('Failed to load brand configuration:', error);
            }
        }
        
        // Initialize app
        fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                console.log('API Status:', data);
                return loadBrandConfig();
            })
            .catch(error => {
                console.error('API connection failed:', error);
            });
        
        // ==================== Page 2: AI å»£å‘Šé¡§å•åŠŸèƒ½ ====================
        
        // åˆ†é åˆ‡æ›å‡½æ•¸
        function switchPage(pageId) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„é é¢
            document.getElementById(pageId).classList.add('active');
            
            // è¨­ç½®å°æ‡‰æŒ‰éˆ•ç‚º active
            event.target.classList.add('active');
        }
        
        // Page 2 æª”æ¡ˆä¸Šå‚³è™•ç†
        let selectedAdsFiles = [];
        const adsFileUpload = document.getElementById('adsFileUpload');
        
        if (adsFileUpload) {
            adsFileUpload.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                
                // é™åˆ¶æœ€å¤š 10 å€‹æª”æ¡ˆ
                if (files.length > 10) {
                    alert('æœ€å¤šåªèƒ½é¸æ“‡10å€‹æª”æ¡ˆ');
                    files.splice(10);
                    
                    const dt = new DataTransfer();
                    files.forEach(file => dt.items.add(file));
                    e.target.files = dt.files;
                }
                
                selectedAdsFiles = files;
                displayAdsFilePreview(files);
            });
        }
        
        // é¡¯ç¤º Page 2 æª”æ¡ˆé è¦½
        function displayAdsFilePreview(files) {
            const container = document.getElementById('adsFilePreviewContainer');
            const countDiv = document.getElementById('selectedAdsFileCount');
            
            if (files.length === 0) {
                container.style.display = 'none';
                countDiv.style.display = 'none';
                return;
            }
            
            container.innerHTML = '';
            container.classList.add('show');
            countDiv.style.display = 'block';
            countDiv.textContent = `å·²é¸æ“‡ ${files.length} å€‹æª”æ¡ˆ`;
            
            const grid = document.createElement('div');
            grid.className = 'image-preview-grid';
            
            files.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'image-preview-item';
                
                // æ ¹æ“šæª”æ¡ˆé¡å‹é¡¯ç¤ºä¸åŒåœ–ç¤º
                let fileIcon = 'ğŸ“„';
                if (file.type.startsWith('image/')) {
                    fileIcon = 'ğŸ–¼ï¸';
                } else if (file.type.includes('pdf')) {
                    fileIcon = 'ğŸ“•';
                } else if (file.type.includes('sheet') || file.type.includes('excel')) {
                    fileIcon = 'ğŸ“Š';
                } else if (file.type.includes('word') || file.type.includes('document')) {
                    fileIcon = 'ğŸ“';
                }
                
                item.innerHTML = `
                    <div style="padding: 15px; text-align: center; background: #f0f0f0; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                        <div style="font-size: 32px;">${fileIcon}</div>
                        <div style="font-size: 10px; margin-top: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${file.name}</div>
                    </div>
                    <button class="remove-btn" onclick="removeAdsFile(${index})">Ã—</button>
                `;
                
                grid.appendChild(item);
            });
            
            container.appendChild(grid);
        }
        
        // ç§»é™¤ Page 2 æª”æ¡ˆ
        function removeAdsFile(index) {
            selectedAdsFiles.splice(index, 1);
            
            const dt = new DataTransfer();
            selectedAdsFiles.forEach(file => dt.items.add(file));
            document.getElementById('adsFileUpload').files = dt.files;
            
            displayAdsFilePreview(selectedAdsFiles);
        }
        
        // Page 2 è¡¨å–®æäº¤è™•ç†
        const adsAnalysisForm = document.getElementById('adsAnalysisForm');
        if (adsAnalysisForm) {
            adsAnalysisForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const brandName = document.getElementById('brandName').value.trim();
                const productName = document.getElementById('adProductName').value.trim();
                const coreProduct = document.getElementById('coreProduct').value.trim();
                const targetMarket = document.getElementById('targetMarket').value.trim();
                
                // ç²å–é¸ä¸­çš„å¹³å°
                const selectedPlatforms = Array.from(document.querySelectorAll('input[name="adsPlatform"]:checked'))
                    .map(cb => cb.value);
                
                // æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•å¯åˆ†æçš„è³‡è¨Šï¼ˆæª”æ¡ˆæˆ–æ–‡å­—è³‡è¨Šï¼‰
                const hasFiles = selectedAdsFiles.length > 0;
                const hasTextInfo = brandName || productName || coreProduct || targetMarket;
                const hasPlatformSelection = selectedPlatforms.length > 0;
                
                if (!hasFiles && !hasTextInfo) {
                    alert('è«‹è‡³å°‘ä¸Šå‚³æª”æ¡ˆæˆ–å¡«å¯«å“ç‰Œ/ç”¢å“è³‡è¨Šï¼ŒAI æ‰èƒ½é€²è¡Œåˆ†æ');
                    return;
                }
                
                if (!hasPlatformSelection) {
                    alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å»£å‘Šå¹³å°');
                    return;
                }
                
                const statusDiv = document.getElementById('adsStatus');
                const resultsDiv = document.getElementById('adsAnalysisResults');
                const analyzeBtn = document.getElementById('analyzeAdsBtn');
                
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'ğŸ”„ åˆ†æä¸­...';
                statusDiv.innerHTML = '<p style="color: #87CEEB;">â³ æ­£åœ¨ä¸Šå‚³æª”æ¡ˆä¸¦åˆ†æå»£å‘Šè³‡æ–™...</p>';
                
                try {
                    // æº–å‚™è¡¨å–®æ•¸æ“š
                    const formData = new FormData();
                    formData.append('brandName', brandName);
                    formData.append('productName', productName);
                    formData.append('coreProduct', coreProduct);
                    formData.append('targetMarket', targetMarket);
                    formData.append('platforms', JSON.stringify(selectedPlatforms));
                    formData.append('language', currentLanguage); // æ·»åŠ ç•¶å‰èªè¨€
                    
                    // æ·»åŠ æ‰€æœ‰æª”æ¡ˆ
                    selectedAdsFiles.forEach((file, index) => {
                        formData.append('files', file);
                    });
                    
                    // ç™¼é€åˆ°å¾Œç«¯ API
                    const response = await fetch('/api/analyze-ads', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error('åˆ†æè«‹æ±‚å¤±æ•—');
                    }
                    
                    const result = await response.json();
                    
                    // é¡¯ç¤ºåˆ†æçµæœ
                    displayAdsAnalysisResults(result);
                    
                    // ä¿å­˜åˆ†æä¸Šä¸‹æ–‡ä¾›å°è©±ä½¿ç”¨
                    analysisContext = {
                        brandNeedSummary: result.brandNeedSummary,
                        performanceInsight: result.performanceInsight,
                        creativeStrategy: result.creativeStrategy,
                        optimizationPlan: result.optimizationPlan,
                        advertisingReviewReport: result.advertisingReviewReport
                    };
                    
                    // é¡¯ç¤ºå»ºè­°å•é¡Œå’Œå°è©±è¦–çª—
                    if (result.suggestedQuestions && result.suggestedQuestions.length > 0) {
                        showSuggestedQuestions(result.suggestedQuestions);
                    }
                    
                    // é¡¯ç¤ºå°è©±è¦–çª—
                    document.getElementById('chatAdvisorContainer').classList.add('active');
                    
                    statusDiv.innerHTML = '<p style="color: #28a745;">âœ… åˆ†æå®Œæˆï¼æ‚¨å¯ä»¥åœ¨ä¸‹æ–¹å°è©±è¦–çª—å‘ AI é¡§å•æå•ã€‚</p>';
                    document.getElementById('reportActions').style.display = 'block';
                    
                } catch (error) {
                    console.error('åˆ†æéŒ¯èª¤:', error);
                    statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
                } finally {
                    analyzeBtn.disabled = false;
                    analyzeBtn.textContent = 'ğŸ§  é–‹å§‹åˆ†æ (Start Analysis)';
                }
            });
        }
        
        // é¡¯ç¤ºå»£å‘Šåˆ†æçµæœ
        function displayAdsAnalysisResults(result) {
            const resultsDiv = document.getElementById('adsAnalysisResults');
            
            let html = '<div style="text-align: left;">';
            
            // 1. Brand Need Summary
            if (result.brandNeedSummary) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-left: 4px solid #87CEEB; border-radius: 8px;">
                        <h3 style="color: #87CEEB; margin-bottom: 10px;">ğŸ“Œ Brand Need Summary (å“ç‰Œéœ€æ±‚æ‘˜è¦)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.brandNeedSummary}</p>
                    </div>
                `;
            }
            
            // 2. Performance Insight
            if (result.performanceInsight) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
                        <h3 style="color: #ffc107; margin-bottom: 10px;">ğŸ“Š Performance Insight (æ•ˆèƒ½æ´å¯Ÿ)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.performanceInsight}</p>
                    </div>
                `;
            }
            
            // 3. Creative Strategy
            if (result.creativeStrategy) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #d1ecf1; border-left: 4px solid #17a2b8; border-radius: 8px;">
                        <h3 style="color: #17a2b8; margin-bottom: 10px;">ğŸ¨ Creative Strategy (å‰µæ„ç­–ç•¥)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.creativeStrategy}</p>
                    </div>
                `;
            }
            
            // 4. Optimization Plan
            if (result.optimizationPlan) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 8px;">
                        <h3 style="color: #28a745; margin-bottom: 10px;">ğŸš€ Optimization Plan (å„ªåŒ–è¨ˆåŠƒ)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.optimizationPlan}</p>
                    </div>
                `;
            }
            
            // 5. Advertising Review Report
            if (result.advertisingReviewReport) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 8px;">
                        <h3 style="color: #dc3545; margin-bottom: 10px;">ğŸ“ Advertising Review Report (å»£å‘Šæª¢è¦–å ±å‘Š)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.advertisingReviewReport}</p>
                    </div>
                `;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        // PDF åŒ¯å‡ºåŠŸèƒ½
        function exportPDF() {
            window.print();
        }
        
        // é‡æ–°åˆ†æåŠŸèƒ½
        function reanalyze() {
            document.getElementById('adsAnalysisResults').innerHTML = `
                <p style="text-align: center; color: #666; padding: 40px;">
                    ä¸Šå‚³å»£å‘Šè³‡æ–™ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                </p>
            `;
            document.getElementById('reportActions').style.display = 'none';
            document.getElementById('adsStatus').innerHTML = '';
        }
        
        // ==================== èªè¨€åˆ‡æ›åŠŸèƒ½ ====================
        
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.classList.toggle('active');
        }
        
        function selectLanguage(lang) {
            switchLanguage(lang);
            const menu = document.getElementById('languageMenu');
            menu.classList.remove('active');
            
            // æ›´æ–°é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // é»æ“Šå¤–éƒ¨é—œé–‰èªè¨€é¸å–®
        document.addEventListener('click', function(event) {
            const languageSwitcher = document.querySelector('.language-switcher');
            if (languageSwitcher && !languageSwitcher.contains(event.target)) {
                document.getElementById('languageMenu').classList.remove('active');
            }
        });
        
        // ==================== å°è©±åŠŸèƒ½ ====================
        
        let chatHistory = [];
        let chatFiles = [];
        let analysisContext = null; // å„²å­˜åˆ†æçµæœä½œç‚ºå°è©±ä¸Šä¸‹æ–‡
        
        // æª”æ¡ˆä¸Šå‚³è™•ç†
        const chatFileUpload = document.getElementById('chatFileUpload');
        if (chatFileUpload) {
            chatFileUpload.addEventListener('change', function(e) {
                chatFiles = Array.from(e.target.files);
                displayChatFilePreview();
            });
        }
        
        function displayChatFilePreview() {
            const container = document.getElementById('chatFilePreview');
            if (chatFiles.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = chatFiles.map((file, index) => `
                <div class="chat-file-item">
                    ğŸ“ ${file.name}
                    <span class="chat-file-remove" onclick="removeChatFile(${index})">Ã—</span>
                </div>
            `).join('');
        }
        
        function removeChatFile(index) {
            chatFiles.splice(index, 1);
            displayChatFilePreview();
        }
        
        // ç™¼é€å°è©±è¨Šæ¯
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message && chatFiles.length === 0) {
                alert('è«‹è¼¸å…¥å•é¡Œæˆ–ä¸Šå‚³æª”æ¡ˆ');
                return;
            }
            
            // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
            if (message) {
                addChatMessage('user', message);
            }
            if (chatFiles.length > 0) {
                addChatMessage('user', `ğŸ“ å·²ä¸Šå‚³ ${chatFiles.length} å€‹æª”æ¡ˆ`);
            }
            
            input.value = '';
            const sendBtn = document.getElementById('chatSendBtn');
            sendBtn.disabled = true;
            
            // é¡¯ç¤ºè¼‰å…¥ä¸­
            const loadingId = 'loading-' + Date.now();
            addChatMessage('ai', 'æ­£åœ¨æ€è€ƒä¸­...', loadingId);
            
            try {
                // æº–å‚™è¡¨å–®æ•¸æ“š
                const formData = new FormData();
                formData.append('message', message);
                formData.append('chatHistory', JSON.stringify(chatHistory));
                formData.append('language', currentLanguage); // æ·»åŠ ç•¶å‰èªè¨€
                if (analysisContext) {
                    formData.append('analysisContext', JSON.stringify(analysisContext));
                }
                
                // æ·»åŠ æª”æ¡ˆ
                chatFiles.forEach(file => {
                    formData.append('files', file);
                });
                
                // ç™¼é€è«‹æ±‚
                const response = await fetch('/api/chat-with-advisor', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ç§»é™¤è¼‰å…¥è¨Šæ¯
                    document.getElementById(loadingId)?.remove();
                    
                    // é¡¯ç¤ºAIå›è¦†
                    addChatMessage('ai', data.response);
                    
                    // æ›´æ–°å°è©±æ­·å²
                    chatHistory.push({
                        role: 'user',
                        content: message,
                        hasFiles: chatFiles.length > 0
                    });
                    chatHistory.push({
                        role: 'assistant',
                        content: data.response
                    });
                    
                    // æ¸…ç©ºæª”æ¡ˆ
                    chatFiles = [];
                    displayChatFilePreview();
                } else {
                    throw new Error(data.error || 'å°è©±å¤±æ•—');
                }
            } catch (error) {
                console.error('å°è©±éŒ¯èª¤:', error);
                document.getElementById(loadingId)?.remove();
                addChatMessage('ai', 'æŠ±æ­‰ï¼Œç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            } finally {
                sendBtn.disabled = false;
            }
        }
        
        // æ·»åŠ å°è©±è¨Šæ¯åˆ°ç•Œé¢
        function addChatMessage(role, content, messageId = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            if (messageId) messageDiv.id = messageId;
            
            const avatar = role === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤';
            
            messageDiv.innerHTML = `
                <div class="chat-message-avatar">${avatar}</div>
                <div class="chat-message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // é¡¯ç¤ºå»ºè­°å•é¡Œ
        function showSuggestedQuestions(questions) {
            const container = document.getElementById('suggestedQuestionsList');
            const questionsDiv = document.getElementById('suggestedQuestions');
            
            container.innerHTML = questions.map((q, index) => `
                <button class="suggested-question-btn" onclick="askSuggestedQuestion('${q.replace(/'/g, "\\'")}')">
                    ${index + 1}. ${q}
                </button>
            `).join('');
            
            questionsDiv.style.display = 'block';
        }
        
        // é»æ“Šå»ºè­°å•é¡Œ
        function askSuggestedQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
            document.getElementById('suggestedQuestions').style.display = 'none';
        }
        
        // Enter ç™¼é€è¨Šæ¯
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
        }
    </script>

    <!-- Page 3: AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶ JavaScript -->
    <script>
        // å„²å­˜ç”Ÿæˆçš„èª²ç¨‹æ•¸æ“š
        let generatedCourseData = null;

        // ä¸»é¡Œé¸é …ï¼ˆæ ¹æ“šç§‘åˆ¥å‹•æ…‹æ›´æ–°ï¼‰
        const topicOptions = {
            social: ['å®¶åº­', 'äº¤é€šå·¥å…·', 'ç¤¾æœƒè§’è‰²', 'æ–‡åŒ–ç¯€æ—¥', 'å®‰å…¨æ•™è‚²'],
            science: ['å‹•ç‰©', 'æ¤ç‰©', 'åœ°çƒ', 'å¤©æ°£', 'äº”æ„Ÿ'],
            math: ['åŠ æ³•', 'æ¸›æ³•', 'å½¢ç‹€', 'æ™‚é–“', 'åº¦é‡'],
            language: ['å­—æ¯', 'è©å½™', 'è½èªªè®€å¯«', 'çŸ­ç¯‡æ•…äº‹'],
            art: ['é¡è‰²', 'ç·šæ¢', 'å‰µä½œ', 'éŸ³æ¨‚ç¯€å¥']
        };

        // è™•ç†å¹´é½¡é¸æ“‡è®ŠåŒ–
        function handleAgeChange() {
            const ageSelect = document.getElementById('targetAge');
            const customInput = document.getElementById('customAgeText');
            
            if (ageSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†ç§‘åˆ¥é¸æ“‡è®ŠåŒ–
        function handleCategoryChange() {
            const categorySelect = document.getElementById('category');
            const customInput = document.getElementById('customCategoryText');
            
            if (categorySelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // æ›´æ–°ä¸»é¡Œé¸é …ï¼ˆæ ¹æ“šç§‘åˆ¥ï¼‰
        function updateTopicOptions() {
            const category = document.getElementById('category').value;
            const topicSelect = document.getElementById('topic');
            
            // æ¸…ç©ºç¾æœ‰é¸é …
            topicSelect.innerHTML = '';
            
            if (category === 'custom') {
                // å¦‚æœæ˜¯è‡ªå®šç¾©ç§‘åˆ¥ï¼Œé¡¯ç¤ºé€šç”¨é¸é …
                topicSelect.innerHTML = '<option value="custom">è‡ªå®šç¾© (Custom)</option>';
                document.getElementById('customTopicText').style.display = 'block';
            } else if (topicOptions[category]) {
                // æ ¹æ“šç§‘åˆ¥æ·»åŠ å°æ‡‰ä¸»é¡Œ
                topicOptions[category].forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    topicSelect.appendChild(option);
                });
                
                // æ·»åŠ è‡ªå®šç¾©é¸é …
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'è‡ªå®šç¾© (Custom)';
                topicSelect.appendChild(customOption);
                
                document.getElementById('customTopicText').style.display = 'none';
            }
        }

        // è™•ç†ä¸»é¡Œé¸æ“‡è®ŠåŒ–
        function handleTopicChange() {
            const topicSelect = document.getElementById('topic');
            const customInput = document.getElementById('customTopicText');
            
            if (topicSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†æ™‚é•·é¸æ“‡è®ŠåŒ–
        function handleDurationChange() {
            const durationSelect = document.getElementById('duration');
            const customInput = document.getElementById('customDurationText');
            
            if (durationSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†é¢¨æ ¼é¸æ“‡è®ŠåŒ–
        function handleStyleChange() {
            const styleSelect = document.getElementById('style');
            const customInput = document.getElementById('customStyleText');
            
            if (styleSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // ç”Ÿæˆèª²ç¨‹å…§å®¹
        async function generateCourse() {
            const btn = document.getElementById('generateCourseBtn');
            const preview = document.getElementById('coursePreview');
            const status = document.getElementById('courseStatus');
            
            // ç²å–è¡¨å–®æ•¸æ“š
            let targetAge = document.getElementById('targetAge').value;
            if (targetAge === 'custom') {
                const customAge = document.getElementById('customAgeText').value;
                targetAge = customAge || '6-8'; // é»˜èªå€¼
            }

            let category = document.getElementById('category').value;
            if (category === 'custom') {
                const customCategory = document.getElementById('customCategoryText').value.trim();
                category = customCategory || 'social';
            }

            let topic = document.getElementById('topic').value;
            if (topic === 'custom') {
                const customTopic = document.getElementById('customTopicText').value.trim();
                topic = customTopic || 'ä¸»é¡Œ';
            }

            let duration = document.getElementById('duration').value;
            if (duration === 'custom') {
                const customDuration = document.getElementById('customDurationText').value;
                duration = customDuration || '60';
            }

            let style = document.getElementById('style').value;
            if (style === 'custom') {
                const customStyle = document.getElementById('customStyleText').value.trim();
                style = customStyle || 'story-based';
            }

            const outputTypesCheckboxes = document.querySelectorAll('input[name="outputTypes"]:checked');
            const outputTypes = Array.from(outputTypesCheckboxes).map(cb => cb.value);

            if (outputTypes.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®è¼¸å‡ºæ ¼å¼');
                return;
            }

            const language = document.getElementById('courseLanguage').value;
            const includeImages = document.getElementById('includeImages').value;

            // é¡¯ç¤ºç”Ÿæˆä¸­ç‹€æ…‹
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> ç”Ÿæˆä¸­...';
            
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ¤– AI æ­£åœ¨ç”Ÿæˆèª²ç¨‹å…§å®¹ï¼Œè«‹ç¨å€™...';
            
            preview.innerHTML = '<p style="text-align: center; padding: 40px;"><span class="loading"></span><br>AI ç”Ÿæˆä¸­...</p>';

            try {
                const response = await fetch('/api/generate-course', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        targetAge,
                        category,
                        topic,
                        duration,
                        style,
                        outputTypes,
                        language,
                        includeImages
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'èª²ç¨‹ç”Ÿæˆå¤±æ•—');
                }

                // ä¿å­˜èª²ç¨‹æ•¸æ“š
                generatedCourseData = data.course;

                // é¡¯ç¤ºèª²ç¨‹å…§å®¹
                displayCourseContent(data.course);

                // é¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•
                document.getElementById('downloadActions').style.display = 'flex';

                status.className = 'success';
                status.innerHTML = 'âœ… èª²ç¨‹å…§å®¹ç”ŸæˆæˆåŠŸï¼';

            } catch (error) {
                console.error('Course generation error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
                preview.innerHTML = `<p style="text-align: center; color: #d32f2f; padding: 40px;">ç”Ÿæˆå¤±æ•—: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“ ç”Ÿæˆèª²ç¨‹ Generate Course';
            }
        }

        // é¡¯ç¤ºèª²ç¨‹å…§å®¹
        function displayCourseContent(course) {
            const preview = document.getElementById('coursePreview');
            
            // å°‡Markdownæ ¼å¼çš„å…§å®¹è½‰æ›ç‚ºHTMLé¡¯ç¤º
            const contentHTML = formatCourseContent(course.content);
            
            preview.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h2 style="color: #333; border-bottom: 2px solid #87CEEB; padding-bottom: 10px;">
                        ${course.title}
                    </h2>
                    <div style="margin-top: 20px; line-height: 1.8;">
                        ${contentHTML}
                    </div>
                </div>
            `;
        }

        // æ ¼å¼åŒ–èª²ç¨‹å…§å®¹ï¼ˆç°¡åŒ–ç‰ˆMarkdownè½‰HTMLï¼‰
        function formatCourseContent(content) {
            let html = content
                // æ¨™é¡Œè½‰æ›
                .replace(/^### (.+)$/gm, '<h4 style="color: #555; margin-top: 20px;">$1</h4>')
                .replace(/^## (.+)$/gm, '<h3 style="color: #444; margin-top: 25px;">$1</h3>')
                .replace(/^# (.+)$/gm, '<h2 style="color: #333; margin-top: 30px;">$1</h2>')
                // ç²—é«”
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                // åˆ—è¡¨é …
                .replace(/^[-*] (.+)$/gm, '<li style="margin-left: 20px;">$1</li>')
                // æ›è¡Œ
                .replace(/\n\n/g, '<br><br>');
            
            return html;
        }

        // ä¸‹è¼‰Wordæ–‡æª”
        async function downloadWord() {
            if (!generatedCourseData) {
                alert('è«‹å…ˆç”Ÿæˆèª²ç¨‹å…§å®¹');
                return;
            }

            const status = document.getElementById('courseStatus');
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ“„ æ­£åœ¨ç”Ÿæˆ Word æ–‡æª”...';

            try {
                const response = await fetch('/api/export-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseData: generatedCourseData,
                        format: 'word'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Word å°å‡ºå¤±æ•—');
                }

                // ä¸‹è¼‰æ–‡ä»¶
                window.location.href = data.downloadUrl;

                status.className = 'success';
                status.innerHTML = 'âœ… Word æ–‡æª”å·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸‹è¼‰...';

            } catch (error) {
                console.error('Word export error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
            }
        }

        // ä¸‹è¼‰PDFæ–‡æª”
        async function downloadPDF() {
            if (!generatedCourseData) {
                alert('è«‹å…ˆç”Ÿæˆèª²ç¨‹å…§å®¹');
                return;
            }

            const status = document.getElementById('courseStatus');
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ“• æ­£åœ¨ç”Ÿæˆ PDF æ–‡æª”...';

            try {
                const response = await fetch('/api/export-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseData: generatedCourseData,
                        format: 'pdf'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'PDF å°å‡ºå¤±æ•—');
                }

                // ä¸‹è¼‰æ–‡ä»¶
                window.location.href = data.downloadUrl;

                status.className = 'success';
                status.innerHTML = 'âœ… PDF æ–‡æª”å·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸‹è¼‰...';

            } catch (error) {
                console.error('PDF export error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
            }
        }
    </script>
    
    <!-- å¼•å…¥å¤šèªè¨€ç¿»è­¯ç³»çµ± -->
    <script src="/js/translations.js"></script>
    <script>
        // åˆå§‹åŒ–æ™‚æ‡‰ç”¨èªè¨€è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            updatePageLanguage();
        });
    </script>
</body>
</html>