<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Platform Baby Toy Content Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        /* èªè¨€åˆ‡æ›å™¨æ¨£å¼ */
        .language-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }
        
        .language-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .language-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .language-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.4);
        }
        
        .language-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            min-width: 180px;
            z-index: 1000;
        }
        
        .language-menu.active {
            display: block;
        }
        
        .language-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .language-option:hover {
            background: #f0f8ff;
        }
        
        .language-option.active {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
        }
        
        .header h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .header p {
            color: #666;
            font-size: 18px;
        }
        
        /* åˆ†é åˆ‡æ›æ¨£å¼ */
        .tab-navigation {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 12px 30px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #87CEEB;
            background: white;
            color: #87CEEB;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.3);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border-color: transparent;
        }
        
        .page-content {
            display: none;
        }
        
        .page-content.active {
            display: block;
        }
        
        .workflow-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .input-panel, .output-panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 30px;
        }
        
        .panel-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }
        
        .form-group input:not([type="checkbox"]):not([type="radio"]),
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #87CEEB;
        }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-top: 10px;
            width: 100%;
        }
        
        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            transition: all 0.3s;
            cursor: pointer;
            min-height: 60px;
            box-sizing: border-box;
            width: 100%;
        }
        
        .checkbox-item label {
            flex: 1;
            font-size: 14px;
            cursor: pointer;
            line-height: 1.4;
            word-wrap: break-word;
            overflow-wrap: break-word;
            display: block;
            width: 100%;
        }
        
        .checkbox-item:hover {
            border-color: #87CEEB;
            background: #f8f9fa;
        }
        
        .checkbox-item input[type="radio"],
        .checkbox-item input[type="checkbox"] {
            width: auto;
            flex: 0 0 auto;
            margin: 0;
        }
        
        .file-upload {
            border: 2px dashed #e1e5e9;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: border-color 0.3s;
            cursor: pointer;
        }
        
        .file-upload:hover {
            border-color: #87CEEB;
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .image-preview-container {
            display: none;
            margin-top: 15px;
            padding: 15px;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        .image-preview-container.show {
            display: block;
        }
        
        .image-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            background: white;
            border: 2px solid #e1e5e9;
        }
        
        .image-preview-item img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            display: block;
        }
        
        .image-preview-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-preview-item .remove-btn:hover {
            background: rgba(255, 0, 0, 1);
        }
        
        .selected-count {
            margin-top: 10px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #87CEEB;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-container {
            display: none;
            margin-top: 30px;
        }
        
        .platform-result {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .platform-result h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .platform-result .content {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }
        
        .platform-result .hashtags {
            color: #007bff;
            font-weight: 500;
        }
        
        .hashtags-bilingual {
            margin-top: 15px;
            color: #1976d2;
            font-size: 0.9em;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }
        
        .bilingual-content .language-section {
            padding: 12px;
            margin: 8px 0;
            border-left: 4px solid #e0e0e0;
            background: #fafafa;
            border-radius: 0 8px 8px 0;
        }
        
        .bilingual-analysis {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .bilingual-analysis .language-section {
            padding: 8px;
            margin: 4px 0;
            border-left: 3px solid #e0e0e0;
            background: #ffffff;
            border-radius: 0 6px 6px 0;
        }
        
        .platform-result .image-preview {
            max-width: 100%;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .analysis-section {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .analysis-section h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .pain-point, .scenario {
            background: white;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 8px;
            border-left: 4px solid #87CEEB;
        }
        
        /* å°è©±è¦–çª—æ¨£å¼ */
        .chat-advisor-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 25px;
            margin-top: 20px;
            display: none;
        }
        
        .chat-advisor-container.active {
            display: block;
        }
        
        .chat-header {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e1e5e9;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .chat-messages {
            height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .chat-message {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }
        
        .chat-message.user {
            flex-direction: row-reverse;
        }
        
        .chat-message-content {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 15px;
            line-height: 1.5;
        }
        
        .chat-message.ai .chat-message-content {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
        }
        
        .chat-message.user .chat-message-content {
            background: white;
            color: #333;
            border: 2px solid #e1e5e9;
        }
        
        .chat-message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }
        
        .chat-message.ai .chat-message-avatar {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
        }
        
        .chat-message.user .chat-message-avatar {
            background: #e1e5e9;
        }
        
        .suggested-questions {
            margin-bottom: 15px;
            padding: 15px;
            background: #fff3cd;
            border-radius: 10px;
            border-left: 4px solid #ffc107;
        }
        
        .suggested-questions h4 {
            margin-bottom: 10px;
            color: #856404;
            font-size: 14px;
        }
        
        .suggested-question-btn {
            display: block;
            width: 100%;
            text-align: left;
            padding: 10px 15px;
            margin-bottom: 8px;
            background: white;
            border: 1px solid #ffc107;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            color: #856404;
        }
        
        .suggested-question-btn:hover {
            background: #ffc107;
            color: white;
            transform: translateX(5px);
        }
        
        .chat-input-area {
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }
        
        .chat-input-wrapper {
            flex: 1;
            position: relative;
        }
        
        .chat-input {
            width: 100%;
            padding: 12px 100px 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 14px;
            resize: none;
            font-family: inherit;
            max-height: 100px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #87CEEB;
        }
        
        .chat-file-upload-btn {
            position: absolute;
            right: 50px;
            bottom: 8px;
            background: #f0f0f0;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 18px;
        }
        
        .chat-file-upload-btn:hover {
            background: #87CEEB;
            color: white;
        }
        
        .chat-send-btn {
            background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }
        
        .chat-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(135, 206, 235, 0.4);
        }
        
        .chat-send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .chat-file-preview {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .chat-file-item {
            background: #f0f0f0;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .chat-file-remove {
            cursor: pointer;
            color: #999;
            font-weight: bold;
        }
        
        .chat-file-remove:hover {
            color: #ff4444;
        }
        
        @media (max-width: 768px) {
            .workflow-container {
                grid-template-columns: 1fr;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .checkbox-item {
                min-height: 70px;
                padding: 12px;
            }
            
            .checkbox-item label {
                font-size: 13px;
                line-height: 1.3;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <!-- èªè¨€åˆ‡æ›å™¨ -->
            <div class="language-switcher">
                <div class="language-dropdown">
                    <button class="language-btn" onclick="toggleLanguageMenu()">
                        ğŸŒ <span id="currentLanguageDisplay">ç¹é«”ä¸­æ–‡</span> â–¼
                    </button>
                    <div class="language-menu" id="languageMenu">
                        <div class="language-option active" onclick="selectLanguage('zh-TW')">
                            ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡
                        </div>
                        <div class="language-option" onclick="selectLanguage('en')">
                            ğŸ‡¬ğŸ‡§ English
                        </div>
                        <div class="language-option" onclick="selectLanguage('vi')">
                            ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t
                        </div>
                    </div>
                </div>
            </div>
            
            <img id="brandLogo" src="" alt="Brand Logo" style="max-height: 120px; margin-bottom: 15px; border-radius: 10px; display: none;">
            <h1 id="brandTitle" data-i18n="app_title">ğŸ§¸ Googoogaga Multi-Platform Generator</h1>
            <p id="brandSlogan" data-i18n="app_subtitle_line1">CÃ¹ng bÃ© khÃ¡m phÃ¡ tháº¿ giá»›i diá»‡u ká»³ má»—i ngÃ y</p>
            <p data-i18n="app_subtitle_line2">AI é©…å‹•çš„å¤šå¹³å°å¬°å¹¼å…’ç©å…·è¡ŒéŠ·å…§å®¹ç”Ÿæˆå™¨</p>
            
            <!-- åˆ†é åˆ‡æ›å°èˆª -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchPage('page1')">
                    <span data-i18n="tab_image_generation">ğŸ¨ AI åœ–ç‰‡ç”Ÿæˆ</span>
                </button>
                <button class="tab-btn" onclick="switchPage('page2')">
                    <span data-i18n="tab_ads_advisor">ğŸ“Š AI å»£å‘Šé¡§å•</span>
                </button>
                <button class="tab-btn" onclick="switchPage('page3')">
                    <span data-i18n="tab_course_editor">ğŸ“š AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶</span>
                </button>
                <button class="tab-btn" onclick="switchPage('page4')">
                    <span data-i18n="tab_prompt_architect">ğŸ“ AI æŒ‡ä»¤æ¶æ§‹å¸«</span>
                </button>
            </div>
        </div>
        
        <!-- Page 1: AI åœ–ç‰‡ç”Ÿæˆ -->
        <div id="page1" class="page-content active">
        <div class="workflow-container">
            <div class="input-panel">
                <h2 class="panel-title">ğŸ“ <span data-i18n="product_info_input">ç”¢å“è³‡è¨Šè¼¸å…¥</span></h2>
                
                <form id="productForm">
                    <div class="form-group">
                        <label for="industryCategory" data-i18n="industry_category">ç”¢æ¥­é¡åˆ¥ / Industry Category</label>
                        <select id="industryCategory" name="industryCategory" required>
                            <option value="mother-kids" data-i18n="industry_mother_kids">ğŸ‘¶ Mother & Kids (æ¯å¬°ç”¨å“)</option>
                            <option value="fashion" data-i18n="industry_fashion">ğŸ‘— Fashion (æ™‚å°šæœé£¾)</option>
                            <option value="art-toy" data-i18n="industry_art_toy">ğŸ¨ Art Toy (è—è¡“ç©å…·)</option>
                            <option value="others" data-i18n="industry_others">âœ¨ Others (å…¶ä»–)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="productName" data-i18n="product_name">ç”¢å“åç¨± / Product Name</label>
                        <input type="text" id="productName" name="productName" data-i18n-placeholder="product_name_placeholder" placeholder="è¼¸å…¥ç”¢å“åç¨±" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="productDescription" data-i18n="product_description">ç”¢å“æè¿° (å¯é¸)</label>
                        <textarea id="productDescription" name="productDescription" data-i18n-placeholder="product_description_placeholder" placeholder="æè¿°ç”¢å“ç‰¹è‰²ã€åŠŸèƒ½ã€é©ç”¨å¹´é½¡ç­‰..." rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="image_upload">ç”¢å“åœ–ç‰‡ / Product Image (æ”¯æŒ1-5å¼µåœ–ç‰‡åŒæ™‚ä¸Šå‚³)</label>
                        <div class="file-upload" onclick="document.getElementById('imageUpload').click()">
                            <input type="file" id="imageUpload" accept="image/*" multiple>
                            <p data-i18n="image_upload_text">ğŸ“¸ ä¸Šå‚³ç©å…·åœ–ç‰‡ (Upload toy images - æœ€å¤š5å¼µ)</p>
                            <small data-i18n="image_upload_hint">æ”¯æ´ JPG, PNG (æ¯å¼µæœ€å¤§ 10MBï¼Œæœ€å¤š5å¼µåœ–ç‰‡)</small>
                        </div>
                        <div id="imagePreviewContainer" class="image-preview-container"></div>
                        <div id="selectedImageCount" class="selected-count" style="display: none;"></div>
                    </div>
                    
                    <div class="form-group">
                        <label data-i18n="target_platform">ç›®æ¨™å¹³å° / Target Platforms</label>
                        <div class="checkbox-group" id="platformsGroup">
                            <!-- Platforms will be loaded dynamically -->
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="language">å…§å®¹èªè¨€ / Content Language</label>
                        <select id="language" name="language">
                            <option value="zh-TW">ç¹é«”ä¸­æ–‡ (Traditional Chinese)</option>
                            <option value="vi">Tiáº¿ng Viá»‡t (Vietnamese)</option>
                            <option value="bilingual">é›™èª (Bilingual)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="generateImages" name="generateImages" onchange="toggleScenarioOptions()">
                            <span data-i18n="generate_image_checkbox">è‡ªå‹•ç”Ÿæˆè¡ŒéŠ·åœ–ç‰‡ (Generate Marketing Images)</span>
                        </label>
                    </div>
                    
                    <!-- æ¨¡ç‰¹å…’å’Œå ´æ™¯è¨­å®šé¸é … -->
                    <div class="form-group" id="modelSceneOptionsGroup" style="display: none;">
                        <h4 style="color: #FF6B4A; margin-bottom: 15px;">ğŸ‘¥ <span data-i18n="model_settings">æ¨¡ç‰¹å…’è¨­å®š</span></h4>
                        
                        <div class="form-group">
                            <label for="modelNationality" data-i18n="model_nationality">æ¨¡ç‰¹å…’åœ‹ç±</label>
                            <select id="modelNationality" name="modelNationality">
                                <option value="taiwan" data-i18n="nationality_taiwan">å°ç£</option>
                                <option value="usa" data-i18n="nationality_usa">ç¾åœ‹</option>
                                <option value="russia" data-i18n="nationality_russia">ä¿„ç¾…æ–¯</option>
                                <option value="brazil" data-i18n="nationality_brazil">å·´è¥¿</option>
                                <option value="custom" data-i18n="nationality_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customNationalityInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customNationalityText" placeholder="è«‹è¼¸å…¥æ¨¡ç‰¹å…’åœ‹ç±æˆ–ç¨®æ—æè¿° (ä¾‹å¦‚: æ—¥æœ¬ã€éŸ“åœ‹ã€æ··è¡€ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_nationality_placeholder">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="modelCombination" data-i18n="model_combination">äººç‰©çµ„åˆ</label>
                            <select id="modelCombination" name="modelCombination">
                                <option value="parents_baby" data-i18n="combination_parents_baby">çˆ¸åª½èˆ‡å¬°å…’</option>
                                <option value="mom_baby" data-i18n="combination_mom_baby">åª½åª½èˆ‡å¬°å…’</option>
                                <option value="dad_baby" data-i18n="combination_dad_baby">çˆ¸çˆ¸èˆ‡å¬°å…’</option>
                                <option value="couple" data-i18n="combination_couple">å¤«å¦»</option>
                                <option value="custom" data-i18n="combination_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customCombinationInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customCombinationText" placeholder="è«‹è¼¸å…¥äººç‰©çµ„åˆæè¿° (ä¾‹å¦‚: ç¥–çˆ¶æ¯èˆ‡å­«å­ã€ä¸‰ä»£åŒå ‚ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_combination_placeholder">
                            </div>
                        </div>
                        
                        <h4 style="color: #4ECDC4; margin-top: 20px; margin-bottom: 15px;">ğŸŒ <span data-i18n="scene_settings">å ´æ™¯è¨­å®š</span></h4>
                        
                        <div class="form-group">
                            <label for="sceneLocation" data-i18n="scene_location">å ´æ™¯åœ°é»</label>
                            <select id="sceneLocation" name="sceneLocation">
                                <option value="city" data-i18n="location_city">åŸå¸‚</option>
                                <option value="beach" data-i18n="location_beach">æµ·é‚Š</option>
                                <option value="mountain" data-i18n="location_mountain">å±±å€</option>
                                <option value="park" data-i18n="location_park">å…¬åœ’</option>
                                <option value="custom" data-i18n="location_custom">è‡ªå®šç¾©</option>
                            </select>
                            <div id="customLocationInput" style="display: none; margin-top: 10px;">
                                <input type="text" id="customLocationText" placeholder="è«‹è¼¸å…¥å ´æ™¯åœ°é»æè¿° (ä¾‹å¦‚: å’–å•¡å»³ã€éŠæ¨‚å ´ã€æ£®æ—ç­‰)" style="width: 100%; padding: 10px; border: 2px solid #e1e5e9; border-radius: 8px; font-size: 14px;" data-i18n-placeholder="custom_location_placeholder">
                            </div>
                        </div>
                    </div>
                    
                    <!-- å ´æ™¯é¸æ“‡é¸é … -->
                    <div class="form-group" id="scenarioOptionsGroup" style="display: none;">
                        <label data-i18n="usage_scenario_selection">ä½¿ç”¨å ´æ™¯é¸æ“‡ / Usage Scenario Selection</label>
                        <div class="checkbox-group" id="scenarioGroup">
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_parent_child" name="scenarioType" value="è¦ªå­äº’å‹•" checked>
                                <label for="scenario_parent_child">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ <span data-i18n="scenario_parent_child">è¦ªå­äº’å‹• (Parent-Child Interaction)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_child_solo" name="scenarioType" value="å°å­©å–®äººä½¿ç”¨">
                                <label for="scenario_child_solo">ğŸ§’ <span data-i18n="scenario_child_solo">å°å­©å–®äººä½¿ç”¨ (Child Solo Play)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_outdoor_travel" name="scenarioType" value="å¤–å‡ºæ—…éŠ">
                                <label for="scenario_outdoor_travel">ğŸŒ <span data-i18n="scenario_outdoor_travel">å¤–å‡ºæ—…éŠ (Outdoor Travel)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_home_play" name="scenarioType" value="å±…å®¶éŠæˆ²">
                                <label for="scenario_home_play">ğŸ  <span data-i18n="scenario_home_play">å±…å®¶éŠæˆ² (Home Play)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_personal_styling" name="scenarioType" value="å€‹äººç©¿æ­">
                                <label for="scenario_personal_styling">ğŸ‘” <span data-i18n="scenario_personal_styling">å€‹äººç©¿æ­ (Personal Styling)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_office_home_decor" name="scenarioType" value="è¾¦å…¬å®¤/å±…å®¶ä½ˆç½®">
                                <label for="scenario_office_home_decor">ğŸ¢ <span data-i18n="scenario_office_home_decor">è¾¦å…¬å®¤/å±…å®¶ä½ˆç½® (Office/Home Decoration)</span></label>
                            </div>
                            <div class="checkbox-item">
                                <input type="radio" id="scenario_other" name="scenarioType" value="å…¶ä»–">
                                <label for="scenario_other">âœ¨ <span data-i18n="scenario_other">å…¶ä»– (Other Creative)</span></label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" id="analyzeBtn">
                        ğŸ§  <span data-i18n="analyze_generate_button">åˆ†æç”¢å“ä¸¦ç”Ÿæˆå…§å®¹</span>
                    </button>
                    
                    <button type="button" class="btn" id="switchScenarioBtn" style="display: none; background: #28a745;">
                        ğŸ”„ <span data-i18n="switch_scenario_button">åˆ‡æ›å ´æ™¯é‡æ–°ç”Ÿæˆ (åŒç”¢å“ä¸åŒå¹³å°)</span>
                    </button>
                    
                    <button type="button" class="btn btn-secondary" id="generateScenariosBtn" style="display: none;">
                        ğŸ¬ <span data-i18n="generate_scenarios_button">ç”Ÿæˆè¡ŒéŠ·å ´æ™¯</span>
                    </button>
                </form>
                
                <div id="status" class="status"></div>
            </div>
            
            <div class="output-panel">
                <h2 class="panel-title">ğŸ“Š <span data-i18n="ai_analysis_result">AI åˆ†æçµæœ</span></h2>
                <div id="analysisResults">
                    <p style="text-align: center; color: #666; padding: 40px;">
                        ä¸Šå‚³ç”¢å“åœ–ç‰‡ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                    </p>
                </div>
            </div>
        </div>
        
        <div class="results-container" id="resultsContainer">
            <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px;">
                <h2 class="panel-title">ğŸ¯ å¤šå¹³å°å…§å®¹ç”Ÿæˆçµæœ</h2>
                <div id="platformResults"></div>
            </div>
        </div>
        
        <div class="scenarios-container" id="scenariosContainer" style="display: none;">
            <div style="background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); padding: 30px; margin-top: 30px;">
                <h2 class="panel-title">ğŸ¬ AI ç”Ÿæˆè¡ŒéŠ·å ´æ™¯</h2>
                <div id="scenarioResults"></div>
            </div>
        </div>
        </div>
        <!-- End of Page 1 -->

        <!-- Page 2: AI å»£å‘Šé¡§å• -->
        <div id="page2" class="page-content">
            <div class="workflow-container">
                <!-- å·¦å´ï¼šè³‡æ–™è¼¸å…¥å€ -->
                <div class="input-panel">
                    <h2 class="panel-title">ğŸ“¤ <span data-i18n="data_input_area">è³‡æ–™è¼¸å…¥å€</span></h2>
                    
                    <form id="adsAnalysisForm">
                        <div class="form-group">
                            <label for="brandName" data-i18n="brand_name">å“ç‰Œåç¨± / Brand Name (é¸å¡«)</label>
                            <input type="text" id="brandName" name="brandName" data-i18n-placeholder="brand_name_placeholder" placeholder="è¼¸å…¥å“ç‰Œåç¨±">
                        </div>
                        
                        <div class="form-group">
                            <label for="adProductName" data-i18n="product_name_optional">ç”¢å“åç¨± / Product Name (é¸å¡«)</label>
                            <input type="text" id="adProductName" name="adProductName" data-i18n-placeholder="product_name_optional_placeholder" placeholder="è¼¸å…¥ç”¢å“åç¨±">
                        </div>
                        
                        <div class="form-group">
                            <label for="coreProduct" data-i18n="core_product">æ ¸å¿ƒç”¢å“ / Core Product (é¸å¡«)</label>
                            <textarea id="coreProduct" name="coreProduct" data-i18n-placeholder="core_product_placeholder" placeholder="æè¿°æ ¸å¿ƒç”¢å“ç‰¹è‰²..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="targetMarket" data-i18n="target_market">ç›®æ¨™èˆ‡å¸‚å ´ / Target Market (é¸å¡«)</label>
                            <textarea id="targetMarket" name="targetMarket" data-i18n-placeholder="target_market_placeholder" placeholder="æè¿°ç›®æ¨™å®¢ç¾¤èˆ‡å¸‚å ´å®šä½..." rows="2"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="file_upload">æª”æ¡ˆä¸Šå‚³ / File Upload (é¸å¡«ï¼Œæ”¯æ´ 1-10 å€‹æª”æ¡ˆ)</label>
                            <div class="file-upload" onclick="document.getElementById('adsFileUpload').click()">
                                <input type="file" id="adsFileUpload" accept="image/*,.pdf,.xlsx,.xls,.doc,.docx,.csv" multiple>
                                <p data-i18n="file_upload_text">ğŸ“ ä¸Šå‚³å»£å‘Šè³‡æ–™æª”æ¡ˆ</p>
                                <small data-i18n="file_upload_hint">æ”¯æ´ Image, PDF, Excel, Word, CSV (æ¯å€‹æª”æ¡ˆæœ€å¤§ 10MBï¼Œæœ€å¤š10å€‹æª”æ¡ˆ)</small>
                            </div>
                            <div id="adsFilePreviewContainer" class="image-preview-container"></div>
                            <div id="selectedAdsFileCount" class="selected-count" style="display: none;"></div>
                        </div>
                        
                        <div class="form-group">
                            <label data-i18n="platform_selection">å¹³å°å‹¾é¸ / Platform Selection</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_tiktok" name="adsPlatform" value="TikTok">
                                    <label for="platform_tiktok" data-i18n="platform_tiktok">ğŸ“± TikTok Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_shopee" name="adsPlatform" value="Shopee">
                                    <label for="platform_shopee" data-i18n="platform_shopee">ğŸ›ï¸ Shopee Ads</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_meta" name="adsPlatform" value="Meta">
                                    <label for="platform_meta" data-i18n="platform_meta">ğŸ‘¥ Meta Ads (Facebook/Instagram)</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="platform_zalo" name="adsPlatform" value="Zalo">
                                    <label for="platform_zalo" data-i18n="platform_zalo">ğŸ’¬ Zalo Ads</label>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn" id="analyzeAdsBtn">
                            ğŸ§  <span data-i18n="start_analysis">é–‹å§‹åˆ†æ (Start Analysis)</span>
                        </button>
                    </form>
                    
                    <div id="adsStatus" class="status"></div>
                    
                    <!-- AI å»£å‘Šé¡§å•å°è©±è¦–çª— -->
                    <div class="chat-advisor-container" id="chatAdvisorContainer">
                        <div class="chat-header">
                            ğŸ’¬ <span data-i18n="chat_advisor_title">AI å»£å‘Šé¡§å•å°è©±</span>
                        </div>
                        
                        <!-- å»ºè­°å•é¡Œå€ -->
                        <div class="suggested-questions" id="suggestedQuestions" style="display: none;">
                            <h4 data-i18n="ai_suggested_questions">AI å»ºè­°çš„å•é¡Œï¼š</h4>
                            <div id="suggestedQuestionsList"></div>
                        </div>
                        
                        <!-- å°è©±è¨Šæ¯å€ -->
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-message ai">
                                <div class="chat-message-avatar">ğŸ¤–</div>
                                <div class="chat-message-content">
                                    æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI å»£å‘Šé¡§å•ã€‚å®Œæˆå»£å‘Šåˆ†æå¾Œï¼Œæˆ‘æœƒç‚ºæ‚¨æä¾›ä¸‰å€‹å°ˆæ¥­å•é¡Œå¹«åŠ©æ‚¨æ·±å…¥æ€è€ƒï¼Œæ‚¨ä¹Ÿå¯ä»¥éš¨æ™‚å‘æˆ‘æå•æˆ–ä¸Šå‚³æ›´å¤šè³‡æ–™é€²è¡Œåˆ†æã€‚
                                </div>
                            </div>
                        </div>
                        
                        <!-- å°è©±è¼¸å…¥å€ -->
                        <div class="chat-input-area">
                            <div class="chat-input-wrapper">
                                <div class="chat-file-preview" id="chatFilePreview"></div>
                                <textarea 
                                    class="chat-input" 
                                    id="chatInput" 
                                    placeholder="è¼¸å…¥æ‚¨çš„å•é¡Œ..." 
                                    rows="1"
                                    data-i18n-placeholder="chat_placeholder"
                                ></textarea>
                                <input type="file" id="chatFileUpload" accept="image/*,.pdf,.xlsx,.xls,.doc,.docx,.csv" multiple style="display: none;">
                                <button class="chat-file-upload-btn" onclick="document.getElementById('chatFileUpload').click()" title="ä¸Šå‚³æª”æ¡ˆ">
                                    ğŸ“
                                </button>
                            </div>
                            <button class="chat-send-btn" id="chatSendBtn" onclick="sendChatMessage()">
                                â¤
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- å³å´ï¼šAI åˆ†æçµæœå€ -->
                <div class="output-panel">
                    <h2 class="panel-title">ğŸ¤– <span data-i18n="ai_analysis_results_area">AI åˆ†æçµæœå€</span></h2>
                    <div id="adsAnalysisResults">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            ä¸Šå‚³å»£å‘Šè³‡æ–™ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                        </p>
                    </div>
                    
                    <!-- å ±å‘Šæ“ä½œæŒ‰éˆ• -->
                    <div id="reportActions" style="display: none; margin-top: 20px; text-align: center; gap: 10px;">
                        <button class="btn" onclick="exportPDF()" style="background: #28a745;">
                            ğŸ“„ åŒ¯å‡º PDF
                        </button>
                        <button class="btn btn-secondary" onclick="reanalyze()">
                            ğŸ”„ é‡æ–°åˆ†æ
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Page 2 -->

        <!-- Page 3: AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶ -->
        <div id="page3" class="page-content">
            <div class="workflow-container">
                <!-- å·¦å´ï¼šèª²ç¨‹åƒæ•¸è¨­å®š -->
                <div class="input-panel">
                    <h2 class="panel-title">ğŸ“š <span data-i18n="course_parameters">èª²ç¨‹åƒæ•¸è¨­å®š</span></h2>
                    
                    <form id="courseForm">
                        <!-- 1. ç›®æ¨™å¹´é½¡ -->
                        <div class="form-group">
                            <label for="targetAge" data-i18n="target_age">ç›®æ¨™å¹´é½¡</label>
                            <select id="targetAge" name="targetAge" onchange="handleAgeChange()" required>
                                <option value="3-5">3-5 æ­²</option>
                                <option value="6-8">6-8 æ­²</option>
                                <option value="9-11">9-11 æ­²</option>
                                <option value="12-14">12-14 æ­²</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="number" id="customAgeText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥å¹´é½¡æ•¸å­—" min="1" max="18">
                        </div>

                        <!-- 2. èª²ç¨‹é¡åˆ¥ -->
                        <div class="form-group">
                            <label for="category" data-i18n="category">èª²ç¨‹é¡åˆ¥</label>
                            <select id="category" name="category" onchange="updateTopicOptions(); handleCategoryChange()" required>
                                <option value="social">ç¤¾æœƒ Social</option>
                                <option value="science">è‡ªç„¶ Science</option>
                                <option value="math">æ•¸å­¸ Math</option>
                                <option value="language">èªæ–‡ Language</option>
                                <option value="art">è—è¡“ Art</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customCategoryText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©ç§‘åˆ¥">
                        </div>

                        <!-- 3. èª²ç¨‹ä¸»é¡Œ -->
                        <div class="form-group">
                            <label for="topic" data-i18n="topic">èª²ç¨‹ä¸»é¡Œ</label>
                            <select id="topic" name="topic" onchange="handleTopicChange()" required>
                                <option value="å®¶åº­">å®¶åº­</option>
                                <option value="äº¤é€šå·¥å…·">äº¤é€šå·¥å…·</option>
                                <option value="ç¤¾æœƒè§’è‰²">ç¤¾æœƒè§’è‰²</option>
                                <option value="æ–‡åŒ–ç¯€æ—¥">æ–‡åŒ–ç¯€æ—¥</option>
                                <option value="å®‰å…¨æ•™è‚²">å®‰å…¨æ•™è‚²</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customTopicText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©ä¸»é¡Œ">
                        </div>

                        <!-- 4. èª²ç¨‹æ™‚é•· -->
                        <div class="form-group">
                            <label for="duration" data-i18n="duration">èª²ç¨‹æ™‚é•·</label>
                            <select id="duration" name="duration" onchange="handleDurationChange()" required>
                                <option value="30">30 åˆ†é˜</option>
                                <option value="60">60 åˆ†é˜</option>
                                <option value="90">90 åˆ†é˜</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="number" id="customDurationText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥æ™‚é–“ (åˆ†é˜)" min="10" max="240">
                        </div>

                        <!-- 5. æ•™å­¸é¢¨æ ¼ -->
                        <div class="form-group">
                            <label for="style" data-i18n="style">æ•™å­¸é¢¨æ ¼</label>
                            <select id="style" name="style" onchange="handleStyleChange()" required>
                                <option value="story-based">æ•…äº‹å¼•å°å¼ Story-based</option>
                                <option value="picture-book">æ’ç•«ç¹ªæœ¬é¢¨ Picture-book</option>
                                <option value="singapore-style">æ€è¾¨å¼ Singapore-style</option>
                                <option value="gamified">éŠæˆ²åŒ– Gamified</option>
                                <option value="montessori">Montessori è’™å¼</option>
                                <option value="custom">è‡ªå®šç¾© (Custom)</option>
                            </select>
                            <input type="text" id="customStyleText" style="display: none; margin-top: 10px;" placeholder="è«‹è¼¸å…¥è‡ªå®šç¾©é¢¨æ ¼">
                        </div>

                        <!-- 6. è¼¸å‡ºæ ¼å¼ (å¤šé¸) -->
                        <div class="form-group">
                            <label data-i18n="output_types">è¼¸å‡ºæ ¼å¼ (å¯å¤šé¸)</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="outline" name="outputTypes" value="outline" checked>
                                    <label for="outline">ğŸ“‹ èª²ç¶± Outline</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="lessonPlan" name="outputTypes" value="lessonPlan">
                                    <label for="lessonPlan">ğŸ“ æ•™æ¡ˆ Lesson Plan</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="story" name="outputTypes" value="story">
                                    <label for="story">ğŸ“– æ•…äº‹ Story-based Content</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="worksheet" name="outputTypes" value="worksheet">
                                    <label for="worksheet">âœï¸ Worksheet ç·´ç¿’é¡Œ</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="slides" name="outputTypes" value="slides">
                                    <label for="slides">ğŸ–¼ï¸ Slides (PPT Script)</label>
                                </div>
                            </div>
                        </div>

                        <!-- 7. å…§å®¹èªè¨€ -->
                        <div class="form-group">
                            <label for="courseLanguage" data-i18n="course_language">å…§å®¹èªè¨€</label>
                            <select id="courseLanguage" name="courseLanguage" required>
                                <option value="chinese">ä¸­æ–‡ Chinese</option>
                                <option value="english">è‹±æ–‡ English</option>
                                <option value="vietnamese">è¶Šæ–‡ Vietnamese</option>
                                <option value="chinese-english">ä¸­è‹±é›™èª Chinese-English</option>
                                <option value="english-vietnamese">è‹±è¶Šé›™èª English-Vietnamese</option>
                                <option value="trilingual">ä¸‰èªç‰ˆ Trilingual (ä¸­è‹±è¶Š)</option>
                            </select>
                        </div>

                        <!-- 8. AI æ’åœ–ç”Ÿæˆ -->
                        <div class="form-group">
                            <label for="includeImages" data-i18n="include_images">AI æ’åœ–ç”Ÿæˆ</label>
                            <select id="includeImages" name="includeImages" required>
                                <option value="yes">æ˜¯ Yes (ä½¿ç”¨ Nano Banana)</option>
                                <option value="no" selected>å¦ No</option>
                            </select>
                        </div>

                        <!-- ç”ŸæˆæŒ‰éˆ• -->
                        <button type="button" class="btn" id="generateCourseBtn" onclick="generateCourse()">
                            ğŸ“ <span data-i18n="generate_course_btn">ç”Ÿæˆèª²ç¨‹å…§å®¹</span>
                        </button>
                    </form>
                </div>

                <!-- å³å´ï¼šèª²ç¨‹é è¦½èˆ‡ä¸‹è¼‰ -->
                <div class="output-panel">
                    <h2 class="panel-title">ğŸ“– <span data-i18n="course_preview">èª²ç¨‹å…§å®¹é è¦½</span></h2>
                    
                    <div id="coursePreview" style="max-height: 600px; overflow-y: auto; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                        <p style="text-align: center; color: #666; padding: 40px;">
                            é¸æ“‡èª²ç¨‹åƒæ•¸ä¸¦é»æ“Šç”ŸæˆæŒ‰éˆ•é–‹å§‹ AI èª²ç¨‹ç·¨è¼¯
                        </p>
                    </div>

                    <!-- ä¸‹è¼‰æŒ‰éˆ•å€åŸŸ -->
                    <div id="downloadActions" style="display: none; margin-top: 20px; text-align: center; gap: 10px;">
                        <button class="btn" onclick="downloadWord()" style="background: #2b579a;">
                            ğŸ“„ <span data-i18n="download_word">ä¸‹è¼‰ Word</span>
                        </button>
                        <button class="btn" onclick="downloadPDF()" style="background: #d32f2f;">
                            ğŸ“• <span data-i18n="download_pdf">ä¸‹è¼‰ PDF</span>
                        </button>
                    </div>

                    <!-- ç‹€æ…‹é¡¯ç¤º -->
                    <div id="courseStatus" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
                </div>
            </div>
        </div>
        <!-- End of Page 3 -->

        <!-- Page 4: BizPrompt Architect Pro (AI æŒ‡ä»¤æ¶æ§‹å¸«) -->
        <div id="page4" class="page-content">
            <div class="workflow-container" style="grid-template-columns: 1fr 1fr;">
                <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
                <div class="input-panel">
                    <h2 class="panel-title">ğŸ“ <span data-i18n="prompt_architect_title">BizPrompt Architect Pro</span></h2>
                    <p style="color: #666; margin-bottom: 20px;" data-i18n="prompt_architect_subtitle">å…¨æ–¹ä½ AI æŒ‡ä»¤æ¶æ§‹å¸« - è®“æ‚¨ç”¢å‡ºå°ˆå®¶ç´š Prompt</p>
                    
                    <!-- ä¸‰æ…‹åˆ‡æ›ç³»çµ± -->
                    <div class="mode-tabs" style="display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap;">
                        <button type="button" class="mode-tab active" onclick="switchPromptMode('business')" id="modeTabBusiness" style="flex: 1; min-width: 100px; padding: 12px 15px; border: 2px solid #87CEEB; background: linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%); color: white; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ğŸ‘¨â€ğŸ’¼ å•†æ¥­é¡§å•
                        </button>
                        <button type="button" class="mode-tab" onclick="switchPromptMode('coding')" id="modeTabCoding" style="flex: 1; min-width: 100px; padding: 12px 15px; border: 2px solid #87CEEB; background: white; color: #87CEEB; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ğŸ’» è»Ÿé«”é–‹ç™¼
                        </button>
                        <button type="button" class="mode-tab" onclick="switchPromptMode('image')" id="modeTabImage" style="flex: 1; min-width: 100px; padding: 12px 15px; border: 2px solid #87CEEB; background: white; color: #87CEEB; border-radius: 10px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
                            ğŸ¨ è¦–è¦ºç¹ªåœ–
                        </button>
                    </div>

                    <!-- ==================== å•†æ¥­é¡§å•æ¨¡å¼ ==================== -->
                    <div id="businessMode" class="prompt-mode active" style="display: block;">
                        <form id="businessPromptForm">
                            <!-- L1: é ˜åŸŸé¸æ“‡ -->
                            <div class="form-group">
                                <label for="bizDomain">ğŸ¢ L1 é ˜åŸŸ (Domain)</label>
                                <select id="bizDomain" onchange="updateBizIndustry()" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="">-- è«‹é¸æ“‡é ˜åŸŸ --</option>
                                    <option value="marketing">å¸‚å ´è¡ŒéŠ· Marketing</option>
                                    <option value="strategy">ä¼æ¥­æˆ°ç•¥ Strategy</option>
                                    <option value="sales">æ¥­å‹™éŠ·å”® Sales</option>
                                    <option value="product">ç”¢å“ç®¡ç† Product</option>
                                    <option value="finance">è²¡å‹™åˆ†æ Finance</option>
                                    <option value="hr">äººåŠ›è³‡æº HR</option>
                                    <option value="custom">â• è‡ªå®šç¾© Custom</option>
                                </select>
                                <input type="text" id="bizDomainCustom" placeholder="è¼¸å…¥è‡ªå®šç¾©é ˜åŸŸ..." style="display: none; margin-top: 10px; width: 100%; padding: 12px; border: 2px solid #87CEEB; border-radius: 8px;">
                            </div>

                            <!-- L2: è¡Œæ¥­é¸æ“‡ -->
                            <div class="form-group">
                                <label for="bizIndustry">ğŸ­ L2 è³½é“ (Industry)</label>
                                <select id="bizIndustry" onchange="updateBizRole()" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="">-- è«‹å…ˆé¸æ“‡é ˜åŸŸ --</option>
                                </select>
                                <input type="text" id="bizIndustryCustom" placeholder="è¼¸å…¥è‡ªå®šç¾©è¡Œæ¥­..." style="display: none; margin-top: 10px; width: 100%; padding: 12px; border: 2px solid #87CEEB; border-radius: 8px;">
                            </div>

                            <!-- L3: è§’è‰²é¸æ“‡ -->
                            <div class="form-group">
                                <label for="bizRole">ğŸ‘¤ L3 è§’è‰² (Role)</label>
                                <select id="bizRole" onchange="updateBizFramework()" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="">-- è«‹å…ˆé¸æ“‡è¡Œæ¥­ --</option>
                                </select>
                                <input type="text" id="bizRoleCustom" placeholder="è¼¸å…¥è‡ªå®šç¾©è§’è‰²..." style="display: none; margin-top: 10px; width: 100%; padding: 12px; border: 2px solid #87CEEB; border-radius: 8px;">
                            </div>

                            <!-- L4: æ¨¡å‹/æ¡†æ¶é¸æ“‡ -->
                            <div class="form-group">
                                <label for="bizFramework">ğŸ§  L4 æ¨¡å‹ (Framework)</label>
                                <select id="bizFramework" onchange="handleFrameworkChange()" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="">-- è«‹å…ˆé¸æ“‡è§’è‰² --</option>
                                </select>
                                <input type="text" id="bizFrameworkCustom" placeholder="è¼¸å…¥è‡ªå®šç¾©æ¨¡å‹/æ¡†æ¶..." style="display: none; margin-top: 10px; width: 100%; padding: 12px; border: 2px solid #87CEEB; border-radius: 8px;">
                            </div>

                            <!-- å…·é«”ä»»å‹™è¼¸å…¥ -->
                            <div class="form-group">
                                <label for="bizContext">ğŸ“‹ å…·é«”ä»»å‹™æè¿° (Context)</label>
                                <textarea id="bizContext" rows="4" placeholder="æè¿°æ‚¨æƒ³è§£æ±ºçš„å•†æ¥­å•é¡Œæˆ–ä»»å‹™ç›®æ¨™..." style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                            </div>

                            <button type="button" id="bizGenerateBtn" class="btn" onclick="generateBusinessPrompt()" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                ğŸš€ ç”Ÿæˆå°ˆæ¥­ Prompt
                            </button>
                        </form>
                    </div>

                    <!-- ==================== è»Ÿé«”é–‹ç™¼æ¨¡å¼ ==================== -->
                    <div id="codingMode" class="prompt-mode" style="display: none;">
                        <form id="codingPromptForm">
                            <div class="form-group">
                                <label for="codingInput">ğŸ’» æè¿°æ‚¨çš„è»Ÿé«”éœ€æ±‚</label>
                                <p style="color: #888; font-size: 13px; margin-bottom: 10px;">ä¾‹å¦‚ï¼šã€Œåšä¸€å€‹åƒ Uber çš„ Appã€ã€ã€Œæˆ‘éœ€è¦ä¸€å€‹é›»å•†ç¶²ç«™å¾Œå°ç®¡ç†ç³»çµ±ã€</p>
                                <textarea id="codingInput" rows="6" placeholder="ç”¨è‡ªç„¶èªè¨€æè¿°æ‚¨æƒ³é–‹ç™¼çš„è»Ÿé«”åŠŸèƒ½..." style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                            </div>

                            <!-- åƒè€ƒè³‡æ–™ä¸Šå‚³å€ -->
                            <div class="form-group" style="background: linear-gradient(135deg, rgba(33, 150, 243, 0.05) 0%, rgba(3, 169, 244, 0.05) 100%); padding: 15px; border-radius: 10px; border: 1px dashed #2196F3;">
                                <label style="color: #1976D2; font-size: 14px; margin-bottom: 10px; display: block;" data-i18n="ref_upload_label">ğŸ“ åƒè€ƒè³‡æ–™ (é¸å¡«)</label>
                                <p style="color: #888; font-size: 12px; margin-bottom: 12px;" data-i18n="ref_upload_hint">ä¸Šå‚³åƒè€ƒåœ–ç‰‡ã€æ–‡ä»¶æˆ–è²¼ä¸Šç¶²å€ï¼ŒAI å°‡åˆ†æå¾Œç”Ÿæˆæ›´ç²¾æº–çš„æç¤ºè©</p>
                                
                                <!-- ä¸Šå‚³å€åŸŸ -->
                                <div id="codingUploadZone" class="upload-drop-zone" 
                                     ondragover="handleDragOver(event, 'coding')" 
                                     ondragleave="handleDragLeave(event, 'coding')" 
                                     ondrop="handleDrop(event, 'coding')"
                                     style="border: 2px dashed #90CAF9; border-radius: 10px; padding: 20px; text-align: center; background: #fff; transition: all 0.3s; cursor: pointer;"
                                     onclick="document.getElementById('codingFileInput').click()">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <span style="font-size: 32px;">ğŸ“</span>
                                        <span style="color: #666; font-size: 13px;" data-i18n="ref_drop_hint">æ‹–æ”¾æª”æ¡ˆåˆ°æ­¤è™•ï¼Œæˆ–é»æ“Šä¸Šå‚³</span>
                                        <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                                            <span style="background: #E3F2FD; color: #1976D2; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ–¼ï¸ åœ–ç‰‡</span>
                                            <span style="background: #E8F5E9; color: #388E3C; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“„ PDF</span>
                                            <span style="background: #FFF3E0; color: #F57C00; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“Š Excel</span>
                                            <span style="background: #E3F2FD; color: #1565C0; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“ Word</span>
                                            <span style="background: #FCE4EC; color: #C2185B; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“½ï¸ PPT</span>
                                            <span style="background: #F3E5F5; color: #7B1FA2; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“‹ MD</span>
                                        </div>
                                    </div>
                                    <input type="file" id="codingFileInput" multiple accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.md,.txt" style="display: none;" onchange="handleFileSelect(event, 'coding')">
                                </div>
                                
                                <!-- ç¶²å€è¼¸å…¥ -->
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <input type="text" id="codingUrlInput" placeholder="è²¼ä¸Šåƒè€ƒç¶²å€ (ä¾‹å¦‚: https://example.com)..." style="flex: 1; padding: 10px 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 13px;" data-i18n-placeholder="ref_url_placeholder">
                                    <button type="button" onclick="addUrlReference('coding')" style="padding: 10px 15px; background: #2196F3; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px;">
                                        ğŸ”— <span data-i18n="ref_add_url">åŠ å…¥</span>
                                    </button>
                                </div>
                                
                                <!-- å·²ä¸Šå‚³é …ç›®é è¦½ -->
                                <div id="codingUploadedItems" style="margin-top: 12px; display: none;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;" data-i18n="ref_uploaded_items">ğŸ“‹ å·²åŠ å…¥çš„åƒè€ƒè³‡æ–™ï¼š</div>
                                    <div id="codingUploadedList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="codingPlatform">ğŸ¯ ç›®æ¨™å¹³å°</label>
                                <select id="codingPlatform" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="web">Web ç¶²é æ‡‰ç”¨</option>
                                    <option value="mobile">Mobile App</option>
                                    <option value="desktop">Desktop æ¡Œé¢æ‡‰ç”¨</option>
                                    <option value="api">API / Backend</option>
                                    <option value="fullstack">Full Stack å…¨ç«¯</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="codingComplexity">ğŸ“Š è¤‡é›œåº¦</label>
                                <select id="codingComplexity" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="mvp">MVP æœ€å°å¯è¡Œç”¢å“</option>
                                    <option value="standard">Standard æ¨™æº–åŠŸèƒ½</option>
                                    <option value="enterprise">Enterprise ä¼æ¥­ç´š</option>
                                </select>
                            </div>

                            <button type="button" class="btn" onclick="generateCodingPrompt()" id="codingGenerateBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #2196F3 0%, #03A9F4 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                ğŸ¤– AI è½‰è­¯ç‚ºçµæ§‹åŒ– PRD
                            </button>
                        </form>
                    </div>

                    <!-- ==================== è¦–è¦ºç¹ªåœ–æ¨¡å¼ ==================== -->
                    <div id="imageMode" class="prompt-mode" style="display: none;">
                        <form id="imagePromptForm">
                            <div class="form-group">
                                <label for="imageInput" data-i18n="img_desc_label">ğŸ¨ æè¿°æ‚¨æƒ³ç”Ÿæˆçš„ç•«é¢</label>
                                <p style="color: #888; font-size: 13px; margin-bottom: 10px;" data-i18n="img_desc_hint">ä¾‹å¦‚ï¼šã€Œå¤ªç©ºä¸­çš„è²“ã€ã€ã€Œæ—¥è½æ™‚åˆ†çš„æµ·é‚Šå’–å•¡å»³ã€ã€ã€Œæœªä¾†åŸå¸‚çš„éœ“è™¹è¡—æ™¯ã€</p>
                                <textarea id="imageInput" rows="5" data-i18n-placeholder="img_desc_placeholder" placeholder="ç”¨è‡ªç„¶èªè¨€æè¿°æ‚¨æƒ³è¦çš„ç•«é¢..." style="width: 100%; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; resize: vertical;"></textarea>
                            </div>

                            <!-- åƒè€ƒè³‡æ–™ä¸Šå‚³å€ -->
                            <div class="form-group" style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.05) 0%, rgba(233, 30, 99, 0.05) 100%); padding: 15px; border-radius: 10px; border: 1px dashed #9C27B0;">
                                <label style="color: #7B1FA2; font-size: 14px; margin-bottom: 10px; display: block;" data-i18n="ref_upload_label">ğŸ“ åƒè€ƒè³‡æ–™ (é¸å¡«)</label>
                                <p style="color: #888; font-size: 12px; margin-bottom: 12px;" data-i18n="ref_upload_hint_image">ä¸Šå‚³åƒè€ƒåœ–ç‰‡æˆ–è²¼ä¸Šç¶²å€ï¼ŒAI å°‡åˆ†æé¢¨æ ¼/æ§‹åœ–å¾Œç”Ÿæˆæ›´ç²¾æº–çš„æç¤ºè©</p>
                                
                                <!-- ä¸Šå‚³å€åŸŸ -->
                                <div id="imageUploadZone" class="upload-drop-zone" 
                                     ondragover="handleDragOver(event, 'image')" 
                                     ondragleave="handleDragLeave(event, 'image')" 
                                     ondrop="handleDrop(event, 'image')"
                                     style="border: 2px dashed #CE93D8; border-radius: 10px; padding: 20px; text-align: center; background: #fff; transition: all 0.3s; cursor: pointer;"
                                     onclick="document.getElementById('imageFileInput').click()">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <span style="font-size: 32px;">ğŸ–¼ï¸</span>
                                        <span style="color: #666; font-size: 13px;" data-i18n="ref_drop_hint">æ‹–æ”¾æª”æ¡ˆåˆ°æ­¤è™•ï¼Œæˆ–é»æ“Šä¸Šå‚³</span>
                                        <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: center;">
                                            <span style="background: #F3E5F5; color: #7B1FA2; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ–¼ï¸ JPG/PNG</span>
                                            <span style="background: #FCE4EC; color: #C2185B; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ¨ WEBP/GIF</span>
                                            <span style="background: #E8F5E9; color: #388E3C; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“„ PDF</span>
                                            <span style="background: #E3F2FD; color: #1976D2; padding: 3px 8px; border-radius: 12px; font-size: 11px;">ğŸ“ æ–‡ä»¶</span>
                                        </div>
                                    </div>
                                    <input type="file" id="imageFileInput" multiple accept="image/*,.pdf,.doc,.docx,.md,.txt" style="display: none;" onchange="handleFileSelect(event, 'image')">
                                </div>
                                
                                <!-- ç¶²å€è¼¸å…¥ -->
                                <div style="margin-top: 12px; display: flex; gap: 8px;">
                                    <input type="text" id="imageUrlInput" placeholder="è²¼ä¸Šåƒè€ƒåœ–ç‰‡ç¶²å€ (ä¾‹å¦‚: https://example.com/image.jpg)..." style="flex: 1; padding: 10px 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 13px;" data-i18n-placeholder="ref_url_placeholder_image">
                                    <button type="button" onclick="addUrlReference('image')" style="padding: 10px 15px; background: #9C27B0; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 13px;">
                                        ğŸ”— <span data-i18n="ref_add_url">åŠ å…¥</span>
                                    </button>
                                </div>
                                
                                <!-- å·²ä¸Šå‚³é …ç›®é è¦½ -->
                                <div id="imageUploadedItems" style="margin-top: 12px; display: none;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 8px;" data-i18n="ref_uploaded_items">ğŸ“‹ å·²åŠ å…¥çš„åƒè€ƒè³‡æ–™ï¼š</div>
                                    <div id="imageUploadedList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="imageModel" data-i18n="img_model_label">ğŸ¤– ç›®æ¨™åœ–åƒæ¨¡å‹</label>
                                <p style="color: #888; font-size: 13px; margin-bottom: 10px;" data-i18n="img_model_hint">é¸æ“‡æ‚¨è¦ä½¿ç”¨çš„ AI ç¹ªåœ–å¹³å°ï¼Œç³»çµ±æœƒç”Ÿæˆè©²å¹³å°å°ˆå±¬æ ¼å¼çš„æç¤ºè©</p>
                                <select id="imageModel" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;" onchange="toggleCustomModelInput()">
                                    <option value="nanobanana" data-i18n="img_model_nanobanana">Nano Banana (FLUX)</option>
                                    <option value="gpt" data-i18n="img_model_gpt">GPT (DALL-E 3)</option>
                                    <option value="midjourney" data-i18n="img_model_mj">Midjourney (MJ)</option>
                                    <option value="custom" data-i18n="img_model_custom">è‡ªå®šç¾© Custom</option>
                                </select>
                                <input type="text" id="customModelName" data-i18n-placeholder="img_model_custom_placeholder" placeholder="è¼¸å…¥è‡ªå®šç¾©æ¨¡å‹åç¨±æˆ–å¹³å°..." style="display: none; margin-top: 10px; width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                            </div>

                            <div class="form-group">
                                <label for="imageStyle" data-i18n="img_style_label">ğŸ–¼ï¸ è—è¡“é¢¨æ ¼</label>
                                <select id="imageStyle" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="photorealistic">å¯«å¯¦æ”å½± Photorealistic</option>
                                    <option value="anime">å‹•æ¼«é¢¨æ ¼ Anime</option>
                                    <option value="oil-painting">æ²¹ç•«é¢¨æ ¼ Oil Painting</option>
                                    <option value="watercolor">æ°´å½©é¢¨æ ¼ Watercolor</option>
                                    <option value="3d-render">3D æ¸²æŸ“ 3D Render</option>
                                    <option value="cyberpunk">è³½åšé¾å…‹ Cyberpunk</option>
                                    <option value="minimalist">æ¥µç°¡é¢¨æ ¼ Minimalist</option>
                                    <option value="fantasy">å¥‡å¹»é¢¨æ ¼ Fantasy</option>
                                    <option value="vintage">å¾©å¤é¢¨æ ¼ Vintage</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="imageRatio">ğŸ“ ç•«é¢æ¯”ä¾‹</label>
                                <select id="imageRatio" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px;">
                                    <option value="1:1">1:1 (æ­£æ–¹å½¢ - Instagram)</option>
                                    <option value="16:9">16:9 (å¯¬è¢å¹• - YouTube)</option>
                                    <option value="9:16">9:16 (ç›´å¼ - Stories/Reels)</option>
                                    <option value="4:3">4:3 (å‚³çµ±æ¯”ä¾‹)</option>
                                    <option value="3:2">3:2 (æ”å½±æ¨™æº–)</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="imageQuality">âœ¨ å“è³ªæ¨™ç±¤</label>
                                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 8px;">
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="checkbox" id="imgQualityHD" checked> HD é«˜ç•«è³ª
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="checkbox" id="imgQuality8K"> 8K è¶…é«˜æ¸…
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="checkbox" id="imgQualityDetail" checked> é«˜ç´°ç¯€
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                        <input type="checkbox" id="imgQualityLighting"> å°ˆæ¥­å…‰å½±
                                    </label>
                                </div>
                            </div>

                            <!-- é€²éšé¸é …å€å¡Š -->
                            <div class="form-group" style="background: linear-gradient(135deg, rgba(156, 39, 176, 0.05) 0%, rgba(233, 30, 99, 0.05) 100%); padding: 15px; border-radius: 10px; border: 1px dashed #ccc;">
                                <label style="color: #666; font-size: 14px; margin-bottom: 12px; display: block;" data-i18n="img_advanced_options">âš™ï¸ é€²éšé¸é … (é¸å¡«)</label>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <!-- ç•«æ•¸/è¿­ä»£æ­¥æ•¸ -->
                                    <div>
                                        <label for="imageSteps" style="font-size: 13px; color: #555; margin-bottom: 5px; display: block;" data-i18n="img_steps_label">ğŸ”„ ç•«æ•¸ Steps</label>
                                        <select id="imageSteps" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 13px;">
                                            <option value="" data-i18n="img_steps_default">é è¨­ (ä¸æŒ‡å®š)</option>
                                            <option value="20">20 æ­¥ (å¿«é€Ÿ)</option>
                                            <option value="30">30 æ­¥ (æ¨™æº–)</option>
                                            <option value="50">50 æ­¥ (ç²¾ç´°)</option>
                                            <option value="75">75 æ­¥ (é«˜å“è³ª)</option>
                                            <option value="100">100 æ­¥ (æ¥µè‡´)</option>
                                            <option value="150">150 æ­¥ (å°ˆæ¥­)</option>
                                        </select>
                                    </div>
                                    
                                    <!-- è¼¸å‡ºåœ–ç‰‡æ ¼å¼ -->
                                    <div>
                                        <label for="imageFormat" style="font-size: 13px; color: #555; margin-bottom: 5px; display: block;" data-i18n="img_format_label">ğŸ“ è¼¸å‡ºæ ¼å¼</label>
                                        <select id="imageFormat" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 13px;">
                                            <option value="" data-i18n="img_format_default">é è¨­ (ä¸æŒ‡å®š)</option>
                                            <option value="png">PNG (ç„¡æã€é€æ˜)</option>
                                            <option value="jpg">JPG/JPEG (å£“ç¸®)</option>
                                            <option value="webp">WebP (ç¶²é å„ªåŒ–)</option>
                                            <option value="tiff">TIFF (å°åˆ·å“è³ª)</option>
                                            <option value="bmp">BMP (ç„¡å£“ç¸®)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <button type="button" class="btn" onclick="generateImagePrompt()" id="imageGenerateBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #9C27B0 0%, #E91E63 100%); color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;">
                                ğŸ¨ AI ç”Ÿæˆç¹ªåœ–æŒ‡ä»¤
                            </button>
                        </form>
                    </div>
                </div>

                <!-- å³å´ï¼šçµæœè¼¸å‡ºå€ -->
                <div class="output-panel">
                    <h2 class="panel-title">ğŸ¯ <span data-i18n="generated_prompt">ç”Ÿæˆçš„å°ˆæ¥­ Prompt</span></h2>
                    
                    <div id="promptResult" style="max-height: 500px; overflow-y: auto; padding: 20px; background: #1e1e1e; border-radius: 10px; color: #d4d4d4; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; line-height: 1.6; white-space: pre-wrap;">
                        <p style="text-align: center; color: #888; padding: 40px;">
é¸æ“‡æ¨¡å¼ä¸¦å¡«å¯«åƒæ•¸å¾Œï¼Œé»æ“Šç”ŸæˆæŒ‰éˆ•ç²å–å°ˆæ¥­ Prompt
                        </p>
                    </div>

                    <!-- å·¥å…·æŒ‰éˆ•å€åŸŸ -->
                    <div id="promptActions" style="display: none; margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="copyPromptToClipboard()" style="padding: 12px 25px; background: linear-gradient(135deg, #4CAF50 0%, #8BC34A 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            ğŸ“‹ ä¸€éµè¤‡è£½
                        </button>
                        <button class="btn" onclick="exportPromptToWord()" style="padding: 12px 25px; background: linear-gradient(135deg, #2b579a 0%, #4a7cc9 100%); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                            ğŸ“„ å°å‡º Word
                        </button>
                    </div>

                    <!-- ç‹€æ…‹æç¤º -->
                    <div id="promptStatus" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none; text-align: center;"></div>

                    <!-- ä½¿ç”¨èªªæ˜ -->
                    <div style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 10px;">
                        <h4 style="color: #333; margin-bottom: 15px;">ğŸ’¡ ä½¿ç”¨èªªæ˜</h4>
                        <ul style="color: #666; font-size: 13px; line-height: 1.8; padding-left: 20px;">
                            <li><strong>å•†æ¥­é¡§å•æ¨¡å¼</strong>ï¼šé€é 4 å±¤ç´šé¸å–®ï¼Œå°‡æ¨¡ç³Šå•é¡Œè½‰åŒ–ç‚ºå¸¶æœ‰å°ˆæ¥­æ¨¡å‹çš„æŒ‡ä»¤</li>
                            <li><strong>è»Ÿé«”é–‹ç™¼æ¨¡å¼</strong>ï¼šè¼¸å…¥éœ€æ±‚ï¼ŒAI è‡ªå‹•ç”Ÿæˆçµæ§‹åŒ– PRD èˆ‡æŠ€è¡“æ£§è¦æ ¼</li>
                            <li><strong>è¦–è¦ºç¹ªåœ–æ¨¡å¼</strong>ï¼šæè¿°ç•«é¢ï¼ŒAI ç”Ÿæˆ Midjourney/DALL-E å°ˆç”¨åƒæ•¸åŒ–æŒ‡ä»¤</li>
                            <li>ç”Ÿæˆå¾Œå¯<strong>ä¸€éµè¤‡è£½</strong>åˆ° ChatGPTã€Gemini æˆ–ç¹ªåœ–å·¥å…·ä½¿ç”¨</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Page 4 -->

    </div>

    <script>
        let uploadedImagePath = null;
        let productAnalysis = null;
        let painPointsAnalysis = null;
        let generatedContent = null;
        
        const form = document.getElementById('productForm');
        const statusDiv = document.getElementById('status');
        const fileUpload = document.getElementById('imageUpload');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const generateScenariosBtn = document.getElementById('generateScenariosBtn');
        
        // File upload handling - Multi-image support
        let selectedFiles = [];
        
        fileUpload.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            
            // Limit to maximum 5 files
            if (files.length > 5) {
                alert('æœ€å¤šåªèƒ½é¸æ“‡5å¼µåœ–ç‰‡');
                files.splice(5);
                
                // Reset the input to selected files
                const dt = new DataTransfer();
                files.forEach(file => dt.items.add(file));
                e.target.files = dt.files;
            }
            
            selectedFiles = files;
            updateFileUploadDisplay();
            updateImagePreview();
        });
        
        function updateFileUploadDisplay() {
            const uploadText = fileUpload.parentElement.querySelector('p');
            
            if (selectedFiles.length === 0) {
                uploadText.textContent = 'ğŸ“¸ ä¸Šå‚³ç©å…·åœ–ç‰‡ (Upload toy images - æœ€å¤š5å¼µ)';
            } else if (selectedFiles.length === 1) {
                uploadText.textContent = `å·²é¸æ“‡: ${selectedFiles[0].name}`;
            } else {
                uploadText.textContent = `å·²é¸æ“‡: ${selectedFiles.length} å¼µåœ–ç‰‡`;
            }
        }
        
        function updateImagePreview() {
            const previewContainer = document.getElementById('imagePreviewContainer');
            const countDisplay = document.getElementById('selectedImageCount');
            
            if (selectedFiles.length === 0) {
                previewContainer.classList.remove('show');
                countDisplay.style.display = 'none';
                return;
            }
            
            previewContainer.classList.add('show');
            countDisplay.style.display = 'block';
            countDisplay.textContent = `å·²é¸æ“‡ ${selectedFiles.length}/5 å¼µåœ–ç‰‡`;
            
            let html = '<div class="image-preview-grid">';
            
            selectedFiles.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.querySelector(`[data-file-index="${index}"]`);
                    if (previewItem) {
                        previewItem.querySelector('img').src = e.target.result;
                    }
                };
                reader.readAsDataURL(file);
                
                html += `
                    <div class="image-preview-item" data-file-index="${index}">
                        <img src="" alt="é è¦½åœ–ç‰‡ ${index + 1}">
                        <button class="remove-btn" onclick="removeImage(${index})">Ã—</button>
                    </div>
                `;
            });
            
            html += '</div>';
            previewContainer.innerHTML = html;
        }
        
        function removeImage(index) {
            selectedFiles.splice(index, 1);
            
            // Update the file input
            const dt = new DataTransfer();
            selectedFiles.forEach(file => dt.items.add(file));
            fileUpload.files = dt.files;
            
            updateFileUploadDisplay();
            updateImagePreview();
        }
        
        // Custom input box display/hide handling
        const modelNationalitySelect = document.getElementById('modelNationality');
        const customNationalityInput = document.getElementById('customNationalityInput');
        const modelCombinationSelect = document.getElementById('modelCombination');
        const customCombinationInput = document.getElementById('customCombinationInput');
        const sceneLocationSelect = document.getElementById('sceneLocation');
        const customLocationInput = document.getElementById('customLocationInput');
        
        if (modelNationalitySelect && customNationalityInput) {
            modelNationalitySelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customNationalityInput.style.display = 'block';
                } else {
                    customNationalityInput.style.display = 'none';
                }
            });
        }
        
        if (modelCombinationSelect && customCombinationInput) {
            modelCombinationSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customCombinationInput.style.display = 'block';
                } else {
                    customCombinationInput.style.display = 'none';
                }
            });
        }
        
        if (sceneLocationSelect && customLocationInput) {
            sceneLocationSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    customLocationInput.style.display = 'block';
                } else {
                    customLocationInput.style.display = 'none';
                }
            });
        }
        
        // Status display
        function showStatus(message, type) {
            statusDiv.innerHTML = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }
        
        // Loading state management
        function setLoading(isLoading) {
            analyzeBtn.disabled = isLoading;
            if (isLoading) {
                analyzeBtn.innerHTML = '<span class="loading"></span>AI åˆ†æä¸­...';
            } else {
                analyzeBtn.innerHTML = 'ğŸ§  åˆ†æç”¢å“ä¸¦ç”Ÿæˆå…§å®¹';
            }
        }
        
        // Main form submission
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            setLoading(true);
            
            try {
                const formData = new FormData();
                const industryCategory = document.getElementById('industryCategory').value;
                const productName = document.getElementById('productName').value;
                const productDescription = document.getElementById('productDescription').value;
                const imageFiles = Array.from(document.getElementById('imageUpload').files);
                const language = document.getElementById('language').value;
                const generateImages = document.getElementById('generateImages').checked;
                
                // ç²å–å ´æ™¯é¡å‹é¸æ“‡
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                }
                
                // ç²å–æ¨¡ç‰¹å…’å’Œå ´æ™¯è¨­å®š
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                if (generateImages) {
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                // Get selected platforms
                const selectedPlatforms = Array.from(document.querySelectorAll('#platformsGroup input[type="checkbox"]:checked')).map(cb => cb.value);
                
                if (selectedPlatforms.length === 0) {
                    throw new Error('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹ç›®æ¨™å¹³å°');
                }
                
                // Step 1: Upload images if provided
                let uploadedImagePaths = [];
                if (imageFiles.length > 0) {
                    showStatus(`ğŸ“¤ ä¸Šå‚³ ${imageFiles.length} å¼µåœ–ç‰‡ä¸­...`, 'info');
                    const imageFormData = new FormData();
                    
                    // Append all image files
                    imageFiles.forEach((file, index) => {
                        imageFormData.append('images', file);
                    });
                    imageFormData.append('productName', productName);
                    imageFormData.append('productDescription', productDescription || '');
                    
                    const imageResponse = await fetch('/api/upload-image', {
                        method: 'POST',
                        body: imageFormData
                    });
                    
                    if (!imageResponse.ok) {
                        throw new Error('åœ–ç‰‡ä¸Šå‚³å¤±æ•—');
                    }
                    
                    const imageResult = await imageResponse.json();
                    uploadedImagePaths = imageResult.paths || [];
                    uploadedImagePath = uploadedImagePaths[0]; // For backward compatibility
                }
                
                // Step 2: AI Product Analysis  
                if (uploadedImagePaths.length > 0 || productDescription) {
                    showStatus(`ğŸ§  AI ç”¢å“åˆ†æä¸­... (${language})`, 'info');
                    console.log('ğŸŒ Selected language for analysis:', language);
                    
                    const analysisResponse = await fetch('/api/analyze-product', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            imagePaths: uploadedImagePaths,
                            imagePath: uploadedImagePaths[0], // For backward compatibility
                            productInfo: {
                                name: productName,
                                description: productDescription,
                                industryCategory: industryCategory
                            },
                            language: language
                        })
                    });
                    
                    if (analysisResponse.ok) {
                        const analysisResult = await analysisResponse.json();
                        productAnalysis = analysisResult.productAnalysis;
                        painPointsAnalysis = analysisResult.painPointsAnalysis;
                        
                        displayAnalysisResults(productAnalysis, painPointsAnalysis);
                    } else {
                        showStatus('âš ï¸ AI åˆ†æå¤±æ•—ï¼Œä½¿ç”¨åŸºç¤æ¨¡å¼ç”Ÿæˆå…§å®¹', 'info');
                    }
                }
                
                // Step 3: Generate platform content
                showStatus('ğŸ¯ ç”Ÿæˆå¤šå¹³å°å…§å®¹ä¸­...', 'info');
                
                const contentResponse = await fetch('/api/generate-platform-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis || {
                            name: productName,
                            description: productDescription,
                            productType: productName,
                            industryCategory: industryCategory
                        },
                        painPointsAnalysis: painPointsAnalysis || {},
                        platforms: selectedPlatforms,
                        language: language,
                        generateImages: generateImages,
                        scenarioType: scenarioType,
                        productImagePath: uploadedImagePath,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!contentResponse.ok) {
                    throw new Error('å…§å®¹ç”Ÿæˆå¤±æ•—');
                }
                
                const contentResult = await contentResponse.json();
                generatedContent = contentResult.results;
                displayPlatformResults(contentResult.results);
                showStatus('âœ… å¤šå¹³å°å…§å®¹ç”Ÿæˆå®Œæˆï¼', 'success');
                
                // Show scenario generation and switch scenario buttons
                generateScenariosBtn.style.display = 'block';
                document.getElementById('switchScenarioBtn').style.display = 'block';
                
            } catch (error) {
                showStatus(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        });
        
        // Scenario generation button handler
        generateScenariosBtn.addEventListener('click', async function() {
            if (!productAnalysis || !generatedContent) {
                showStatus('âš ï¸ è«‹å…ˆå®Œæˆç”¢å“åˆ†æå’Œå…§å®¹ç”Ÿæˆ', 'error');
                return;
            }
            
            try {
                showStatus('ğŸ¬ AI ç”Ÿæˆè¡ŒéŠ·å ´æ™¯ä¸­...', 'info');
                generateScenariosBtn.disabled = true;
                generateScenariosBtn.innerHTML = '<span class="loading"></span>å ´æ™¯ç”Ÿæˆä¸­...';
                
                // é‡æ–°ç²å–å ´æ™¯é¡å‹é¸æ“‡å’Œæ¨¡ç‰¹å…’å ´æ™¯è¨­å®š
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                const generateImages = document.getElementById('generateImages').checked;
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                const scenarioResponse = await fetch('/api/generate-scenarios', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis,
                        contentData: generatedContent,
                        productImagePath: uploadedImagePath,
                        scenarioType: scenarioType,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!scenarioResponse.ok) {
                    throw new Error('å ´æ™¯ç”Ÿæˆå¤±æ•—');
                }
                
                const scenarioResult = await scenarioResponse.json();
                displayScenariosResults(scenarioResult.scenarios);
                showStatus('âœ… è¡ŒéŠ·å ´æ™¯ç”Ÿæˆå®Œæˆï¼', 'success');
                
            } catch (error) {
                showStatus(`âŒ å ´æ™¯ç”ŸæˆéŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                generateScenariosBtn.disabled = false;
                generateScenariosBtn.innerHTML = 'ğŸ¬ ç”Ÿæˆè¡ŒéŠ·å ´æ™¯';
            }
        });
        
        // Switch scenario button handler - Quick platform switching without re-entering product info
        const switchScenarioBtn = document.getElementById('switchScenarioBtn');
        switchScenarioBtn.addEventListener('click', async function() {
            if (!productAnalysis || !painPointsAnalysis) {
                showStatus('âš ï¸ è«‹å…ˆå®Œæˆç”¢å“åˆ†æ', 'error');
                return;
            }
            
            try {
                // Get selected platforms
                const selectedPlatforms = Array.from(document.querySelectorAll('#platformsGroup input[type="checkbox"]:checked')).map(cb => cb.value);
                
                if (selectedPlatforms.length === 0) {
                    showStatus('âš ï¸ è«‹é¸æ“‡è‡³å°‘ä¸€å€‹ç›®æ¨™å¹³å°', 'error');
                    return;
                }
                
                const language = document.getElementById('language').value;
                const generateImages = document.getElementById('generateImages').checked;
                const industryCategory = document.getElementById('industryCategory').value;
                
                // ç²å–å ´æ™¯é¡å‹é¸æ“‡å’Œæ¨¡ç‰¹å…’å ´æ™¯è¨­å®š
                let scenarioType = 'è¦ªå­äº’å‹•'; // é è¨­å€¼
                let modelNationality = 'taiwan';
                let modelCombination = 'parents_baby';
                let sceneLocation = 'park';
                if (generateImages) {
                    const selectedScenario = document.querySelector('input[name="scenarioType"]:checked');
                    if (selectedScenario) {
                        scenarioType = selectedScenario.value;
                    }
                    modelNationality = document.getElementById('modelNationality').value;
                    modelCombination = document.getElementById('modelCombination').value;
                    sceneLocation = document.getElementById('sceneLocation').value;
                    
                    // Use custom text if "custom" is selected
                    if (modelNationality === 'custom') {
                        const customText = document.getElementById('customNationalityText').value.trim();
                        if (customText) {
                            modelNationality = customText;
                        }
                    }
                    if (modelCombination === 'custom') {
                        const customText = document.getElementById('customCombinationText').value.trim();
                        if (customText) {
                            modelCombination = customText;
                        }
                    }
                    if (sceneLocation === 'custom') {
                        const customText = document.getElementById('customLocationText').value.trim();
                        if (customText) {
                            sceneLocation = customText;
                        }
                    }
                }
                
                showStatus('ğŸ”„ ä½¿ç”¨ç›¸åŒç”¢å“è³‡è¨Šï¼Œåˆ‡æ›å¹³å°é‡æ–°ç”Ÿæˆå…§å®¹...', 'info');
                switchScenarioBtn.disabled = true;
                switchScenarioBtn.innerHTML = '<span class="loading"></span>é‡æ–°ç”Ÿæˆä¸­...';
                
                // Generate platform content with existing product analysis
                const contentResponse = await fetch('/api/generate-platform-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        productInfo: productAnalysis,
                        painPointsAnalysis: painPointsAnalysis,
                        platforms: selectedPlatforms,
                        language: language,
                        generateImages: generateImages,
                        scenarioType: scenarioType,
                        productImagePath: uploadedImagePath,
                        modelNationality: modelNationality,
                        modelCombination: modelCombination,
                        sceneLocation: sceneLocation
                    })
                });
                
                if (!contentResponse.ok) {
                    throw new Error('å…§å®¹ç”Ÿæˆå¤±æ•—');
                }
                
                const contentResult = await contentResponse.json();
                generatedContent = contentResult.results;
                displayPlatformResults(contentResult.results);
                showStatus('âœ… å ´æ™¯åˆ‡æ›æˆåŠŸï¼æ–°å¹³å°å…§å®¹å·²ç”Ÿæˆï¼', 'success');
                
            } catch (error) {
                showStatus(`âŒ å ´æ™¯åˆ‡æ›éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                switchScenarioBtn.disabled = false;
                switchScenarioBtn.innerHTML = 'ğŸ”„ åˆ‡æ›å ´æ™¯é‡æ–°ç”Ÿæˆ (åŒç”¢å“ä¸åŒå¹³å°)';
            }
        });
        
        // Display AI analysis results
        function displayAnalysisResults(productAnalysis, painPointsAnalysis) {
            const resultsDiv = document.getElementById('analysisResults');
            
            let html = '<div class="analysis-section">';
            html += `<h4>ğŸ§¸ ${t('product_analysis_result')}</h4>`;
            
            if (productAnalysis.productType) {
                html += `<p><strong>${t('product_type')}:</strong> ${productAnalysis.productType}</p>`;
            }
            if (productAnalysis.ageRange) {
                html += `<p><strong>${t('age_range')}:</strong> ${productAnalysis.ageRange}</p>`;
            }
            if (productAnalysis.educationalValue) {
                // Handle array or string format
                const eduValue = Array.isArray(productAnalysis.educationalValue) 
                    ? productAnalysis.educationalValue.join('ã€') 
                    : productAnalysis.educationalValue;
                html += `<p><strong>${t('educational_value')}:</strong> ${eduValue}</p>`;
            }
            if (productAnalysis.features) {
                html += `<p><strong>${t('product_features')}:</strong> ${Array.isArray(productAnalysis.features) ? productAnalysis.features.join('ã€') : productAnalysis.features}</p>`;
            }
            if (productAnalysis.safetyFeatures) {
                html += `<p><strong>${t('safety_features')}:</strong> ${Array.isArray(productAnalysis.safetyFeatures) ? productAnalysis.safetyFeatures.join('ã€') : productAnalysis.safetyFeatures}</p>`;
            }
            if (productAnalysis.materials) {
                html += `<p><strong>${t('materials')}:</strong> ${productAnalysis.materials}</p>`;
            }
            if (productAnalysis.colors) {
                html += `<p><strong>${t('colors')}:</strong> ${Array.isArray(productAnalysis.colors) ? productAnalysis.colors.join('ã€') : productAnalysis.colors}</p>`;
            }
            if (productAnalysis.usageScenarios) {
                html += `<p><strong>${t('usage_scenarios')}:</strong> ${Array.isArray(productAnalysis.usageScenarios) ? productAnalysis.usageScenarios.join('ã€') : productAnalysis.usageScenarios}</p>`;
            }
            
            html += '</div>';
            
            if (painPointsAnalysis.painPoints) {
                html += '<div class="analysis-section">';
                html += `<h4>ğŸ’¡ ${t('identified_pain_points')}</h4>`;
                painPointsAnalysis.painPoints.forEach(pain => {
                    // Check if bilingual format (contains /) 
                    if (pain.category && pain.category.includes('/')) {
                        const [zhCategory, viCategory] = pain.category.split('/');
                        const [zhDesc, viDesc] = pain.description ? pain.description.split('/') : ['', ''];
                        const [zhTarget, viTarget] = pain.targetAudience ? pain.targetAudience.split('/') : ['', ''];
                        const [zhSeverity, viSeverity] = pain.severity ? pain.severity.split('/') : ['', ''];
                        
                        html += `<div class="pain-point bilingual-analysis">
                            <div class="language-section">
                                <h6 style="color: #d32f2f; margin-bottom: 5px;">ğŸ‡¹ğŸ‡¼</h6>
                                <strong>${zhCategory.trim()}:</strong> ${zhDesc.trim()}
                                <br><small style="color: #666;">${t('target')}: ${zhTarget.trim()} (${zhSeverity.trim()})</small>
                            </div>
                            <div class="language-section" style="margin-top: 8px;">
                                <h6 style="color: #1976d2; margin-bottom: 5px;">ğŸ‡»ğŸ‡³</h6>
                                <strong>${viCategory.trim()}:</strong> ${viDesc.trim()}
                                <br><small style="color: #666;">${t('target')}: ${viTarget.trim()} (${viSeverity.trim()})</small>
                            </div>
                        </div>`;
                    } else {
                        html += `<div class="pain-point">
                            <strong>${pain.category}:</strong> ${pain.description}
                            <small style="color: #666;"> (${pain.severity})</small>
                        </div>`;
                    }
                });
                html += '</div>';
            }
            
            if (painPointsAnalysis.usageScenarios) {
                html += '<div class="analysis-section">';
                html += `<h4>ğŸ¬ ${t('usage_scenario_suggestions')}</h4>`;
                painPointsAnalysis.usageScenarios.forEach(scenario => {
                    // Check if bilingual format
                    if (scenario.scenario && scenario.scenario.includes('/')) {
                        const scenarioParts = scenario.scenario.split('/');
                        const zhScenario = scenarioParts[0] || '';
                        const viScenario = scenarioParts[1] || scenarioParts[0] || '';
                        
                        const contextParts = scenario.context ? scenario.context.split('/') : ['', ''];
                        const zhContext = contextParts[0] || '';
                        const viContext = contextParts[1] || contextParts[0] || '';
                        
                        const benefitsParts = scenario.benefits ? scenario.benefits.split('/') : ['', ''];
                        const zhBenefits = benefitsParts[0] || '';
                        const viBenefits = benefitsParts[1] || benefitsParts[0] || '';
                        
                        const emotionsParts = scenario.emotions ? scenario.emotions.split('/') : ['', ''];
                        const zhEmotions = emotionsParts[0] || '';
                        const viEmotions = emotionsParts[1] || emotionsParts[0] || '';
                        
                        html += `<div class="scenario bilingual-analysis">
                            <div class="language-section">
                                <h6 style="color: #d32f2f; margin-bottom: 5px;">ğŸ‡¹ğŸ‡¼</h6>
                                <strong>${zhScenario.trim()}:</strong> ${zhContext.trim()}
                                <br><small style="color: #28a745;">${zhBenefits.trim()}</small>
                                <br><small style="color: #ff9800;">${t('emotions')}: ${zhEmotions.trim()}</small>
                            </div>
                            <div class="language-section" style="margin-top: 8px;">
                                <h6 style="color: #1976d2; margin-bottom: 5px;">ğŸ‡»ğŸ‡³</h6>
                                <strong>${viScenario.trim()}:</strong> ${viContext.trim()}
                                <br><small style="color: #28a745;">${viBenefits.trim()}</small>
                                <br><small style="color: #ff9800;">${t('emotions')}: ${viEmotions.trim()}</small>
                            </div>
                        </div>`;
                    } else {
                        html += `<div class="scenario">
                            <strong>${scenario.scenario}:</strong> ${scenario.context}
                            <br><small style="color: #28a745;">${scenario.benefits}</small>
                        </div>`;
                    }
                });
                html += '</div>';
            }
            
            resultsDiv.innerHTML = html;
        }
        
        // åœ–ç‰‡ä¸‹è¼‰åŠŸèƒ½
        function downloadFile(filePath, filename) {
            try {
                const downloadUrl = `/api/download-image?path=${encodeURIComponent(filePath)}`;
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = filename || 'download';
                link.style.display = 'none';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus(`ğŸ“¥ æ­£åœ¨ä¸‹è¼‰: ${filename}`, 'info');
            } catch (error) {
                showStatus(`âŒ ä¸‹è¼‰å¤±æ•—: ${error.message}`, 'error');
            }
        }

        // Display platform-specific results with download functionality
        function displayPlatformResults(results) {
            const resultsContainer = document.getElementById('resultsContainer');
            const platformResults = document.getElementById('platformResults');
            
            let html = '';
            
            Object.entries(results).forEach(([platform, result]) => {
                const config = result.platformConfig || {};
                const content = result.content;
                
                html += `<div class="platform-result">
                    <h3>
                        ${getPlatformIcon(platform)} ${config.displayName || platform.toUpperCase()}
                        ${result.status === 'success' ? 'âœ…' : 'âš ï¸'}
                    </h3>`;
                
                if (result.status === 'success' && content) {
                    // Handle bilingual content format
                    if (typeof content.mainContent === 'object' && content.mainContent['zh-TW'] && content.mainContent['vi']) {
                        // Bilingual format
                        html += `<div class="content bilingual-content">
                            <div class="language-section">
                                <h5 style="color: #d32f2f; margin-bottom: 8px;">ğŸ‡¹ğŸ‡¼ ç¹é«”ä¸­æ–‡</h5>
                                <div>${content.mainContent['zh-TW']}</div>
                            </div>
                            <div class="language-section" style="margin-top: 15px;">
                                <h5 style="color: #1976d2; margin-bottom: 8px;">ğŸ‡»ğŸ‡³ Tiáº¿ng Viá»‡t</h5>
                                <div>${content.mainContent['vi']}</div>
                            </div>
                        </div>`;
                        
                        // Bilingual hashtags
                        if (content.hashtags && typeof content.hashtags === 'object') {
                            html += `<div class="hashtags-bilingual">
                                <div style="margin-bottom: 8px;">
                                    <strong>ğŸ‡¹ğŸ‡¼:</strong> ${content.hashtags['zh-TW']?.join(' ') || ''}
                                </div>
                                <div>
                                    <strong>ğŸ‡»ğŸ‡³:</strong> ${content.hashtags['vi']?.join(' ') || ''}
                                </div>
                            </div>`;
                        }
                        
                        // Bilingual CTA
                        if (content.cta && typeof content.cta === 'object') {
                            html += `<div style="margin-top: 10px;">
                                <div style="margin-bottom: 5px;"><strong>ğŸ‡¹ğŸ‡¼ CTA:</strong> ${content.cta['zh-TW'] || ''}</div>
                                <div><strong>ğŸ‡»ğŸ‡³ CTA:</strong> ${content.cta['vi'] || ''}</div>
                            </div>`;
                        }
                    } else {
                        // Standard single-language format
                        html += `<div class="content">${content.mainContent || content.rawContent}</div>`;
                        
                        if (content.hashtags && content.hashtags.length > 0) {
                            html += `<div class="hashtags">${content.hashtags.join(' ')}</div>`;
                        }
                        
                        if (content.cta) {
                            html += `<div style="margin-top: 10px;"><strong>CTA:</strong> ${content.cta}</div>`;
                        }
                    }
                    
                    // é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡æˆ–è¨­è¨ˆæè¿°ï¼ˆå¸¶ä¸‹è¼‰åŠŸèƒ½ï¼‰
                    if (result.generatedImageDescription) {
                        html += `<div style="margin-top: 15px; padding: 15px; background: #e3f2fd; border-radius: 8px;">`;
                        
                        if (result.isRealImage) {
                            html += `
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <strong>ğŸ¨ AI ç”Ÿæˆåœ–ç‰‡:</strong>
                                    <button onclick="downloadFile('${result.path}', '${platform}_generated_image.png')" 
                                            class="btn btn-small" style="background: #4CAF50; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">
                                        ğŸ“¥ ä¸‹è¼‰åœ–ç‰‡
                                    </button>
                                </div>
                                <small style="color: #1976d2;">âœ… çœŸå¯¦ AI åœ–ç‰‡å·²ç”Ÿæˆ (${Math.round(result.size/1024)}KB)</small>`;
                        } else {
                            html += `
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <strong>ğŸ“‹ å°ˆæ¥­è¨­è¨ˆè¦æ ¼:</strong>
                                    <button onclick="downloadFile('${result.path}', '${platform}_design_spec.md')" 
                                            class="btn btn-small" style="background: #2196F3; color: white; padding: 5px 10px; border: none; border-radius: 4px; cursor: pointer;">
                                        ğŸ“¥ ä¸‹è¼‰è¦æ ¼
                                    </button>
                                </div>
                                <small style="color: #666;">ğŸ“ å¯ç”¨æ–¼å°ˆæ¥­è¨­è¨ˆå·¥å…· (DALL-E, Midjourney, Stable Diffusion)</small>`;
                        }
                        
                        html += `</div>`;
                    }
                } else {
                    html += `<div class="content" style="color: #dc3545;">
                        éŒ¯èª¤: ${result.error}
                        <br>å‚™ç”¨å…§å®¹: ${result.fallback}
                    </div>`;
                }
                
                html += '</div>';
            });
            
            platformResults.innerHTML = html;
            resultsContainer.style.display = 'block';
        }
        
        function getPlatformIcon(platform) {
            const icons = {
                shopee: 'ğŸ›’',
                tiktok: 'ğŸµ',
                instagram: 'ğŸ“¸',
                facebook: 'ğŸ‘'
            };
            return icons[platform] || 'ğŸ“±';
        }
        
        // Display scenarios results with download functionality
        function displayScenariosResults(scenarios) {
            const scenariosContainer = document.getElementById('scenariosContainer');
            const scenarioResults = document.getElementById('scenarioResults');
            
            let html = '';
            
            scenarios.forEach((scenario, index) => {
                html += `<div class="platform-result" style="margin-bottom: 25px;">
                    <h3 style="color: #4a90e2;">
                        ğŸ¬ å ´æ™¯ ${scenario.scenarioIndex}: ${scenario.name}
                        ${scenario.imageError ? 'âš ï¸' : 'âœ…'}
                    </h3>
                    
                    <div style="margin-bottom: 15px;">
                        <h4 style="color: #333; margin-bottom: 8px;">ğŸ“ å ´æ™¯æè¿°</h4>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 10px;">
                            ${scenario.description}
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <strong>ğŸ’­ æƒ…æ„Ÿæ°›åœ:</strong> ${scenario.emotion}<br>
                                <strong>ğŸ¯ é©åˆå¹³å°:</strong> ${scenario.suitablePlatforms?.join(', ') || 'é€šç”¨'}
                            </div>
                            <div>
                                <strong>ğŸ¨ è¦–è¦ºé‡é»:</strong> ${scenario.visualFocus}
                            </div>
                        </div>
                    </div>`;
                
                if (scenario.imageDescription) {
                    html += `<div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <h4 style="color: #1976d2; margin-bottom: 10px;">ğŸ–¼ï¸ åœ–ç‰‡è¨­è¨ˆæè¿°</h4>
                        <div style="white-space: pre-wrap; font-size: 14px; line-height: 1.6;">
                            ${scenario.imageDescription}
                        </div>
                    </div>`;
                }
                
                // é¡¯ç¤ºç”Ÿæˆçš„åœ–ç‰‡æˆ–è¨­è¨ˆæŒ‡å°ï¼ˆå¸¶ä¸‹è¼‰åŠŸèƒ½ï¼‰
                if (scenario.isRealImage && scenario.path) {
                    html += `<div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <h4 style="color: #2e7d2e; margin: 0;">ğŸ¨ AI ç”Ÿæˆå ´æ™¯åœ–ç‰‡</h4>
                            <button onclick="downloadFile('${scenario.path}', 'scenario_${scenario.scenarioIndex}_${scenario.name.replace(/[^a-zA-Z0-9]/g, '_')}.png')" 
                                    class="btn btn-small" style="background: #4CAF50; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                                ğŸ“¥ ä¸‹è¼‰å ´æ™¯åœ–ç‰‡
                            </button>
                        </div>
                        <p style="color: #2e7d2e; margin: 0;">âœ… çœŸå¯¦ AI åœ–ç‰‡å·²ç”Ÿæˆ (${Math.round(scenario.size/1024)}KB)</p>
                    </div>`;
                } else if (scenario.designGuidePath || scenario.path) {
                    const filePath = scenario.designGuidePath || scenario.path;
                    const fileName = `scenario_${scenario.scenarioIndex}_${scenario.name.replace(/[^a-zA-Z0-9]/g, '_')}_guide.md`;
                    
                    html += `<div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                        <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 10px;">
                            <h4 style="color: #7b1fa2; margin: 0;">ğŸ“‹ å°ˆæ¥­è¨­è¨ˆæŒ‡å°æ–‡ä»¶</h4>
                            <button onclick="downloadFile('${filePath}', '${fileName}')" 
                                    class="btn btn-small" style="background: #9C27B0; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                                ğŸ“¥ ä¸‹è¼‰è¨­è¨ˆæŒ‡å°
                            </button>
                        </div>
                        <p style="color: #666; font-size: 14px; margin: 0;">ğŸ“ åŒ…å«å®Œæ•´è¨­è¨ˆè¦æ ¼ï¼Œå¯ç”¨æ–¼å°ˆæ¥­è¨­è¨ˆå·¥å…· (DALL-E, Midjourney, Stable Diffusion)</p>
                    </div>`;
                }
                
                if (scenario.imageError) {
                    html += `<div style="background: #ffebee; padding: 15px; border-radius: 8px; border-left: 4px solid #f44336;">
                        <strong style="color: #d32f2f;">åœ–ç‰‡ç”ŸæˆéŒ¯èª¤:</strong> ${scenario.imageError}
                    </div>`;
                }
                
                html += '</div>';
            });
            
            scenarioResults.innerHTML = html;
            scenariosContainer.style.display = 'block';
        }
        
        // Toggle scenario options based on generateImages checkbox
        function toggleScenarioOptions() {
            const generateImages = document.getElementById('generateImages').checked;
            const modelSceneOptionsGroup = document.getElementById('modelSceneOptionsGroup');
            const scenarioOptionsGroup = document.getElementById('scenarioOptionsGroup');
            
            if (generateImages) {
                modelSceneOptionsGroup.style.display = 'block';
                scenarioOptionsGroup.style.display = 'block';
            } else {
                modelSceneOptionsGroup.style.display = 'none';
                scenarioOptionsGroup.style.display = 'none';
            }
        }

        // Load brand configuration and populate UI
        async function loadBrandConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();
                
                // Update brand elements
                const logoElement = document.getElementById('brandLogo');
                logoElement.src = config.brand.logoPath;
                logoElement.alt = `${config.brand.name} Logo`;
                logoElement.style.display = 'block';
                // brandTitle and brandSlogan now use data-i18n attributes for automatic translation
                // Title and slogan will be updated by updatePageLanguage() function
                document.title = `${config.brand.name} Multi-Platform Content Generator`;
                
                // Populate platforms
                const platformsGroup = document.getElementById('platformsGroup');
                platformsGroup.innerHTML = '';
                config.platforms.forEach(platform => {
                    const item = document.createElement('div');
                    item.className = 'checkbox-item';
                    item.innerHTML = `
                        <input type="checkbox" id="platform_${platform.value}" value="${platform.value}" checked>
                        <label for="platform_${platform.value}">${platform.label}</label>
                    `;
                    platformsGroup.appendChild(item);
                });
                
                console.log('Brand configuration loaded:', config);
            } catch (error) {
                console.error('Failed to load brand configuration:', error);
            }
        }
        
        // Initialize app
        fetch('/api/health')
            .then(response => response.json())
            .then(data => {
                console.log('API Status:', data);
                return loadBrandConfig();
            })
            .catch(error => {
                console.error('API connection failed:', error);
            });
        
        // ==================== Page 2: AI å»£å‘Šé¡§å•åŠŸèƒ½ ====================
        
        // åˆ†é åˆ‡æ›å‡½æ•¸
        function switchPage(pageId) {
            // éš±è—æ‰€æœ‰é é¢
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });
            
            // ç§»é™¤æ‰€æœ‰æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„é é¢
            document.getElementById(pageId).classList.add('active');
            
            // è¨­ç½®å°æ‡‰æŒ‰éˆ•ç‚º active
            event.target.classList.add('active');
        }
        
        // Page 2 æª”æ¡ˆä¸Šå‚³è™•ç†
        let selectedAdsFiles = [];
        const adsFileUpload = document.getElementById('adsFileUpload');
        
        if (adsFileUpload) {
            adsFileUpload.addEventListener('change', function(e) {
                const files = Array.from(e.target.files);
                
                // é™åˆ¶æœ€å¤š 10 å€‹æª”æ¡ˆ
                if (files.length > 10) {
                    alert('æœ€å¤šåªèƒ½é¸æ“‡10å€‹æª”æ¡ˆ');
                    files.splice(10);
                    
                    const dt = new DataTransfer();
                    files.forEach(file => dt.items.add(file));
                    e.target.files = dt.files;
                }
                
                selectedAdsFiles = files;
                displayAdsFilePreview(files);
            });
        }
        
        // é¡¯ç¤º Page 2 æª”æ¡ˆé è¦½
        function displayAdsFilePreview(files) {
            const container = document.getElementById('adsFilePreviewContainer');
            const countDiv = document.getElementById('selectedAdsFileCount');
            
            if (files.length === 0) {
                container.style.display = 'none';
                countDiv.style.display = 'none';
                return;
            }
            
            container.innerHTML = '';
            container.classList.add('show');
            countDiv.style.display = 'block';
            countDiv.textContent = `å·²é¸æ“‡ ${files.length} å€‹æª”æ¡ˆ`;
            
            const grid = document.createElement('div');
            grid.className = 'image-preview-grid';
            
            files.forEach((file, index) => {
                const item = document.createElement('div');
                item.className = 'image-preview-item';
                
                // æ ¹æ“šæª”æ¡ˆé¡å‹é¡¯ç¤ºä¸åŒåœ–ç¤º
                let fileIcon = 'ğŸ“„';
                if (file.type.startsWith('image/')) {
                    fileIcon = 'ğŸ–¼ï¸';
                } else if (file.type.includes('pdf')) {
                    fileIcon = 'ğŸ“•';
                } else if (file.type.includes('sheet') || file.type.includes('excel')) {
                    fileIcon = 'ğŸ“Š';
                } else if (file.type.includes('word') || file.type.includes('document')) {
                    fileIcon = 'ğŸ“';
                }
                
                item.innerHTML = `
                    <div style="padding: 15px; text-align: center; background: #f0f0f0; height: 100px; display: flex; flex-direction: column; justify-content: center;">
                        <div style="font-size: 32px;">${fileIcon}</div>
                        <div style="font-size: 10px; margin-top: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${file.name}</div>
                    </div>
                    <button class="remove-btn" onclick="removeAdsFile(${index})">Ã—</button>
                `;
                
                grid.appendChild(item);
            });
            
            container.appendChild(grid);
        }
        
        // ç§»é™¤ Page 2 æª”æ¡ˆ
        function removeAdsFile(index) {
            selectedAdsFiles.splice(index, 1);
            
            const dt = new DataTransfer();
            selectedAdsFiles.forEach(file => dt.items.add(file));
            document.getElementById('adsFileUpload').files = dt.files;
            
            displayAdsFilePreview(selectedAdsFiles);
        }
        
        // Page 2 è¡¨å–®æäº¤è™•ç†
        const adsAnalysisForm = document.getElementById('adsAnalysisForm');
        if (adsAnalysisForm) {
            adsAnalysisForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const brandName = document.getElementById('brandName').value.trim();
                const productName = document.getElementById('adProductName').value.trim();
                const coreProduct = document.getElementById('coreProduct').value.trim();
                const targetMarket = document.getElementById('targetMarket').value.trim();
                
                // ç²å–é¸ä¸­çš„å¹³å°
                const selectedPlatforms = Array.from(document.querySelectorAll('input[name="adsPlatform"]:checked'))
                    .map(cb => cb.value);
                
                // æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•å¯åˆ†æçš„è³‡è¨Šï¼ˆæª”æ¡ˆæˆ–æ–‡å­—è³‡è¨Šï¼‰
                const hasFiles = selectedAdsFiles.length > 0;
                const hasTextInfo = brandName || productName || coreProduct || targetMarket;
                const hasPlatformSelection = selectedPlatforms.length > 0;
                
                if (!hasFiles && !hasTextInfo) {
                    alert('è«‹è‡³å°‘ä¸Šå‚³æª”æ¡ˆæˆ–å¡«å¯«å“ç‰Œ/ç”¢å“è³‡è¨Šï¼ŒAI æ‰èƒ½é€²è¡Œåˆ†æ');
                    return;
                }
                
                if (!hasPlatformSelection) {
                    alert('è«‹è‡³å°‘é¸æ“‡ä¸€å€‹å»£å‘Šå¹³å°');
                    return;
                }
                
                const statusDiv = document.getElementById('adsStatus');
                const resultsDiv = document.getElementById('adsAnalysisResults');
                const analyzeBtn = document.getElementById('analyzeAdsBtn');
                
                // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                analyzeBtn.disabled = true;
                analyzeBtn.textContent = 'ğŸ”„ åˆ†æä¸­...';
                statusDiv.innerHTML = '<p style="color: #87CEEB;">â³ æ­£åœ¨ä¸Šå‚³æª”æ¡ˆä¸¦åˆ†æå»£å‘Šè³‡æ–™...</p>';
                
                try {
                    // æº–å‚™è¡¨å–®æ•¸æ“š
                    const formData = new FormData();
                    formData.append('brandName', brandName);
                    formData.append('productName', productName);
                    formData.append('coreProduct', coreProduct);
                    formData.append('targetMarket', targetMarket);
                    formData.append('platforms', JSON.stringify(selectedPlatforms));
                    formData.append('language', currentLanguage); // æ·»åŠ ç•¶å‰èªè¨€
                    
                    // æ·»åŠ æ‰€æœ‰æª”æ¡ˆ
                    selectedAdsFiles.forEach((file, index) => {
                        formData.append('files', file);
                    });
                    
                    // ç™¼é€åˆ°å¾Œç«¯ API
                    const response = await fetch('/api/analyze-ads', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error('åˆ†æè«‹æ±‚å¤±æ•—');
                    }
                    
                    const result = await response.json();
                    
                    // é¡¯ç¤ºåˆ†æçµæœ
                    displayAdsAnalysisResults(result);
                    
                    // ä¿å­˜åˆ†æä¸Šä¸‹æ–‡ä¾›å°è©±ä½¿ç”¨
                    analysisContext = {
                        brandNeedSummary: result.brandNeedSummary,
                        performanceInsight: result.performanceInsight,
                        creativeStrategy: result.creativeStrategy,
                        optimizationPlan: result.optimizationPlan,
                        advertisingReviewReport: result.advertisingReviewReport
                    };
                    
                    // é¡¯ç¤ºå»ºè­°å•é¡Œå’Œå°è©±è¦–çª—
                    if (result.suggestedQuestions && result.suggestedQuestions.length > 0) {
                        showSuggestedQuestions(result.suggestedQuestions);
                    }
                    
                    // é¡¯ç¤ºå°è©±è¦–çª—
                    document.getElementById('chatAdvisorContainer').classList.add('active');
                    
                    statusDiv.innerHTML = '<p style="color: #28a745;">âœ… åˆ†æå®Œæˆï¼æ‚¨å¯ä»¥åœ¨ä¸‹æ–¹å°è©±è¦–çª—å‘ AI é¡§å•æå•ã€‚</p>';
                    document.getElementById('reportActions').style.display = 'block';
                    
                } catch (error) {
                    console.error('åˆ†æéŒ¯èª¤:', error);
                    statusDiv.innerHTML = '<p style="color: #dc3545;">âŒ åˆ†æå¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦</p>';
                } finally {
                    analyzeBtn.disabled = false;
                    analyzeBtn.textContent = 'ğŸ§  é–‹å§‹åˆ†æ (Start Analysis)';
                }
            });
        }
        
        // é¡¯ç¤ºå»£å‘Šåˆ†æçµæœ
        function displayAdsAnalysisResults(result) {
            const resultsDiv = document.getElementById('adsAnalysisResults');
            
            let html = '<div style="text-align: left;">';
            
            // 1. Brand Need Summary
            if (result.brandNeedSummary) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #f8f9fa; border-left: 4px solid #87CEEB; border-radius: 8px;">
                        <h3 style="color: #87CEEB; margin-bottom: 10px;">ğŸ“Œ Brand Need Summary (å“ç‰Œéœ€æ±‚æ‘˜è¦)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.brandNeedSummary}</p>
                    </div>
                `;
            }
            
            // 2. Performance Insight
            if (result.performanceInsight) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #fff3cd; border-left: 4px solid #ffc107; border-radius: 8px;">
                        <h3 style="color: #ffc107; margin-bottom: 10px;">ğŸ“Š Performance Insight (æ•ˆèƒ½æ´å¯Ÿ)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.performanceInsight}</p>
                    </div>
                `;
            }
            
            // 3. Creative Strategy
            if (result.creativeStrategy) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #d1ecf1; border-left: 4px solid #17a2b8; border-radius: 8px;">
                        <h3 style="color: #17a2b8; margin-bottom: 10px;">ğŸ¨ Creative Strategy (å‰µæ„ç­–ç•¥)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.creativeStrategy}</p>
                    </div>
                `;
            }
            
            // 4. Optimization Plan
            if (result.optimizationPlan) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #d4edda; border-left: 4px solid #28a745; border-radius: 8px;">
                        <h3 style="color: #28a745; margin-bottom: 10px;">ğŸš€ Optimization Plan (å„ªåŒ–è¨ˆåŠƒ)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.optimizationPlan}</p>
                    </div>
                `;
            }
            
            // 5. Advertising Review Report
            if (result.advertisingReviewReport) {
                html += `
                    <div style="margin-bottom: 25px; padding: 20px; background: #f8d7da; border-left: 4px solid #dc3545; border-radius: 8px;">
                        <h3 style="color: #dc3545; margin-bottom: 10px;">ğŸ“ Advertising Review Report (å»£å‘Šæª¢è¦–å ±å‘Š)</h3>
                        <p style="white-space: pre-wrap; line-height: 1.6;">${result.advertisingReviewReport}</p>
                    </div>
                `;
            }
            
            html += '</div>';
            resultsDiv.innerHTML = html;
        }
        
        // PDF åŒ¯å‡ºåŠŸèƒ½
        function exportPDF() {
            window.print();
        }
        
        // é‡æ–°åˆ†æåŠŸèƒ½
        function reanalyze() {
            document.getElementById('adsAnalysisResults').innerHTML = `
                <p style="text-align: center; color: #666; padding: 40px;">
                    ä¸Šå‚³å»£å‘Šè³‡æ–™ä¸¦é»æ“Šåˆ†ææŒ‰éˆ•é–‹å§‹ AI æ™ºæ…§åˆ†æ
                </p>
            `;
            document.getElementById('reportActions').style.display = 'none';
            document.getElementById('adsStatus').innerHTML = '';
        }
        
        // ==================== èªè¨€åˆ‡æ›åŠŸèƒ½ ====================
        
        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            menu.classList.toggle('active');
        }
        
        function selectLanguage(lang) {
            switchLanguage(lang);
            const menu = document.getElementById('languageMenu');
            menu.classList.remove('active');
            
            // æ›´æ–°é¸ä¸­ç‹€æ…‹
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // é»æ“Šå¤–éƒ¨é—œé–‰èªè¨€é¸å–®
        document.addEventListener('click', function(event) {
            const languageSwitcher = document.querySelector('.language-switcher');
            if (languageSwitcher && !languageSwitcher.contains(event.target)) {
                document.getElementById('languageMenu').classList.remove('active');
            }
        });
        
        // ==================== å°è©±åŠŸèƒ½ ====================
        
        let chatHistory = [];
        let chatFiles = [];
        let analysisContext = null; // å„²å­˜åˆ†æçµæœä½œç‚ºå°è©±ä¸Šä¸‹æ–‡
        
        // æª”æ¡ˆä¸Šå‚³è™•ç†
        const chatFileUpload = document.getElementById('chatFileUpload');
        if (chatFileUpload) {
            chatFileUpload.addEventListener('change', function(e) {
                chatFiles = Array.from(e.target.files);
                displayChatFilePreview();
            });
        }
        
        function displayChatFilePreview() {
            const container = document.getElementById('chatFilePreview');
            if (chatFiles.length === 0) {
                container.innerHTML = '';
                return;
            }
            
            container.innerHTML = chatFiles.map((file, index) => `
                <div class="chat-file-item">
                    ğŸ“ ${file.name}
                    <span class="chat-file-remove" onclick="removeChatFile(${index})">Ã—</span>
                </div>
            `).join('');
        }
        
        function removeChatFile(index) {
            chatFiles.splice(index, 1);
            displayChatFilePreview();
        }
        
        // ç™¼é€å°è©±è¨Šæ¯
        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message && chatFiles.length === 0) {
                alert('è«‹è¼¸å…¥å•é¡Œæˆ–ä¸Šå‚³æª”æ¡ˆ');
                return;
            }
            
            // é¡¯ç¤ºç”¨æˆ¶è¨Šæ¯
            if (message) {
                addChatMessage('user', message);
            }
            if (chatFiles.length > 0) {
                addChatMessage('user', `ğŸ“ å·²ä¸Šå‚³ ${chatFiles.length} å€‹æª”æ¡ˆ`);
            }
            
            input.value = '';
            const sendBtn = document.getElementById('chatSendBtn');
            sendBtn.disabled = true;
            
            // é¡¯ç¤ºè¼‰å…¥ä¸­
            const loadingId = 'loading-' + Date.now();
            addChatMessage('ai', 'æ­£åœ¨æ€è€ƒä¸­...', loadingId);
            
            try {
                // æº–å‚™è¡¨å–®æ•¸æ“š
                const formData = new FormData();
                formData.append('message', message);
                formData.append('chatHistory', JSON.stringify(chatHistory));
                formData.append('language', currentLanguage); // æ·»åŠ ç•¶å‰èªè¨€
                if (analysisContext) {
                    formData.append('analysisContext', JSON.stringify(analysisContext));
                }
                
                // æ·»åŠ æª”æ¡ˆ
                chatFiles.forEach(file => {
                    formData.append('files', file);
                });
                
                // ç™¼é€è«‹æ±‚
                const response = await fetch('/api/chat-with-advisor', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // ç§»é™¤è¼‰å…¥è¨Šæ¯
                    document.getElementById(loadingId)?.remove();
                    
                    // é¡¯ç¤ºAIå›è¦†
                    addChatMessage('ai', data.response);
                    
                    // æ›´æ–°å°è©±æ­·å²
                    chatHistory.push({
                        role: 'user',
                        content: message,
                        hasFiles: chatFiles.length > 0
                    });
                    chatHistory.push({
                        role: 'assistant',
                        content: data.response
                    });
                    
                    // æ¸…ç©ºæª”æ¡ˆ
                    chatFiles = [];
                    displayChatFilePreview();
                } else {
                    throw new Error(data.error || 'å°è©±å¤±æ•—');
                }
            } catch (error) {
                console.error('å°è©±éŒ¯èª¤:', error);
                document.getElementById(loadingId)?.remove();
                addChatMessage('ai', 'æŠ±æ­‰ï¼Œç™¼ç”ŸéŒ¯èª¤ï¼š' + error.message);
            } finally {
                sendBtn.disabled = false;
            }
        }
        
        // æ·»åŠ å°è©±è¨Šæ¯åˆ°ç•Œé¢
        function addChatMessage(role, content, messageId = null) {
            const messagesContainer = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${role}`;
            if (messageId) messageDiv.id = messageId;
            
            const avatar = role === 'ai' ? 'ğŸ¤–' : 'ğŸ‘¤';
            
            messageDiv.innerHTML = `
                <div class="chat-message-avatar">${avatar}</div>
                <div class="chat-message-content">${content}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        // é¡¯ç¤ºå»ºè­°å•é¡Œ
        function showSuggestedQuestions(questions) {
            const container = document.getElementById('suggestedQuestionsList');
            const questionsDiv = document.getElementById('suggestedQuestions');
            
            container.innerHTML = questions.map((q, index) => `
                <button class="suggested-question-btn" onclick="askSuggestedQuestion('${q.replace(/'/g, "\\'")}')">
                    ${index + 1}. ${q}
                </button>
            `).join('');
            
            questionsDiv.style.display = 'block';
        }
        
        // é»æ“Šå»ºè­°å•é¡Œ
        function askSuggestedQuestion(question) {
            document.getElementById('chatInput').value = question;
            sendChatMessage();
            document.getElementById('suggestedQuestions').style.display = 'none';
        }
        
        // Enter ç™¼é€è¨Šæ¯
        const chatInput = document.getElementById('chatInput');
        if (chatInput) {
            chatInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendChatMessage();
                }
            });
        }
    </script>

    <!-- Page 3: AI èª²ç¨‹ç·¨è¼¯å°ˆå®¶ JavaScript -->
    <script>
        // å„²å­˜ç”Ÿæˆçš„èª²ç¨‹æ•¸æ“š
        let generatedCourseData = null;

        // ä¸»é¡Œé¸é …ï¼ˆæ ¹æ“šç§‘åˆ¥å‹•æ…‹æ›´æ–°ï¼‰
        const topicOptions = {
            social: ['å®¶åº­', 'äº¤é€šå·¥å…·', 'ç¤¾æœƒè§’è‰²', 'æ–‡åŒ–ç¯€æ—¥', 'å®‰å…¨æ•™è‚²'],
            science: ['å‹•ç‰©', 'æ¤ç‰©', 'åœ°çƒ', 'å¤©æ°£', 'äº”æ„Ÿ'],
            math: ['åŠ æ³•', 'æ¸›æ³•', 'å½¢ç‹€', 'æ™‚é–“', 'åº¦é‡'],
            language: ['å­—æ¯', 'è©å½™', 'è½èªªè®€å¯«', 'çŸ­ç¯‡æ•…äº‹'],
            art: ['é¡è‰²', 'ç·šæ¢', 'å‰µä½œ', 'éŸ³æ¨‚ç¯€å¥']
        };

        // è™•ç†å¹´é½¡é¸æ“‡è®ŠåŒ–
        function handleAgeChange() {
            const ageSelect = document.getElementById('targetAge');
            const customInput = document.getElementById('customAgeText');
            
            if (ageSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†ç§‘åˆ¥é¸æ“‡è®ŠåŒ–
        function handleCategoryChange() {
            const categorySelect = document.getElementById('category');
            const customInput = document.getElementById('customCategoryText');
            
            if (categorySelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // æ›´æ–°ä¸»é¡Œé¸é …ï¼ˆæ ¹æ“šç§‘åˆ¥ï¼‰
        function updateTopicOptions() {
            const category = document.getElementById('category').value;
            const topicSelect = document.getElementById('topic');
            
            // æ¸…ç©ºç¾æœ‰é¸é …
            topicSelect.innerHTML = '';
            
            if (category === 'custom') {
                // å¦‚æœæ˜¯è‡ªå®šç¾©ç§‘åˆ¥ï¼Œé¡¯ç¤ºé€šç”¨é¸é …
                topicSelect.innerHTML = '<option value="custom">è‡ªå®šç¾© (Custom)</option>';
                document.getElementById('customTopicText').style.display = 'block';
            } else if (topicOptions[category]) {
                // æ ¹æ“šç§‘åˆ¥æ·»åŠ å°æ‡‰ä¸»é¡Œ
                topicOptions[category].forEach(topic => {
                    const option = document.createElement('option');
                    option.value = topic;
                    option.textContent = topic;
                    topicSelect.appendChild(option);
                });
                
                // æ·»åŠ è‡ªå®šç¾©é¸é …
                const customOption = document.createElement('option');
                customOption.value = 'custom';
                customOption.textContent = 'è‡ªå®šç¾© (Custom)';
                topicSelect.appendChild(customOption);
                
                document.getElementById('customTopicText').style.display = 'none';
            }
        }

        // è™•ç†ä¸»é¡Œé¸æ“‡è®ŠåŒ–
        function handleTopicChange() {
            const topicSelect = document.getElementById('topic');
            const customInput = document.getElementById('customTopicText');
            
            if (topicSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†æ™‚é•·é¸æ“‡è®ŠåŒ–
        function handleDurationChange() {
            const durationSelect = document.getElementById('duration');
            const customInput = document.getElementById('customDurationText');
            
            if (durationSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // è™•ç†é¢¨æ ¼é¸æ“‡è®ŠåŒ–
        function handleStyleChange() {
            const styleSelect = document.getElementById('style');
            const customInput = document.getElementById('customStyleText');
            
            if (styleSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // ç”Ÿæˆèª²ç¨‹å…§å®¹
        async function generateCourse() {
            const btn = document.getElementById('generateCourseBtn');
            const preview = document.getElementById('coursePreview');
            const status = document.getElementById('courseStatus');
            
            // ç²å–è¡¨å–®æ•¸æ“š
            let targetAge = document.getElementById('targetAge').value;
            if (targetAge === 'custom') {
                const customAge = document.getElementById('customAgeText').value;
                targetAge = customAge || '6-8'; // é»˜èªå€¼
            }

            let category = document.getElementById('category').value;
            if (category === 'custom') {
                const customCategory = document.getElementById('customCategoryText').value.trim();
                category = customCategory || 'social';
            }

            let topic = document.getElementById('topic').value;
            if (topic === 'custom') {
                const customTopic = document.getElementById('customTopicText').value.trim();
                topic = customTopic || 'ä¸»é¡Œ';
            }

            let duration = document.getElementById('duration').value;
            if (duration === 'custom') {
                const customDuration = document.getElementById('customDurationText').value;
                duration = customDuration || '60';
            }

            let style = document.getElementById('style').value;
            if (style === 'custom') {
                const customStyle = document.getElementById('customStyleText').value.trim();
                style = customStyle || 'story-based';
            }

            const outputTypesCheckboxes = document.querySelectorAll('input[name="outputTypes"]:checked');
            const outputTypes = Array.from(outputTypesCheckboxes).map(cb => cb.value);

            if (outputTypes.length === 0) {
                alert('è«‹è‡³å°‘é¸æ“‡ä¸€ç¨®è¼¸å‡ºæ ¼å¼');
                return;
            }

            const language = document.getElementById('courseLanguage').value;
            const includeImages = document.getElementById('includeImages').value;

            // é¡¯ç¤ºç”Ÿæˆä¸­ç‹€æ…‹
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> ç”Ÿæˆä¸­...';
            
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ¤– AI æ­£åœ¨ç”Ÿæˆèª²ç¨‹å…§å®¹ï¼Œè«‹ç¨å€™...';
            
            preview.innerHTML = '<p style="text-align: center; padding: 40px;"><span class="loading"></span><br>AI ç”Ÿæˆä¸­...</p>';

            try {
                const response = await fetch('/api/generate-course', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        targetAge,
                        category,
                        topic,
                        duration,
                        style,
                        outputTypes,
                        language,
                        includeImages
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'èª²ç¨‹ç”Ÿæˆå¤±æ•—');
                }

                // ä¿å­˜èª²ç¨‹æ•¸æ“š
                generatedCourseData = data.course;

                // é¡¯ç¤ºèª²ç¨‹å…§å®¹
                displayCourseContent(data.course);

                // é¡¯ç¤ºä¸‹è¼‰æŒ‰éˆ•
                document.getElementById('downloadActions').style.display = 'flex';

                status.className = 'success';
                status.innerHTML = 'âœ… èª²ç¨‹å…§å®¹ç”ŸæˆæˆåŠŸï¼';

            } catch (error) {
                console.error('Course generation error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
                preview.innerHTML = `<p style="text-align: center; color: #d32f2f; padding: 40px;">ç”Ÿæˆå¤±æ•—: ${error.message}</p>`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ“ ç”Ÿæˆèª²ç¨‹ Generate Course';
            }
        }

        // é¡¯ç¤ºèª²ç¨‹å…§å®¹
        function displayCourseContent(course) {
            const preview = document.getElementById('coursePreview');
            
            console.log('ğŸ“Š Course data:', course);
            console.log('ğŸ¨ Images data:', course.images);
            
            // å°‡Markdownæ ¼å¼çš„å…§å®¹è½‰æ›ç‚ºHTMLé¡¯ç¤º
            const contentHTML = formatCourseContent(course.content);
            
            // æº–å‚™åœ–ç‰‡HTMLï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
            let imagesHTML = '';
            if (course.images && course.images.length > 0) {
                console.log(`âœ… Found ${course.images.length} images`);
                imagesHTML = '<div style="margin: 20px 0;"><h3 style="color: #444; margin-bottom: 15px;">ğŸ¨ AI ç”Ÿæˆæ’åœ–</h3>';
                course.images.forEach((img, index) => {
                    console.log(`Image ${index + 1}:`, img.downloadUrl);
                    imagesHTML += `
                        <div style="margin: 15px 0; text-align: center;">
                            <img src="${img.downloadUrl}" alt="èª²ç¨‹æ’åœ– ${index + 1}" 
                                 style="max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" 
                                 onerror="console.error('Failed to load image:', '${img.downloadUrl}')" />
                            <p style="color: #666; font-size: 12px; margin-top: 5px;">æ’åœ– ${index + 1}</p>
                        </div>
                    `;
                });
                imagesHTML += '</div>';
            } else {
                console.warn('âŒ No images found in course data');
            }
            
            preview.innerHTML = `
                <div style="background: white; padding: 20px; border-radius: 10px;">
                    <h2 style="color: #333; border-bottom: 2px solid #87CEEB; padding-bottom: 10px;">
                        ${course.title}
                    </h2>
                    ${imagesHTML}
                    <div style="margin-top: 20px; line-height: 1.8;">
                        ${contentHTML}
                    </div>
                </div>
            `;
        }

        // æ ¼å¼åŒ–èª²ç¨‹å…§å®¹ï¼ˆç°¡åŒ–ç‰ˆMarkdownè½‰HTMLï¼‰
        function formatCourseContent(content) {
            let html = content
                // æ¨™é¡Œè½‰æ›
                .replace(/^### (.+)$/gm, '<h4 style="color: #555; margin-top: 20px;">$1</h4>')
                .replace(/^## (.+)$/gm, '<h3 style="color: #444; margin-top: 25px;">$1</h3>')
                .replace(/^# (.+)$/gm, '<h2 style="color: #333; margin-top: 30px;">$1</h2>')
                // ç²—é«”
                .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
                // åˆ—è¡¨é …
                .replace(/^[-*] (.+)$/gm, '<li style="margin-left: 20px;">$1</li>')
                // æ›è¡Œ
                .replace(/\n\n/g, '<br><br>');
            
            return html;
        }

        // ä¸‹è¼‰Wordæ–‡æª”
        async function downloadWord() {
            if (!generatedCourseData) {
                alert('è«‹å…ˆç”Ÿæˆèª²ç¨‹å…§å®¹');
                return;
            }

            const status = document.getElementById('courseStatus');
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ“„ æ­£åœ¨ç”Ÿæˆ Word æ–‡æª”...';

            try {
                const response = await fetch('/api/export-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseData: generatedCourseData,
                        format: 'word'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'Word å°å‡ºå¤±æ•—');
                }

                // ä¸‹è¼‰æ–‡ä»¶
                window.location.href = data.downloadUrl;

                status.className = 'success';
                status.innerHTML = 'âœ… Word æ–‡æª”å·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸‹è¼‰...';

            } catch (error) {
                console.error('Word export error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
            }
        }

        // ä¸‹è¼‰PDFæ–‡æª”
        async function downloadPDF() {
            if (!generatedCourseData) {
                alert('è«‹å…ˆç”Ÿæˆèª²ç¨‹å…§å®¹');
                return;
            }

            const status = document.getElementById('courseStatus');
            status.style.display = 'block';
            status.className = 'info';
            status.innerHTML = 'ğŸ“• æ­£åœ¨ç”Ÿæˆ PDF æ–‡æª”...';

            try {
                const response = await fetch('/api/export-document', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        courseData: generatedCourseData,
                        format: 'pdf'
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'PDF å°å‡ºå¤±æ•—');
                }

                // ä¸‹è¼‰æ–‡ä»¶
                window.location.href = data.downloadUrl;

                status.className = 'success';
                status.innerHTML = 'âœ… PDF æ–‡æª”å·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸‹è¼‰...';

            } catch (error) {
                console.error('PDF export error:', error);
                status.className = 'error';
                status.innerHTML = `âŒ éŒ¯èª¤: ${error.message}`;
            }
        }

        // ==================== Page 4: BizPrompt Architect Pro ====================
        
        // ç•¶å‰ç”Ÿæˆçš„ Prompt å…§å®¹
        let currentGeneratedPrompt = '';
        let currentPromptMode = 'business';

        // å•†æ¥­é¡§å•æ¨¡å¼çš„å±¤ç´šæ•¸æ“š - æ•´åˆç”¨æˆ¶ç‰¹å®šè¡Œæ¥­éœ€æ±‚
        const bizData = {
            // ==================== ç”¨æˆ¶æ ¸å¿ƒè¡Œæ¥­ ====================
            ecommerce: {
                label: 'biz_domain_ecommerce',
                industries: {
                    'fashion-footwear': { label: 'biz_ind_fashion_footwear', roles: ['ecom-manager', 'fashion-buyer', 'visual-merchandiser', 'product-stylist', 'category-manager', 'custom'] },
                    'mother-baby': { label: 'biz_ind_mother_baby', roles: ['baby-product-manager', 'parent-community', 'safety-specialist', 'content-creator', 'kol-manager', 'custom'] },
                    'pet-industry': { label: 'biz_ind_pet', roles: ['pet-product-manager', 'pet-community', 'vet-consultant', 'pet-content', 'pet-influencer', 'custom'] },
                    'art-toy': { label: 'biz_ind_art_toy', roles: ['toy-designer', 'ip-manager', 'collector-community', 'limited-edition', 'collab-manager', 'custom'] },
                    'tiktok-shop': { label: 'biz_ind_tiktok_shop', roles: ['tiktok-operator', 'live-host', 'short-video', 'affiliate-tiktok', 'tiktok-ads', 'custom'] },
                    'shopee': { label: 'biz_ind_shopee', roles: ['shopee-operator', 'shopee-ads', 'flash-sale', 'shopee-live', 'seller-support', 'custom'] },
                    'fb-marketplace': { label: 'biz_ind_fb_marketplace', roles: ['fb-shop-manager', 'fb-ads-specialist', 'community-sales', 'messenger-sales', 'fb-live', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            marketing: {
                label: 'biz_domain_marketing',
                industries: {
                    'seo-geo': { label: 'biz_ind_seo_geo', roles: ['seo-specialist', 'geo-specialist', 'local-seo', 'technical-seo', 'content-seo', 'custom'] },
                    'social-marketing': { label: 'biz_ind_social_marketing', roles: ['social-media', 'influencer-manager', 'community-manager', 'content-marketer', 'viral-specialist', 'custom'] },
                    'performance': { label: 'biz_ind_performance', roles: ['performance-marketer', 'paid-media', 'growth-hacker', 'conversion-optimizer', 'marketing-analyst', 'custom'] },
                    'brand-marketing': { label: 'biz_ind_brand_marketing', roles: ['brand-manager', 'brand-strategist', 'creative-director', 'campaign-manager', 'pr-specialist', 'custom'] },
                    'content-marketing': { label: 'biz_ind_content_marketing', roles: ['content-strategist', 'copywriter', 'video-producer', 'podcast-host', 'newsletter-manager', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            product: {
                label: 'biz_domain_product',
                industries: {
                    'fashion-product': { label: 'biz_ind_fashion_product', roles: ['fashion-pm', 'trend-analyst', 'sourcing-manager', 'quality-controller', 'supply-chain', 'custom'] },
                    'baby-product': { label: 'biz_ind_baby_product', roles: ['baby-pm', 'safety-pm', 'parent-researcher', 'packaging-designer', 'compliance-pm', 'custom'] },
                    'pet-product': { label: 'biz_ind_pet_product', roles: ['pet-pm', 'pet-nutritionist', 'pet-safety', 'pet-ux', 'pet-innovation', 'custom'] },
                    'toy-product': { label: 'biz_ind_toy_product', roles: ['toy-pm', 'play-researcher', 'ip-developer', 'manufacturing-pm', 'collector-pm', 'custom'] },
                    'tech-product': { label: 'biz_ind_tech_product', roles: ['pm', 'senior-pm', 'product-lead', 'technical-pm', 'platform-pm', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            design: {
                label: 'biz_domain_design',
                industries: {
                    'product-design': { label: 'biz_ind_product_design', roles: ['industrial-designer', 'cad-engineer', '3d-modeler', 'prototype-specialist', 'material-designer', 'custom'] },
                    'fashion-design': { label: 'biz_ind_fashion_design', roles: ['fashion-designer', 'pattern-maker', 'textile-designer', 'accessory-designer', 'footwear-designer', 'custom'] },
                    'toy-design': { label: 'biz_ind_toy_design', roles: ['toy-sculptor', 'character-designer', 'packaging-designer', 'color-specialist', 'articulation-designer', 'custom'] },
                    'ux-ui': { label: 'biz_ind_ux_ui', roles: ['ux-designer', 'ui-designer', 'interaction-designer', 'design-system', 'user-researcher', 'custom'] },
                    'graphic-design': { label: 'biz_ind_graphic_design', roles: ['graphic-designer', 'brand-designer', 'motion-designer', 'illustration', 'print-designer', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            development: {
                label: 'biz_domain_development',
                industries: {
                    'vibe-coding': { label: 'biz_ind_vibe_coding', roles: ['vibe-developer', 'ai-pair-programmer', 'prompt-engineer', 'rapid-prototyper', 'no-code-builder', 'custom'] },
                    'web-dev': { label: 'biz_ind_web_dev', roles: ['frontend-dev', 'backend-dev', 'fullstack-dev', 'web-architect', 'devops', 'custom'] },
                    'mobile-dev': { label: 'biz_ind_mobile_dev', roles: ['ios-dev', 'android-dev', 'react-native', 'flutter-dev', 'mobile-architect', 'custom'] },
                    'ai-ml': { label: 'biz_ind_ai_ml', roles: ['ml-engineer', 'data-scientist', 'ai-researcher', 'mlops-engineer', 'nlp-specialist', 'custom'] },
                    'ecommerce-dev': { label: 'biz_ind_ecommerce_dev', roles: ['shopify-dev', 'woocommerce-dev', 'api-integrator', 'payment-specialist', 'erp-developer', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            strategy: {
                label: 'biz_domain_strategy',
                industries: {
                    'ecom-strategy': { label: 'biz_ind_ecom_strategy', roles: ['ecom-strategist', 'marketplace-analyst', 'pricing-strategist', 'expansion-manager', 'omnichannel-lead', 'custom'] },
                    'brand-strategy': { label: 'biz_ind_brand_strategy', roles: ['brand-strategist', 'positioning-expert', 'competitive-analyst', 'market-researcher', 'trend-forecaster', 'custom'] },
                    'growth-strategy': { label: 'biz_ind_growth_strategy', roles: ['growth-strategist', 'acquisition-lead', 'retention-lead', 'monetization-lead', 'partnerships-lead', 'custom'] },
                    'consulting': { label: 'biz_ind_consulting', roles: ['strategy-consultant', 'management-consultant', 'digital-consultant', 'change-manager', 'process-consultant', 'custom'] },
                    'startup': { label: 'biz_ind_startup', roles: ['founder', 'coo', 'business-dev', 'chief-strategy', 'venture-partner', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            finance: {
                label: 'biz_domain_finance',
                industries: {
                    'ecom-finance': { label: 'biz_ind_ecom_finance', roles: ['ecom-controller', 'marketplace-analyst', 'payment-ops', 'fraud-analyst', 'revenue-ops', 'custom'] },
                    'corporate-finance': { label: 'biz_ind_corporate_finance', roles: ['cfo', 'fp-analyst', 'controller', 'treasury-manager', 'investor-relations', 'custom'] },
                    'accounting': { label: 'biz_ind_accounting', roles: ['auditor', 'tax-advisor', 'bookkeeper', 'management-accountant', 'compliance-officer', 'custom'] },
                    'investment': { label: 'biz_ind_investment', roles: ['analyst', 'portfolio-manager', 'research-analyst', 'quant-analyst', 'risk-manager', 'custom'] },
                    'business-finance': { label: 'biz_ind_business_finance', roles: ['budget-analyst', 'cost-analyst', 'profitability-analyst', 'cash-flow-manager', 'financial-planner', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            },
            hr: {
                label: 'biz_domain_hr',
                industries: {
                    'talent-acquisition': { label: 'biz_ind_talent_acquisition', roles: ['recruiter', 'hr-manager', 'sourcing-specialist', 'employer-branding', 'campus-recruiter', 'custom'] },
                    'org-development': { label: 'biz_ind_org_development', roles: ['od-specialist', 'hr-bp', 'culture-manager', 'engagement-specialist', 'change-consultant', 'custom'] },
                    'compensation': { label: 'biz_ind_compensation', roles: ['comp-analyst', 'benefits-specialist', 'total-rewards', 'payroll-manager', 'equity-admin', 'custom'] },
                    'learning': { label: 'biz_ind_learning', roles: ['learning-designer', 'training-manager', 'leadership-coach', 'lms-admin', 'performance-consultant', 'custom'] },
                    'hr-tech': { label: 'biz_ind_hr_tech', roles: ['hris-analyst', 'people-analytics', 'hr-systems', 'digital-hr', 'ai-hr-specialist', 'custom'] },
                    'custom': { label: 'biz_custom', roles: ['custom'] }
                }
            }
        };

        // è§’è‰²å°æ‡‰çš„æ¡†æ¶/æ¨¡å‹ - æ“´å±•ç‰ˆï¼ˆæ¯å€‹è§’è‰²è‡³å°‘5å€‹æ¡†æ¶é¸é …+è‡ªå®šç¾©ï¼‰
        const roleFrameworks = {
            // Marketing roles
            'growth-hacker': ['AARRR', 'North Star Metric', 'Growth Loop', 'Viral Coefficient', 'Activation Funnel', 'custom'],
            'content-marketer': ['Content Pillar', 'Topic Cluster', 'Editorial Calendar', 'Content Matrix', 'SEO Strategy', 'custom'],
            'demand-gen': ['Lead Scoring', 'MQL/SQL', 'Funnel Optimization', 'ABM Strategy', 'Nurture Workflow', 'custom'],
            'seo-specialist': ['Keyword Research', 'Technical SEO Audit', 'Link Building', 'Content Gap Analysis', 'SERP Analysis', 'custom'],
            'marketing-analyst': ['Marketing Mix Model', 'Attribution Analysis', 'Customer Segmentation', 'Campaign ROI', 'Cohort Analysis', 'custom'],
            'performance-marketer': ['ROAS Optimization', 'Attribution Model', 'LTV:CAC', 'Budget Allocation', 'Creative Testing', 'custom'],
            'brand-manager': ['Brand Equity Model', 'Brand Architecture', 'Positioning Map', 'Brand Pyramid', 'Competitive Mapping', 'custom'],
            'social-media': ['Content Calendar', 'Engagement Strategy', 'Influencer Matrix', 'Community Playbook', 'Crisis Management', 'custom'],
            'affiliate-manager': ['Commission Structure', 'Partner Recruitment', 'Performance Tracking', 'Affiliate Tier System', 'Payout Optimization', 'custom'],
            'crm-specialist': ['Customer Journey Map', 'Lifecycle Marketing', 'Personalization Engine', 'Retention Strategy', 'Win-back Campaign', 'custom'],
            'product-marketer': ['GTM Strategy', 'Competitive Analysis', 'Messaging Framework', 'Launch Playbook', 'Sales Enablement', 'custom'],
            'acquisition': ['CAC Analysis', 'Channel Mix', 'Conversion Funnel', 'Paid Media Strategy', 'Growth Experiments', 'custom'],
            'retention': ['Cohort Analysis', 'Churn Prediction', 'Retention Hooks', 'Customer Health Score', 'Engagement Loops', 'custom'],
            'compliance-marketer': ['Regulatory Compliance', 'Risk Assessment', 'Approval Workflow', 'Audit Trail', 'Policy Framework', 'custom'],
            'partnership-manager': ['Partner Ecosystem', 'Co-marketing Strategy', 'Revenue Share Model', 'Integration Roadmap', 'Partner Success', 'custom'],
            'healthcare-marketer': ['Patient Journey', 'HCP Engagement', 'Compliance Framework', 'Outcomes Marketing', 'Digital Health Strategy', 'custom'],
            'patient-acquisition': ['Referral Network', 'Community Outreach', 'Patient Funnel', 'Reputation Management', 'Appointment Optimization', 'custom'],
            'medical-writer': ['Clinical Documentation', 'Regulatory Writing', 'Patient Education', 'Scientific Communication', 'Content Validation', 'custom'],
            'pharma-marketer': ['KOL Engagement', 'Clinical Trial Marketing', 'Formulary Strategy', 'Multichannel Marketing', 'Compliance Protocol', 'custom'],
            'health-educator': ['Health Literacy Framework', 'Behavior Change Model', 'Community Education', 'Digital Health Tools', 'Outcome Measurement', 'custom'],
            'edu-marketer': ['Enrollment Funnel', 'Student Journey', 'Campus Marketing', 'Alumni Engagement', 'Program Promotion', 'custom'],
            'enrollment-specialist': ['Admission Strategy', 'Yield Optimization', 'Scholarship Framework', 'Application Process', 'Student Retention', 'custom'],
            'alumni-relations': ['Alumni Network', 'Giving Strategy', 'Event Planning', 'Mentorship Program', 'Career Services', 'custom'],
            'content-developer': ['Curriculum Design', 'Learning Objectives', 'Assessment Framework', 'Content Mapping', 'Accessibility Standards', 'custom'],
            'community-manager': ['Community Guidelines', 'Engagement Playbook', 'Moderation Framework', 'Growth Strategy', 'Member Journey', 'custom'],
            // Strategy roles
            'strategy-consultant': ['SWOT', 'Porter Five Forces', 'BCG Matrix', 'McKinsey 7S', 'Value Chain Analysis', 'custom'],
            'management-consultant': ['MECE', 'Hypothesis-driven', 'Issue Tree', 'Pyramid Principle', 'Change Management', 'custom'],
            'digital-consultant': ['Digital Maturity Model', 'Technology Roadmap', 'Digital Transformation', 'Agile Methodology', 'Innovation Framework', 'custom'],
            'change-manager': ['ADKAR Model', 'Kotter 8-Step', 'Change Impact Assessment', 'Stakeholder Analysis', 'Resistance Management', 'custom'],
            'process-consultant': ['Lean Six Sigma', 'Process Mapping', 'Value Stream Analysis', 'Kaizen', 'BPR Framework', 'custom'],
            'founder': ['Lean Canvas', 'Business Model Canvas', 'OKR', 'MVP Strategy', 'Pitch Deck Framework', 'custom'],
            'coo': ['Operations Framework', 'Process Optimization', 'KPI Dashboard', 'Resource Planning', 'Operational Excellence', 'custom'],
            'business-dev': ['Partnership Framework', 'Deal Structure', 'Revenue Model', 'Market Entry Strategy', 'Channel Strategy', 'custom'],
            'chief-strategy': ['Corporate Strategy', 'M&A Framework', 'Portfolio Management', 'Strategic Planning', 'Competitive Intelligence', 'custom'],
            'venture-partner': ['Due Diligence', 'Portfolio Strategy', 'Value Creation', 'Exit Planning', 'Syndication Strategy', 'custom'],
            'corporate-strategist': ['Ansoff Matrix', 'Value Chain', 'Scenario Planning', 'Blue Ocean Strategy', 'Core Competency Analysis', 'custom'],
            'biz-analyst': ['Data Analysis', 'Business Case', 'ROI Model', 'Requirements Gathering', 'Gap Analysis', 'custom'],
            'transformation-lead': ['Transformation Roadmap', 'Change Readiness', 'Digital Strategy', 'Operating Model', 'Culture Transformation', 'custom'],
            'innovation-manager': ['Design Thinking', 'Innovation Funnel', 'Open Innovation', 'Technology Scouting', 'Intrapreneurship', 'custom'],
            'market-intelligence': ['Competitive Analysis', 'Market Sizing', 'Trend Analysis', 'Customer Intelligence', 'Strategic Foresight', 'custom'],
            'pe-analyst': ['LBO Model', 'Deal Screening', 'Industry Analysis', 'Investment Thesis', 'Financial Modeling', 'custom'],
            'due-diligence': ['Commercial DD', 'Financial DD', 'Operational DD', 'Legal DD', 'Technology DD', 'custom'],
            'portfolio-ops': ['Value Creation Plan', 'Performance Monitoring', 'Best Practice Sharing', 'Exit Readiness', 'Management Assessment', 'custom'],
            'deal-sourcing': ['Deal Flow Management', 'Relationship Building', 'Market Mapping', 'Proprietary Sourcing', 'Intermediary Network', 'custom'],
            'value-creation': ['100-Day Plan', 'Revenue Enhancement', 'Cost Optimization', 'Digital Enablement', 'Organizational Design', 'custom'],
            'policy-analyst': ['Policy Analysis Framework', 'Impact Assessment', 'Stakeholder Mapping', 'Regulatory Analysis', 'Policy Recommendation', 'custom'],
            'program-manager': ['Program Governance', 'Benefits Realization', 'Risk Management', 'Resource Allocation', 'Performance Metrics', 'custom'],
            'public-affairs': ['Government Relations', 'Advocacy Strategy', 'Public Communication', 'Coalition Building', 'Issue Management', 'custom'],
            'regulatory-advisor': ['Compliance Framework', 'Regulatory Strategy', 'Risk Assessment', 'Policy Interpretation', 'Regulatory Filing', 'custom'],
            'strategic-planner': ['Long-term Planning', 'Scenario Analysis', 'Resource Allocation', 'Performance Framework', 'Strategic Alignment', 'custom'],
            // Sales roles
            'account-exec': ['SPIN Selling', 'Challenger Sale', 'MEDDIC', 'Solution Selling', 'Value Selling', 'custom'],
            'sales-engineer': ['Solution Selling', 'Technical Demo', 'POC Framework', 'Technical Discovery', 'Integration Planning', 'custom'],
            'sales-manager': ['Pipeline Management', 'Forecast Model', 'Territory Planning', 'Team Coaching', 'Sales Enablement', 'custom'],
            'enterprise-sales': ['Strategic Account Planning', 'Executive Alignment', 'Complex Deal Strategy', 'Procurement Navigation', 'Multi-threading', 'custom'],
            'channel-manager': ['Partner Program', 'Channel Strategy', 'Partner Enablement', 'Deal Registration', 'Channel Conflict Resolution', 'custom'],
            'retail-sales': ['Customer Engagement', 'Upselling Strategy', 'Visual Merchandising', 'Customer Loyalty', 'In-store Experience', 'custom'],
            'inside-sales': ['Call Scripts', 'Lead Qualification', 'CRM Management', 'Email Sequences', 'Virtual Selling', 'custom'],
            'telesales': ['Objection Handling', 'Script Optimization', 'Call Metrics', 'Appointment Setting', 'Follow-up Strategy', 'custom'],
            'showroom-manager': ['Floor Planning', 'Staff Scheduling', 'Customer Flow', 'Display Strategy', 'Sales Training', 'custom'],
            'customer-success': ['Onboarding Framework', 'Health Score', 'Expansion Strategy', 'Churn Prevention', 'QBR Process', 'custom'],
            'sdr': ['Outbound Prospecting', 'Cold Calling', 'Email Cadence', 'Social Selling', 'Lead Qualification', 'custom'],
            'bdr': ['Inbound Qualification', 'Lead Routing', 'Discovery Calls', 'Meeting Booking', 'Handoff Process', 'custom'],
            'account-manager': ['Account Planning', 'Relationship Building', 'Renewal Strategy', 'Cross-sell Framework', 'Customer Advocacy', 'custom'],
            'renewal-specialist': ['Renewal Playbook', 'At-risk Identification', 'Negotiation Strategy', 'Contract Management', 'Pricing Strategy', 'custom'],
            'solution-architect': ['Technical Design', 'Solution Mapping', 'Architecture Review', 'Integration Strategy', 'Scalability Planning', 'custom'],
            'real-estate-agent': ['Property Valuation', 'Market Analysis', 'Client Matching', 'Negotiation Strategy', 'Closing Process', 'custom'],
            'property-consultant': ['Investment Analysis', 'Portfolio Strategy', 'Market Trends', 'Due Diligence', 'Asset Management', 'custom'],
            'leasing-specialist': ['Lease Negotiation', 'Tenant Screening', 'Rent Optimization', 'Lease Renewal', 'Property Marketing', 'custom'],
            'investment-advisor': ['Investment Strategy', 'Risk Assessment', 'Portfolio Diversification', 'Market Timing', 'Exit Strategy', 'custom'],
            'development-sales': ['Pre-sale Strategy', 'Project Marketing', 'Buyer Qualification', 'Contract Negotiation', 'Settlement Process', 'custom'],
            'wholesale-rep': ['Territory Management', 'Dealer Relations', 'Volume Pricing', 'Inventory Management', 'Trade Shows', 'custom'],
            'key-account': ['Strategic Account Management', 'JBP Planning', 'Category Management', 'Trade Terms', 'Promotional Planning', 'custom'],
            'distributor-manager': ['Distribution Network', 'Partner Performance', 'Inventory Optimization', 'Market Coverage', 'Distributor Development', 'custom'],
            'trade-marketing': ['Trade Promotions', 'Retail Execution', 'POS Materials', 'Category Strategy', 'Shopper Marketing', 'custom'],
            'territory-manager': ['Territory Planning', 'Route Optimization', 'Coverage Strategy', 'Performance Tracking', 'Market Penetration', 'custom'],
            // Product roles
            'pm': ['PRD Template', 'User Story Mapping', 'Prioritization Matrix', 'Sprint Planning', 'Feature Specification', 'custom'],
            'senior-pm': ['Product Strategy', 'Roadmap Planning', 'Stakeholder Management', 'Go-to-Market', 'Competitive Positioning', 'custom'],
            'product-lead': ['Product Vision', 'Team Alignment', 'Metrics Framework', 'Portfolio Management', 'Innovation Pipeline', 'custom'],
            'technical-pm': ['Technical Requirements', 'API Strategy', 'System Architecture', 'Performance Optimization', 'Security Requirements', 'custom'],
            'platform-pm': ['Platform Strategy', 'Developer Experience', 'API Design', 'Ecosystem Development', 'Integration Framework', 'custom'],
            'consumer-pm': ['User Research', 'A/B Testing', 'Feature Prioritization', 'User Journey', 'Engagement Metrics', 'custom'],
            'ux-researcher': ['User Interview', 'Usability Testing', 'Survey Design', 'Persona Development', 'Journey Mapping', 'custom'],
            'growth-pm': ['Growth Experiments', 'Funnel Analysis', 'Activation Metrics', 'Retention Strategy', 'Viral Loops', 'custom'],
            'mobile-pm': ['Mobile UX', 'App Store Optimization', 'Push Strategy', 'Mobile Analytics', 'Cross-platform Strategy', 'custom'],
            'product-analyst': ['Product Analytics', 'Feature Adoption', 'User Segmentation', 'Funnel Analysis', 'Cohort Analysis', 'custom'],
            'enterprise-pm': ['Enterprise Requirements', 'Security Compliance', 'Integration Strategy', 'SLA Management', 'Customer Success', 'custom'],
            'api-pm': ['API Design', 'Developer Portal', 'Rate Limiting', 'Versioning Strategy', 'Documentation', 'custom'],
            'integration-pm': ['Integration Architecture', 'Partner API', 'Webhook Strategy', 'Data Mapping', 'Error Handling', 'custom'],
            'partner-pm': ['Partner Requirements', 'White-label Strategy', 'Co-development', 'Partner Success', 'Revenue Sharing', 'custom'],
            'product-ops': ['Product Operations', 'Process Optimization', 'Tool Management', 'Data Governance', 'Cross-functional Alignment', 'custom'],
            'hardware-pm': ['Hardware Requirements', 'Manufacturing Process', 'Supply Chain', 'Quality Assurance', 'Product Lifecycle', 'custom'],
            'iot-pm': ['IoT Architecture', 'Device Management', 'Connectivity Strategy', 'Edge Computing', 'Security Framework', 'custom'],
            'embedded-pm': ['Embedded Systems', 'Firmware Strategy', 'Hardware-Software Integration', 'Real-time Requirements', 'Power Management', 'custom'],
            'manufacturing-liaison': ['Manufacturing Process', 'Quality Control', 'Cost Optimization', 'Supplier Management', 'Production Planning', 'custom'],
            'quality-pm': ['Quality Framework', 'Testing Strategy', 'Defect Management', 'Quality Metrics', 'Continuous Improvement', 'custom'],
            'data-pm': ['Data Strategy', 'Data Pipeline', 'Data Quality', 'Data Governance', 'Analytics Platform', 'custom'],
            'ml-pm': ['ML Pipeline', 'Model Development', 'MLOps', 'Feature Engineering', 'Model Monitoring', 'custom'],
            'analytics-pm': ['Analytics Strategy', 'BI Tools', 'Dashboard Design', 'Self-service Analytics', 'Data Democratization', 'custom'],
            'bi-product-manager': ['BI Architecture', 'Reporting Framework', 'KPI Definition', 'Data Visualization', 'Insight Generation', 'custom'],
            'data-strategy': ['Data Architecture', 'Data Monetization', 'Data Partnerships', 'Privacy Framework', 'Data Ethics', 'custom'],
            // Finance roles
            'analyst': ['DCF Model', 'Comparable Analysis', 'Risk Assessment', 'Financial Modeling', 'Valuation Methods', 'custom'],
            'portfolio-manager': ['Asset Allocation', 'Risk Management', 'Performance Attribution', 'Rebalancing Strategy', 'Factor Investing', 'custom'],
            'research-analyst': ['Equity Research', 'Industry Analysis', 'Company Valuation', 'Investment Thesis', 'Earnings Model', 'custom'],
            'quant-analyst': ['Quantitative Models', 'Statistical Analysis', 'Algorithmic Trading', 'Risk Models', 'Backtesting', 'custom'],
            'risk-manager': ['Risk Framework', 'VaR Analysis', 'Stress Testing', 'Risk Reporting', 'Hedging Strategy', 'custom'],
            'cfo': ['Financial Planning', 'Capital Structure', 'Investor Relations', 'Treasury Management', 'Strategic Finance', 'custom'],
            'fp-analyst': ['Budget Planning', 'Variance Analysis', 'Forecasting', 'Financial Reporting', 'Business Partnering', 'custom'],
            'controller': ['Financial Controls', 'Close Process', 'Compliance', 'Audit Management', 'Policy Development', 'custom'],
            'treasury-manager': ['Cash Management', 'Liquidity Planning', 'FX Management', 'Banking Relations', 'Working Capital', 'custom'],
            'investor-relations': ['Investor Communication', 'Earnings Guidance', 'Shareholder Analysis', 'IR Strategy', 'ESG Reporting', 'custom'],
            'relationship-manager': ['Client Relationship', 'Needs Assessment', 'Product Recommendation', 'Portfolio Review', 'Client Retention', 'custom'],
            'credit-analyst': ['Credit Assessment', 'Risk Rating', 'Financial Analysis', 'Covenant Monitoring', 'Credit Policy', 'custom'],
            'trade-finance': ['Trade Products', 'LC Documentation', 'Risk Mitigation', 'Working Capital', 'Supply Chain Finance', 'custom'],
            'private-banker': ['Wealth Planning', 'Investment Advisory', 'Tax Planning', 'Estate Planning', 'Family Governance', 'custom'],
            'loan-officer': ['Loan Origination', 'Underwriting', 'Documentation', 'Compliance', 'Collection Strategy', 'custom'],
            'actuary': ['Actuarial Modeling', 'Pricing Strategy', 'Reserve Calculation', 'Risk Assessment', 'Regulatory Reporting', 'custom'],
            'underwriter': ['Risk Selection', 'Policy Pricing', 'Capacity Management', 'Treaty Negotiation', 'Claims Analysis', 'custom'],
            'claims-analyst': ['Claims Assessment', 'Fraud Detection', 'Settlement Strategy', 'Subrogation', 'Claims Reserve', 'custom'],
            'product-actuary': ['Product Development', 'Pricing Model', 'Profit Testing', 'Regulatory Filing', 'Market Analysis', 'custom'],
            'risk-assessor': ['Risk Evaluation', 'Site Inspection', 'Risk Recommendation', 'Loss Prevention', 'Risk Reporting', 'custom'],
            'auditor': ['Audit Planning', 'Internal Controls', 'Risk-based Audit', 'Audit Reporting', 'Remediation Tracking', 'custom'],
            'tax-advisor': ['Tax Planning', 'Compliance Strategy', 'Tax Optimization', 'Transfer Pricing', 'Tax Controversy', 'custom'],
            'forensic-accountant': ['Fraud Investigation', 'Litigation Support', 'Asset Tracing', 'Expert Testimony', 'Compliance Investigation', 'custom'],
            'management-accountant': ['Cost Accounting', 'Performance Analysis', 'Decision Support', 'Process Improvement', 'Management Reporting', 'custom'],
            'compliance-officer': ['Compliance Program', 'Regulatory Monitoring', 'Policy Development', 'Training Program', 'Incident Management', 'custom'],
            // HR roles
            'recruiter': ['Talent Pipeline', 'Employer Branding', 'Interview Framework', 'Sourcing Strategy', 'Candidate Experience', 'custom'],
            'hr-manager': ['Performance Management', 'Compensation Strategy', 'HR Analytics', 'Employee Relations', 'Policy Development', 'custom'],
            'sourcing-specialist': ['Talent Sourcing', 'Boolean Search', 'Talent Mapping', 'Pipeline Development', 'Market Intelligence', 'custom'],
            'employer-branding': ['EVP Development', 'Brand Strategy', 'Content Marketing', 'Social Media', 'Candidate Engagement', 'custom'],
            'campus-recruiter': ['Campus Strategy', 'University Relations', 'Internship Program', 'Event Planning', 'Early Talent', 'custom'],
            'od-specialist': ['Organization Design', 'Culture Assessment', 'Change Readiness', 'Team Effectiveness', 'Leadership Development', 'custom'],
            'hr-bp': ['Business Partnering', 'Workforce Planning', 'Talent Review', 'Succession Planning', 'Employee Engagement', 'custom'],
            'culture-manager': ['Culture Strategy', 'Values Activation', 'Employee Experience', 'Culture Measurement', 'Behavior Change', 'custom'],
            'engagement-specialist': ['Engagement Survey', 'Action Planning', 'Recognition Program', 'Communication Strategy', 'Wellbeing Initiative', 'custom'],
            'change-consultant': ['Change Strategy', 'Stakeholder Engagement', 'Communication Plan', 'Training Design', 'Adoption Measurement', 'custom'],
            'comp-analyst': ['Compensation Analysis', 'Market Benchmarking', 'Pay Equity', 'Salary Structure', 'Incentive Design', 'custom'],
            'benefits-specialist': ['Benefits Design', 'Vendor Management', 'Open Enrollment', 'Compliance', 'Employee Communication', 'custom'],
            'total-rewards': ['Total Rewards Strategy', 'Executive Compensation', 'Global Mobility', 'Recognition Framework', 'Rewards Philosophy', 'custom'],
            'payroll-manager': ['Payroll Processing', 'Compliance', 'Tax Reporting', 'System Management', 'Process Improvement', 'custom'],
            'equity-admin': ['Equity Programs', 'Stock Administration', 'Compliance Reporting', 'Participant Communication', 'System Management', 'custom'],
            'learning-designer': ['Instructional Design', 'Learning Experience', 'Content Development', 'Assessment Design', 'Learning Technology', 'custom'],
            'training-manager': ['Training Strategy', 'Needs Analysis', 'Program Delivery', 'Vendor Management', 'ROI Measurement', 'custom'],
            'leadership-coach': ['Executive Coaching', 'Leadership Assessment', 'Development Planning', 'Team Coaching', 'Succession Coaching', 'custom'],
            'lms-admin': ['LMS Management', 'Content Curation', 'Reporting Analytics', 'User Experience', 'Integration Management', 'custom'],
            'performance-consultant': ['Performance Analysis', 'Intervention Design', 'Process Improvement', 'Change Management', 'Measurement Strategy', 'custom'],
            'hris-analyst': ['System Administration', 'Data Management', 'Reporting', 'Process Automation', 'Integration', 'custom'],
            'people-analytics': ['Workforce Analytics', 'Predictive Modeling', 'Dashboard Development', 'Insight Generation', 'Data Storytelling', 'custom'],
            'hr-systems': ['System Implementation', 'Vendor Selection', 'Change Management', 'Data Migration', 'User Training', 'custom'],
            'digital-hr': ['Digital Transformation', 'Employee Experience', 'Process Automation', 'Self-service Portal', 'Chatbot Development', 'custom'],
            'ai-hr-specialist': ['AI Applications', 'ML in HR', 'Predictive Analytics', 'Automation Strategy', 'Ethical AI', 'custom'],
            // ==================== ç”¨æˆ¶è¡Œæ¥­è§’è‰² - E-commerce ====================
            'ecom-manager': ['Marketplace Strategy', 'Inventory Management', 'Pricing Optimization', 'Seller Performance', 'Platform Analytics', 'custom'],
            'fashion-buyer': ['Trend Forecasting', 'Vendor Negotiation', 'Seasonal Planning', 'Assortment Strategy', 'Margin Management', 'custom'],
            'visual-merchandiser': ['Display Strategy', 'Product Styling', 'Store Layout', 'Brand Presentation', 'Customer Flow', 'custom'],
            'product-stylist': ['Product Photography', 'Lifestyle Styling', 'Brand Aesthetics', 'Content Direction', 'Trend Interpretation', 'custom'],
            'category-manager': ['Category Strategy', 'Assortment Planning', 'Pricing Strategy', 'Vendor Management', 'Performance Analysis', 'custom'],
            'baby-product-manager': ['Safety Compliance', 'Age-appropriate Design', 'Parent Education', 'Product Testing', 'Regulatory Standards', 'custom'],
            'parent-community': ['Community Building', 'Parent Engagement', 'Content Strategy', 'Expert Partnerships', 'Support Groups', 'custom'],
            'safety-specialist': ['Safety Standards', 'Testing Protocols', 'Certification Process', 'Risk Assessment', 'Compliance Audit', 'custom'],
            'content-creator': ['Content Strategy', 'Video Production', 'Social Media', 'Influencer Collaboration', 'Brand Storytelling', 'custom'],
            'kol-manager': ['KOL Identification', 'Partnership Negotiation', 'Campaign Management', 'ROI Measurement', 'Relationship Building', 'custom'],
            'pet-product-manager': ['Pet Health Focus', 'Species-specific Design', 'Quality Standards', 'Vet Consultation', 'Product Testing', 'custom'],
            'pet-community': ['Pet Parent Engagement', 'Educational Content', 'Community Events', 'Expert Network', 'User Stories', 'custom'],
            'vet-consultant': ['Health Advisory', 'Product Validation', 'Nutrition Guidance', 'Safety Review', 'Expert Content', 'custom'],
            'pet-content': ['Pet Photography', 'Educational Videos', 'Care Guides', 'Product Reviews', 'Social Content', 'custom'],
            'pet-influencer': ['Influencer Partnerships', 'Brand Ambassadors', 'Campaign Strategy', 'Content Collaboration', 'Engagement Analytics', 'custom'],
            'toy-designer': ['Character Design', 'Articulation Design', 'Material Selection', 'Manufacturing Specs', 'Collectibility Features', 'custom'],
            'ip-manager': ['IP Development', 'Licensing Strategy', 'Brand Protection', 'Collaboration Management', 'Revenue Optimization', 'custom'],
            'collector-community': ['Collector Engagement', 'Limited Edition Strategy', 'Community Events', 'Resale Market', 'Authenticity Programs', 'custom'],
            'limited-edition': ['Drop Strategy', 'Scarcity Marketing', 'Pre-order Management', 'Launch Events', 'Exclusivity Programs', 'custom'],
            'collab-manager': ['Artist Partnerships', 'Brand Collaborations', 'Co-creation Process', 'Contract Negotiation', 'Launch Coordination', 'custom'],
            'tiktok-operator': ['TikTok Shop Management', 'Algorithm Optimization', 'Content Strategy', 'Affiliate Program', 'Performance Analytics', 'custom'],
            'live-host': ['Live Streaming', 'Audience Engagement', 'Product Demonstration', 'Sales Conversion', 'Follower Growth', 'custom'],
            'short-video': ['Video Production', 'Trend Riding', 'Hook Creation', 'Editing Techniques', 'Viral Strategy', 'custom'],
            'affiliate-tiktok': ['Affiliate Recruitment', 'Commission Structure', 'Performance Tracking', 'Relationship Management', 'Campaign Optimization', 'custom'],
            'tiktok-ads': ['TikTok Ads Manager', 'Creative Testing', 'Audience Targeting', 'Budget Optimization', 'Conversion Tracking', 'custom'],
            'shopee-operator': ['Shopee Seller Center', 'Listing Optimization', 'Promotional Tools', 'Order Management', 'Customer Service', 'custom'],
            'shopee-ads': ['Shopee Ads', 'Keyword Bidding', 'Product Boost', 'Discovery Ads', 'ROI Optimization', 'custom'],
            'flash-sale': ['Flash Deal Strategy', 'Inventory Planning', 'Pricing Strategy', 'Promotional Calendar', 'Performance Analysis', 'custom'],
            'shopee-live': ['Shopee Live', 'Streaming Schedule', 'Product Showcase', 'Viewer Engagement', 'Sales Conversion', 'custom'],
            'seller-support': ['Seller Performance', 'Policy Compliance', 'Issue Resolution', 'Rating Management', 'Account Health', 'custom'],
            'fb-shop-manager': ['Facebook Shop', 'Catalog Management', 'Checkout Optimization', 'Customer Engagement', 'Performance Tracking', 'custom'],
            'fb-ads-specialist': ['Facebook Ads Manager', 'Audience Building', 'Creative Testing', 'Conversion Campaigns', 'Pixel Optimization', 'custom'],
            'community-sales': ['Facebook Groups', 'Community Engagement', 'Social Selling', 'Trust Building', 'Group Management', 'custom'],
            'messenger-sales': ['Messenger Commerce', 'Chatbot Strategy', 'Quick Replies', 'Order Management', 'Customer Follow-up', 'custom'],
            'fb-live': ['Facebook Live', 'Live Shopping', 'Audience Interaction', 'Product Demos', 'Engagement Strategy', 'custom'],
            // ==================== Marketing - SEO/GEO ====================
            'geo-specialist': ['Local SEO', 'Google Business Profile', 'Location Strategy', 'Review Management', 'Citation Building', 'custom'],
            'local-seo': ['Local Keywords', 'Map Pack Optimization', 'Local Landing Pages', 'NAP Consistency', 'Local Link Building', 'custom'],
            'technical-seo': ['Site Architecture', 'Core Web Vitals', 'Schema Markup', 'Crawl Optimization', 'Site Speed', 'custom'],
            'content-seo': ['Keyword Research', 'Content Optimization', 'Topic Clusters', 'Search Intent', 'Featured Snippets', 'custom'],
            'influencer-manager': ['Influencer Identification', 'Campaign Planning', 'Contract Negotiation', 'Performance Tracking', 'Relationship Management', 'custom'],
            'viral-specialist': ['Viral Content Strategy', 'Trend Surfing', 'Shareable Content', 'Engagement Hooks', 'Platform Optimization', 'custom'],
            'paid-media': ['Paid Media Strategy', 'Channel Mix', 'Budget Allocation', 'Bid Strategy', 'Creative Testing', 'custom'],
            'conversion-optimizer': ['CRO Strategy', 'A/B Testing', 'Landing Page Optimization', 'User Flow Analysis', 'Conversion Funnel', 'custom'],
            'brand-strategist': ['Brand Positioning', 'Brand Architecture', 'Messaging Framework', 'Visual Identity', 'Brand Guidelines', 'custom'],
            'creative-director': ['Creative Strategy', 'Campaign Concepts', 'Art Direction', 'Brand Expression', 'Creative Brief', 'custom'],
            'campaign-manager': ['Campaign Planning', 'Execution Management', 'Timeline Coordination', 'Budget Management', 'Results Reporting', 'custom'],
            'pr-specialist': ['Media Relations', 'Press Release', 'Crisis Communication', 'Reputation Management', 'Influencer PR', 'custom'],
            'content-strategist': ['Content Strategy', 'Content Audit', 'Content Calendar', 'Channel Strategy', 'Performance Metrics', 'custom'],
            'copywriter': ['Copywriting', 'Brand Voice', 'Ad Copy', 'Product Description', 'Email Copy', 'custom'],
            'video-producer': ['Video Strategy', 'Production Planning', 'Post-production', 'Distribution Strategy', 'Video Analytics', 'custom'],
            'podcast-host': ['Podcast Strategy', 'Guest Booking', 'Episode Planning', 'Audience Growth', 'Monetization', 'custom'],
            'newsletter-manager': ['Newsletter Strategy', 'List Building', 'Content Curation', 'Engagement Optimization', 'Deliverability', 'custom'],
            // ==================== Product - Industry Specific ====================
            'fashion-pm': ['Fashion Product Lifecycle', 'Trend Integration', 'Size/Fit Optimization', 'Color Strategy', 'Material Innovation', 'custom'],
            'trend-analyst': ['Trend Research', 'Forecast Reports', 'Consumer Insights', 'Market Analysis', 'Competitive Tracking', 'custom'],
            'sourcing-manager': ['Supplier Management', 'Cost Negotiation', 'Quality Control', 'Lead Time Optimization', 'Sustainability Sourcing', 'custom'],
            'quality-controller': ['Quality Standards', 'Inspection Process', 'Defect Analysis', 'Supplier Audit', 'Continuous Improvement', 'custom'],
            'supply-chain': ['Supply Chain Strategy', 'Logistics Optimization', 'Inventory Management', 'Demand Planning', 'Risk Management', 'custom'],
            'baby-pm': ['Baby Product Safety', 'Age Segmentation', 'Parent Research', 'Development Milestones', 'Regulatory Compliance', 'custom'],
            'safety-pm': ['Safety Testing', 'Certification Process', 'Risk Assessment', 'Recall Prevention', 'Safety Standards', 'custom'],
            'parent-researcher': ['Parent Insights', 'User Testing', 'Focus Groups', 'Journey Mapping', 'Pain Point Analysis', 'custom'],
            'packaging-designer': ['Package Design', 'Shelf Impact', 'Sustainability', 'Unboxing Experience', 'Cost Optimization', 'custom'],
            'compliance-pm': ['Regulatory Compliance', 'Certification Management', 'Documentation', 'Audit Preparation', 'Policy Updates', 'custom'],
            'pet-pm': ['Pet Product Development', 'Species Research', 'Safety Testing', 'Vet Collaboration', 'Customer Feedback', 'custom'],
            'pet-nutritionist': ['Nutrition Formulation', 'Ingredient Sourcing', 'Health Claims', 'Regulatory Compliance', 'Quality Testing', 'custom'],
            'pet-safety': ['Pet Safety Standards', 'Material Testing', 'Choking Hazard Assessment', 'Durability Testing', 'Toxicity Screening', 'custom'],
            'pet-ux': ['Pet User Experience', 'Behavioral Testing', 'Owner Feedback', 'Usage Patterns', 'Design Iteration', 'custom'],
            'pet-innovation': ['Pet Tech Innovation', 'Smart Products', 'Connected Devices', 'Health Monitoring', 'App Integration', 'custom'],
            'toy-pm': ['Toy Development', 'Play Testing', 'Safety Compliance', 'Manufacturing Specs', 'Cost Management', 'custom'],
            'play-researcher': ['Play Patterns', 'Child Development', 'Educational Value', 'Engagement Testing', 'Age Appropriateness', 'custom'],
            'ip-developer': ['IP Creation', 'Character Development', 'Story Building', 'Brand Extension', 'Licensing Prep', 'custom'],
            'manufacturing-pm': ['Manufacturing Process', 'Vendor Management', 'Production Planning', 'Cost Control', 'Quality Assurance', 'custom'],
            'collector-pm': ['Collector Market', 'Limited Edition Strategy', 'Authenticity Features', 'Resale Value', 'Community Engagement', 'custom'],
            // ==================== Design ====================
            'industrial-designer': ['Product Design', 'CAD Modeling', 'Prototyping', 'Material Selection', 'Manufacturing Design', 'custom'],
            'cad-engineer': ['CAD Software', 'Technical Drawing', '3D Modeling', 'Design Validation', 'Manufacturing Specs', 'custom'],
            '3d-modeler': ['3D Modeling', 'Rendering', 'Animation', 'Texture Mapping', 'Model Optimization', 'custom'],
            'prototype-specialist': ['Rapid Prototyping', '3D Printing', 'Mock-up Creation', 'Testing Coordination', 'Iteration Management', 'custom'],
            'material-designer': ['Material Selection', 'Sustainable Materials', 'Cost Analysis', 'Supplier Sourcing', 'Quality Testing', 'custom'],
            'fashion-designer': ['Fashion Design', 'Collection Development', 'Trend Interpretation', 'Technical Sketching', 'Fabric Selection', 'custom'],
            'pattern-maker': ['Pattern Development', 'Grading', 'Fit Analysis', 'Technical Specs', 'Production Patterns', 'custom'],
            'textile-designer': ['Textile Design', 'Print Development', 'Fabric Innovation', 'Color Stories', 'Surface Design', 'custom'],
            'accessory-designer': ['Accessory Design', 'Hardware Selection', 'Material Innovation', 'Trend Research', 'Production Specs', 'custom'],
            'footwear-designer': ['Footwear Design', 'Last Development', 'Material Selection', 'Comfort Engineering', 'Production Specs', 'custom'],
            'toy-sculptor': ['Sculpture Design', 'Character Modeling', 'Articulation Design', 'Material Consideration', 'Production Ready', 'custom'],
            'character-designer': ['Character Creation', 'Visual Development', 'Style Guide', 'Personality Design', 'Brand Consistency', 'custom'],
            'color-specialist': ['Color Theory', 'Color Matching', 'Trend Colors', 'Production Colors', 'Color Management', 'custom'],
            'articulation-designer': ['Joint Design', 'Movement Range', 'Play Pattern', 'Durability Testing', 'Assembly Design', 'custom'],
            'ux-designer': ['User Experience', 'Wireframing', 'Prototyping', 'User Testing', 'Design Systems', 'custom'],
            'ui-designer': ['Interface Design', 'Visual Design', 'Component Library', 'Responsive Design', 'Design Specs', 'custom'],
            'interaction-designer': ['Interaction Patterns', 'Animation Design', 'Micro-interactions', 'User Flows', 'Gesture Design', 'custom'],
            'design-system': ['Design System', 'Component Library', 'Documentation', 'Governance', 'Adoption Strategy', 'custom'],
            'user-researcher': ['User Research', 'Usability Testing', 'Interview Techniques', 'Survey Design', 'Insight Synthesis', 'custom'],
            'graphic-designer': ['Graphic Design', 'Layout Design', 'Typography', 'Color Theory', 'Visual Hierarchy', 'custom'],
            'brand-designer': ['Brand Identity', 'Logo Design', 'Brand Guidelines', 'Visual System', 'Brand Applications', 'custom'],
            'motion-designer': ['Motion Graphics', 'Animation', 'Video Effects', 'Storytelling', 'After Effects', 'custom'],
            'illustration': ['Illustration', 'Character Art', 'Digital Painting', 'Vector Art', 'Style Development', 'custom'],
            'print-designer': ['Print Design', 'Packaging', 'Editorial Design', 'Production Files', 'Print Specs', 'custom'],
            // ==================== Development - Vibe Coding ====================
            'vibe-developer': ['AI-assisted Coding', 'Rapid Development', 'Prompt Engineering', 'Code Generation', 'Iterative Building', 'custom'],
            'ai-pair-programmer': ['AI Pair Programming', 'Code Review', 'Bug Fixing', 'Feature Implementation', 'Learning Loop', 'custom'],
            'prompt-engineer': ['Prompt Design', 'Context Optimization', 'Output Control', 'Chain of Thought', 'Few-shot Learning', 'custom'],
            'rapid-prototyper': ['Quick Prototyping', 'MVP Development', 'Iteration Speed', 'User Feedback Loop', 'Feature Prioritization', 'custom'],
            'no-code-builder': ['No-code Tools', 'Workflow Automation', 'App Building', 'Integration Setup', 'Rapid Deployment', 'custom'],
            'frontend-dev': ['Frontend Development', 'React/Vue/Angular', 'CSS/Styling', 'Performance', 'Accessibility', 'custom'],
            'backend-dev': ['Backend Development', 'API Design', 'Database Design', 'Security', 'Scalability', 'custom'],
            'fullstack-dev': ['Full Stack', 'End-to-end Development', 'Architecture', 'Deployment', 'DevOps', 'custom'],
            'web-architect': ['System Architecture', 'Scalability', 'Security Architecture', 'Tech Stack Selection', 'Performance Design', 'custom'],
            'devops': ['CI/CD', 'Infrastructure as Code', 'Containerization', 'Monitoring', 'Cloud Services', 'custom'],
            'ios-dev': ['iOS Development', 'Swift', 'SwiftUI', 'App Store', 'Performance', 'custom'],
            'android-dev': ['Android Development', 'Kotlin', 'Jetpack Compose', 'Play Store', 'Performance', 'custom'],
            'react-native': ['React Native', 'Cross-platform', 'Native Modules', 'Performance', 'App Store', 'custom'],
            'flutter-dev': ['Flutter', 'Dart', 'Cross-platform', 'Widget Design', 'Performance', 'custom'],
            'mobile-architect': ['Mobile Architecture', 'Cross-platform Strategy', 'Performance', 'Security', 'Scalability', 'custom'],
            'ml-engineer': ['Machine Learning', 'Model Training', 'Feature Engineering', 'MLOps', 'Model Deployment', 'custom'],
            'data-scientist': ['Data Analysis', 'Statistical Modeling', 'Python/R', 'Visualization', 'Business Insights', 'custom'],
            'ai-researcher': ['AI Research', 'Paper Implementation', 'Model Innovation', 'Experiment Design', 'Benchmarking', 'custom'],
            'mlops-engineer': ['MLOps', 'Model Pipeline', 'Monitoring', 'A/B Testing', 'Model Versioning', 'custom'],
            'nlp-specialist': ['NLP', 'Text Processing', 'Language Models', 'Sentiment Analysis', 'Chatbots', 'custom'],
            'shopify-dev': ['Shopify Development', 'Theme Customization', 'App Development', 'Liquid', 'Checkout Extension', 'custom'],
            'woocommerce-dev': ['WooCommerce', 'WordPress', 'Plugin Development', 'Theme Customization', 'Payment Gateway', 'custom'],
            'api-integrator': ['API Integration', 'Third-party Services', 'Webhook Management', 'Data Sync', 'Error Handling', 'custom'],
            'payment-specialist': ['Payment Gateway', 'Checkout Flow', 'Security Compliance', 'Multi-currency', 'Fraud Prevention', 'custom'],
            'erp-developer': ['ERP Integration', 'Inventory Sync', 'Order Management', 'Data Migration', 'System Automation', 'custom'],
            // ==================== Strategy ====================
            'ecom-strategist': ['E-commerce Strategy', 'Marketplace Analysis', 'Growth Planning', 'Channel Strategy', 'P&L Optimization', 'custom'],
            'marketplace-analyst': ['Marketplace Analysis', 'Competitive Intelligence', 'Pricing Analysis', 'Category Trends', 'Performance Metrics', 'custom'],
            'pricing-strategist': ['Pricing Strategy', 'Dynamic Pricing', 'Competitor Analysis', 'Margin Optimization', 'Promotional Pricing', 'custom'],
            'expansion-manager': ['Market Expansion', 'New Channel Entry', 'Localization Strategy', 'Partnership Development', 'Launch Planning', 'custom'],
            'omnichannel-lead': ['Omnichannel Strategy', 'Channel Integration', 'Customer Journey', 'Unified Commerce', 'Inventory Visibility', 'custom'],
            'positioning-expert': ['Brand Positioning', 'Competitive Differentiation', 'Value Proposition', 'Target Segmentation', 'Messaging Strategy', 'custom'],
            'competitive-analyst': ['Competitive Analysis', 'Market Mapping', 'SWOT Analysis', 'Strategy Monitoring', 'Opportunity Identification', 'custom'],
            'market-researcher': ['Market Research', 'Consumer Insights', 'Survey Design', 'Data Analysis', 'Trend Identification', 'custom'],
            'trend-forecaster': ['Trend Forecasting', 'Future Planning', 'Scenario Analysis', 'Innovation Spotting', 'Consumer Behavior', 'custom'],
            'growth-strategist': ['Growth Strategy', 'Acquisition Planning', 'Retention Strategy', 'Expansion Planning', 'Metrics Framework', 'custom'],
            'acquisition-lead': ['Customer Acquisition', 'Channel Strategy', 'CAC Optimization', 'Conversion Funnel', 'Growth Experiments', 'custom'],
            'retention-lead': ['Customer Retention', 'Loyalty Programs', 'Churn Prevention', 'Engagement Strategy', 'LTV Optimization', 'custom'],
            'monetization-lead': ['Monetization Strategy', 'Revenue Model', 'Pricing Optimization', 'Product Bundling', 'Value Capture', 'custom'],
            'partnerships-lead': ['Partnership Strategy', 'Business Development', 'Alliance Management', 'Revenue Sharing', 'Integration Planning', 'custom'],
            // ==================== Finance - E-commerce ====================
            'ecom-controller': ['E-commerce Finance', 'Marketplace Accounting', 'Revenue Recognition', 'Fee Analysis', 'Profitability Tracking', 'custom'],
            'payment-ops': ['Payment Operations', 'Settlement Management', 'Chargeback Handling', 'Payment Method Analysis', 'Fee Optimization', 'custom'],
            'fraud-analyst': ['Fraud Detection', 'Risk Assessment', 'Chargeback Analysis', 'Prevention Strategy', 'Pattern Recognition', 'custom'],
            'revenue-ops': ['Revenue Operations', 'Billing Management', 'Subscription Analytics', 'Revenue Forecasting', 'Process Optimization', 'custom'],
            'bookkeeper': ['Bookkeeping', 'Transaction Recording', 'Account Reconciliation', 'Financial Statements', 'Tax Preparation', 'custom'],
            'budget-analyst': ['Budget Analysis', 'Variance Reporting', 'Cost Control', 'Forecast Modeling', 'Resource Allocation', 'custom'],
            'cost-analyst': ['Cost Analysis', 'Cost Allocation', 'Profitability Analysis', 'Cost Reduction', 'Activity-based Costing', 'custom'],
            'profitability-analyst': ['Profitability Analysis', 'Product Margin', 'Channel Profitability', 'Customer Profitability', 'Pricing Analysis', 'custom'],
            'cash-flow-manager': ['Cash Flow Management', 'Working Capital', 'Liquidity Planning', 'Cash Forecasting', 'Collection Optimization', 'custom'],
            'financial-planner': ['Financial Planning', 'Business Planning', 'Scenario Analysis', 'Long-term Forecasting', 'Strategic Finance', 'custom'],
            'custom': ['SWOT Analysis', 'Business Model Canvas', 'OKR Framework', 'Design Thinking', 'Lean Methodology', 'custom']
        };

        // è§’è‰²æ¨™ç±¤æ˜ å°„ - ä½¿ç”¨ç¿»è­¯éµå€¼
        const roleLabels = {
            // Marketing roles
            'growth-hacker': 'biz_role_growth_hacker',
            'content-marketer': 'biz_role_content_marketer',
            'demand-gen': 'biz_role_demand_gen',
            'seo-specialist': 'biz_role_seo_specialist',
            'marketing-analyst': 'biz_role_marketing_analyst',
            'performance-marketer': 'biz_role_performance_marketer',
            'brand-manager': 'biz_role_brand_manager',
            'social-media': 'biz_role_social_media',
            'affiliate-manager': 'biz_role_affiliate_manager',
            'crm-specialist': 'biz_role_crm_specialist',
            'product-marketer': 'biz_role_product_marketer',
            'acquisition': 'biz_role_acquisition',
            'retention': 'biz_role_retention',
            'compliance-marketer': 'biz_role_compliance_marketer',
            'partnership-manager': 'biz_role_partnership_manager',
            'healthcare-marketer': 'biz_role_healthcare_marketer',
            'patient-acquisition': 'biz_role_patient_acquisition',
            'medical-writer': 'biz_role_medical_writer',
            'pharma-marketer': 'biz_role_pharma_marketer',
            'health-educator': 'biz_role_health_educator',
            'edu-marketer': 'biz_role_edu_marketer',
            'enrollment-specialist': 'biz_role_enrollment_specialist',
            'alumni-relations': 'biz_role_alumni_relations',
            'content-developer': 'biz_role_content_developer',
            'community-manager': 'biz_role_community_manager',
            // Strategy roles
            'strategy-consultant': 'biz_role_strategy_consultant',
            'management-consultant': 'biz_role_management_consultant',
            'digital-consultant': 'biz_role_digital_consultant',
            'change-manager': 'biz_role_change_manager',
            'process-consultant': 'biz_role_process_consultant',
            'founder': 'biz_role_founder',
            'coo': 'biz_role_coo',
            'business-dev': 'biz_role_business_dev',
            'chief-strategy': 'biz_role_chief_strategy',
            'venture-partner': 'biz_role_venture_partner',
            'corporate-strategist': 'biz_role_corporate_strategist',
            'biz-analyst': 'biz_role_biz_analyst',
            'transformation-lead': 'biz_role_transformation_lead',
            'innovation-manager': 'biz_role_innovation_manager',
            'market-intelligence': 'biz_role_market_intelligence',
            'pe-analyst': 'biz_role_pe_analyst',
            'due-diligence': 'biz_role_due_diligence',
            'portfolio-ops': 'biz_role_portfolio_ops',
            'deal-sourcing': 'biz_role_deal_sourcing',
            'value-creation': 'biz_role_value_creation',
            'policy-analyst': 'biz_role_policy_analyst',
            'program-manager': 'biz_role_program_manager',
            'public-affairs': 'biz_role_public_affairs',
            'regulatory-advisor': 'biz_role_regulatory_advisor',
            'strategic-planner': 'biz_role_strategic_planner',
            // Sales roles
            'account-exec': 'biz_role_account_exec',
            'sales-engineer': 'biz_role_sales_engineer',
            'sales-manager': 'biz_role_sales_manager',
            'enterprise-sales': 'biz_role_enterprise_sales',
            'channel-manager': 'biz_role_channel_manager',
            'retail-sales': 'biz_role_retail_sales',
            'inside-sales': 'biz_role_inside_sales',
            'telesales': 'biz_role_telesales',
            'showroom-manager': 'biz_role_showroom_manager',
            'customer-success': 'biz_role_customer_success',
            'sdr': 'biz_role_sdr',
            'bdr': 'biz_role_bdr',
            'account-manager': 'biz_role_account_manager',
            'renewal-specialist': 'biz_role_renewal_specialist',
            'solution-architect': 'biz_role_solution_architect',
            'real-estate-agent': 'biz_role_real_estate_agent',
            'property-consultant': 'biz_role_property_consultant',
            'leasing-specialist': 'biz_role_leasing_specialist',
            'investment-advisor': 'biz_role_investment_advisor',
            'development-sales': 'biz_role_development_sales',
            'wholesale-rep': 'biz_role_wholesale_rep',
            'key-account': 'biz_role_key_account',
            'distributor-manager': 'biz_role_distributor_manager',
            'trade-marketing': 'biz_role_trade_marketing',
            'territory-manager': 'biz_role_territory_manager',
            // Product roles
            'pm': 'biz_role_pm',
            'senior-pm': 'biz_role_senior_pm',
            'product-lead': 'biz_role_product_lead',
            'technical-pm': 'biz_role_technical_pm',
            'platform-pm': 'biz_role_platform_pm',
            'consumer-pm': 'biz_role_consumer_pm',
            'ux-researcher': 'biz_role_ux_researcher',
            'growth-pm': 'biz_role_growth_pm',
            'mobile-pm': 'biz_role_mobile_pm',
            'product-analyst': 'biz_role_product_analyst',
            'enterprise-pm': 'biz_role_enterprise_pm',
            'api-pm': 'biz_role_api_pm',
            'integration-pm': 'biz_role_integration_pm',
            'partner-pm': 'biz_role_partner_pm',
            'product-ops': 'biz_role_product_ops',
            'hardware-pm': 'biz_role_hardware_pm',
            'iot-pm': 'biz_role_iot_pm',
            'embedded-pm': 'biz_role_embedded_pm',
            'manufacturing-liaison': 'biz_role_manufacturing_liaison',
            'quality-pm': 'biz_role_quality_pm',
            'data-pm': 'biz_role_data_pm',
            'ml-pm': 'biz_role_ml_pm',
            'analytics-pm': 'biz_role_analytics_pm',
            'bi-product-manager': 'biz_role_bi_product_manager',
            'data-strategy': 'biz_role_data_strategy',
            // Finance roles
            'analyst': 'biz_role_analyst',
            'portfolio-manager': 'biz_role_portfolio_manager',
            'research-analyst': 'biz_role_research_analyst',
            'quant-analyst': 'biz_role_quant_analyst',
            'risk-manager': 'biz_role_risk_manager',
            'cfo': 'biz_role_cfo',
            'fp-analyst': 'biz_role_fp_analyst',
            'controller': 'biz_role_controller',
            'treasury-manager': 'biz_role_treasury_manager',
            'investor-relations': 'biz_role_investor_relations',
            'relationship-manager': 'biz_role_relationship_manager',
            'credit-analyst': 'biz_role_credit_analyst',
            'trade-finance': 'biz_role_trade_finance',
            'private-banker': 'biz_role_private_banker',
            'loan-officer': 'biz_role_loan_officer',
            'actuary': 'biz_role_actuary',
            'underwriter': 'biz_role_underwriter',
            'claims-analyst': 'biz_role_claims_analyst',
            'product-actuary': 'biz_role_product_actuary',
            'risk-assessor': 'biz_role_risk_assessor',
            'auditor': 'biz_role_auditor',
            'tax-advisor': 'biz_role_tax_advisor',
            'forensic-accountant': 'biz_role_forensic_accountant',
            'management-accountant': 'biz_role_management_accountant',
            'compliance-officer': 'biz_role_compliance_officer',
            // HR roles
            'recruiter': 'biz_role_recruiter',
            'hr-manager': 'biz_role_hr_manager',
            'sourcing-specialist': 'biz_role_sourcing_specialist',
            'employer-branding': 'biz_role_employer_branding',
            'campus-recruiter': 'biz_role_campus_recruiter',
            'od-specialist': 'biz_role_od_specialist',
            'hr-bp': 'biz_role_hr_bp',
            'culture-manager': 'biz_role_culture_manager',
            'engagement-specialist': 'biz_role_engagement_specialist',
            'change-consultant': 'biz_role_change_consultant',
            'comp-analyst': 'biz_role_comp_analyst',
            'benefits-specialist': 'biz_role_benefits_specialist',
            'total-rewards': 'biz_role_total_rewards',
            'payroll-manager': 'biz_role_payroll_manager',
            'equity-admin': 'biz_role_equity_admin',
            'learning-designer': 'biz_role_learning_designer',
            'training-manager': 'biz_role_training_manager',
            'leadership-coach': 'biz_role_leadership_coach',
            'lms-admin': 'biz_role_lms_admin',
            'performance-consultant': 'biz_role_performance_consultant',
            'hris-analyst': 'biz_role_hris_analyst',
            'people-analytics': 'biz_role_people_analytics',
            'hr-systems': 'biz_role_hr_systems',
            'digital-hr': 'biz_role_digital_hr',
            'ai-hr-specialist': 'biz_role_ai_hr_specialist',
            // ==================== ç”¨æˆ¶è¡Œæ¥­è§’è‰² - E-commerce ====================
            'ecom-manager': 'biz_role_ecom_manager',
            'fashion-buyer': 'biz_role_fashion_buyer',
            'visual-merchandiser': 'biz_role_visual_merchandiser',
            'product-stylist': 'biz_role_product_stylist',
            'category-manager': 'biz_role_category_manager',
            'baby-product-manager': 'biz_role_baby_product_manager',
            'parent-community': 'biz_role_parent_community',
            'safety-specialist': 'biz_role_safety_specialist',
            'content-creator': 'biz_role_content_creator',
            'kol-manager': 'biz_role_kol_manager',
            'pet-product-manager': 'biz_role_pet_product_manager',
            'pet-community': 'biz_role_pet_community',
            'vet-consultant': 'biz_role_vet_consultant',
            'pet-content': 'biz_role_pet_content',
            'pet-influencer': 'biz_role_pet_influencer',
            'toy-designer': 'biz_role_toy_designer',
            'ip-manager': 'biz_role_ip_manager',
            'collector-community': 'biz_role_collector_community',
            'limited-edition': 'biz_role_limited_edition',
            'collab-manager': 'biz_role_collab_manager',
            'tiktok-operator': 'biz_role_tiktok_operator',
            'live-host': 'biz_role_live_host',
            'short-video': 'biz_role_short_video',
            'affiliate-tiktok': 'biz_role_affiliate_tiktok',
            'tiktok-ads': 'biz_role_tiktok_ads',
            'shopee-operator': 'biz_role_shopee_operator',
            'shopee-ads': 'biz_role_shopee_ads',
            'flash-sale': 'biz_role_flash_sale',
            'shopee-live': 'biz_role_shopee_live',
            'seller-support': 'biz_role_seller_support',
            'fb-shop-manager': 'biz_role_fb_shop_manager',
            'fb-ads-specialist': 'biz_role_fb_ads_specialist',
            'community-sales': 'biz_role_community_sales',
            'messenger-sales': 'biz_role_messenger_sales',
            'fb-live': 'biz_role_fb_live',
            // ==================== Marketing - SEO/GEO ====================
            'geo-specialist': 'biz_role_geo_specialist',
            'local-seo': 'biz_role_local_seo',
            'technical-seo': 'biz_role_technical_seo',
            'content-seo': 'biz_role_content_seo',
            'influencer-manager': 'biz_role_influencer_manager',
            'viral-specialist': 'biz_role_viral_specialist',
            'paid-media': 'biz_role_paid_media',
            'conversion-optimizer': 'biz_role_conversion_optimizer',
            'brand-strategist': 'biz_role_brand_strategist',
            'creative-director': 'biz_role_creative_director',
            'campaign-manager': 'biz_role_campaign_manager',
            'pr-specialist': 'biz_role_pr_specialist',
            'content-strategist': 'biz_role_content_strategist',
            'copywriter': 'biz_role_copywriter',
            'video-producer': 'biz_role_video_producer',
            'podcast-host': 'biz_role_podcast_host',
            'newsletter-manager': 'biz_role_newsletter_manager',
            // ==================== Product - Industry Specific ====================
            'fashion-pm': 'biz_role_fashion_pm',
            'trend-analyst': 'biz_role_trend_analyst',
            'sourcing-manager': 'biz_role_sourcing_manager',
            'quality-controller': 'biz_role_quality_controller',
            'supply-chain': 'biz_role_supply_chain',
            'baby-pm': 'biz_role_baby_pm',
            'safety-pm': 'biz_role_safety_pm',
            'parent-researcher': 'biz_role_parent_researcher',
            'packaging-designer': 'biz_role_packaging_designer',
            'compliance-pm': 'biz_role_compliance_pm',
            'pet-pm': 'biz_role_pet_pm',
            'pet-nutritionist': 'biz_role_pet_nutritionist',
            'pet-safety': 'biz_role_pet_safety',
            'pet-ux': 'biz_role_pet_ux',
            'pet-innovation': 'biz_role_pet_innovation',
            'toy-pm': 'biz_role_toy_pm',
            'play-researcher': 'biz_role_play_researcher',
            'ip-developer': 'biz_role_ip_developer',
            'manufacturing-pm': 'biz_role_manufacturing_pm',
            'collector-pm': 'biz_role_collector_pm',
            // ==================== Design ====================
            'industrial-designer': 'biz_role_industrial_designer',
            'cad-engineer': 'biz_role_cad_engineer',
            '3d-modeler': 'biz_role_3d_modeler',
            'prototype-specialist': 'biz_role_prototype_specialist',
            'material-designer': 'biz_role_material_designer',
            'fashion-designer': 'biz_role_fashion_designer',
            'pattern-maker': 'biz_role_pattern_maker',
            'textile-designer': 'biz_role_textile_designer',
            'accessory-designer': 'biz_role_accessory_designer',
            'footwear-designer': 'biz_role_footwear_designer',
            'toy-sculptor': 'biz_role_toy_sculptor',
            'character-designer': 'biz_role_character_designer',
            'color-specialist': 'biz_role_color_specialist',
            'articulation-designer': 'biz_role_articulation_designer',
            'ux-designer': 'biz_role_ux_designer',
            'ui-designer': 'biz_role_ui_designer',
            'interaction-designer': 'biz_role_interaction_designer',
            'design-system': 'biz_role_design_system',
            'user-researcher': 'biz_role_user_researcher',
            'graphic-designer': 'biz_role_graphic_designer',
            'brand-designer': 'biz_role_brand_designer',
            'motion-designer': 'biz_role_motion_designer',
            'illustration': 'biz_role_illustration',
            'print-designer': 'biz_role_print_designer',
            // ==================== Development ====================
            'vibe-developer': 'biz_role_vibe_developer',
            'ai-pair-programmer': 'biz_role_ai_pair_programmer',
            'prompt-engineer': 'biz_role_prompt_engineer',
            'rapid-prototyper': 'biz_role_rapid_prototyper',
            'no-code-builder': 'biz_role_no_code_builder',
            'frontend-dev': 'biz_role_frontend_dev',
            'backend-dev': 'biz_role_backend_dev',
            'fullstack-dev': 'biz_role_fullstack_dev',
            'web-architect': 'biz_role_web_architect',
            'devops': 'biz_role_devops',
            'ios-dev': 'biz_role_ios_dev',
            'android-dev': 'biz_role_android_dev',
            'react-native': 'biz_role_react_native',
            'flutter-dev': 'biz_role_flutter_dev',
            'mobile-architect': 'biz_role_mobile_architect',
            'ml-engineer': 'biz_role_ml_engineer',
            'data-scientist': 'biz_role_data_scientist',
            'ai-researcher': 'biz_role_ai_researcher',
            'mlops-engineer': 'biz_role_mlops_engineer',
            'nlp-specialist': 'biz_role_nlp_specialist',
            'shopify-dev': 'biz_role_shopify_dev',
            'woocommerce-dev': 'biz_role_woocommerce_dev',
            'api-integrator': 'biz_role_api_integrator',
            'payment-specialist': 'biz_role_payment_specialist',
            'erp-developer': 'biz_role_erp_developer',
            // ==================== Strategy ====================
            'ecom-strategist': 'biz_role_ecom_strategist',
            'marketplace-analyst': 'biz_role_marketplace_analyst',
            'pricing-strategist': 'biz_role_pricing_strategist',
            'expansion-manager': 'biz_role_expansion_manager',
            'omnichannel-lead': 'biz_role_omnichannel_lead',
            'positioning-expert': 'biz_role_positioning_expert',
            'competitive-analyst': 'biz_role_competitive_analyst',
            'market-researcher': 'biz_role_market_researcher',
            'trend-forecaster': 'biz_role_trend_forecaster',
            'growth-strategist': 'biz_role_growth_strategist',
            'acquisition-lead': 'biz_role_acquisition_lead',
            'retention-lead': 'biz_role_retention_lead',
            'monetization-lead': 'biz_role_monetization_lead',
            'partnerships-lead': 'biz_role_partnerships_lead',
            // ==================== Finance - E-commerce ====================
            'ecom-controller': 'biz_role_ecom_controller',
            'payment-ops': 'biz_role_payment_ops',
            'fraud-analyst': 'biz_role_fraud_analyst',
            'revenue-ops': 'biz_role_revenue_ops',
            'bookkeeper': 'biz_role_bookkeeper',
            'budget-analyst': 'biz_role_budget_analyst',
            'cost-analyst': 'biz_role_cost_analyst',
            'profitability-analyst': 'biz_role_profitability_analyst',
            'cash-flow-manager': 'biz_role_cash_flow_manager',
            'financial-planner': 'biz_role_financial_planner',
            'custom': 'biz_custom'
        };
        
        // ç²å–ç¿»è­¯æ–‡æœ¬çš„è¼”åŠ©å‡½æ•¸
        function getTranslatedLabel(key) {
            return typeof t === 'function' ? t(key) : key;
        }

        // ä¸‰æ…‹åˆ‡æ›å‡½æ•¸
        function switchPromptMode(mode) {
            currentPromptMode = mode;
            
            // æ›´æ–° Tab æŒ‰éˆ•æ¨£å¼
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.style.background = 'white';
                tab.style.color = '#87CEEB';
            });
            
            const activeTab = document.getElementById('modeTab' + mode.charAt(0).toUpperCase() + mode.slice(1));
            if (activeTab) {
                activeTab.style.background = 'linear-gradient(135deg, #87CEEB 0%, #FFB6C1 100%)';
                activeTab.style.color = 'white';
            }
            
            // åˆ‡æ›é¡¯ç¤ºçš„æ¨¡å¼å€å¡Š
            document.querySelectorAll('.prompt-mode').forEach(modeDiv => {
                modeDiv.style.display = 'none';
            });
            
            document.getElementById(mode + 'Mode').style.display = 'block';
            
            // æ¸…ç©ºçµæœå€
            document.getElementById('promptResult').innerHTML = `<p style="text-align: center; color: #888; padding: 40px;">é¸æ“‡æ¨¡å¼ä¸¦å¡«å¯«åƒæ•¸å¾Œï¼Œé»æ“Šç”ŸæˆæŒ‰éˆ•ç²å–å°ˆæ¥­ Prompt</p>`;
            document.getElementById('promptActions').style.display = 'none';
        }

        // æ›´æ–°è¡Œæ¥­é¸é …
        function updateBizIndustry() {
            const domain = document.getElementById('bizDomain').value;
            const industrySelect = document.getElementById('bizIndustry');
            const customInput = document.getElementById('bizDomainCustom');
            
            // è™•ç†è‡ªå®šç¾© - L1 é¸æ“‡è‡ªå®šç¾©æ™‚ï¼ŒL2-L4 å…¨éƒ¨åˆ‡æ›ç‚ºè‡ªå®šç¾©æ¨¡å¼
            if (domain === 'custom') {
                customInput.style.display = 'block';
                // éš±è— L2 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L2 è‡ªå®šç¾©è¼¸å…¥
                industrySelect.style.display = 'none';
                document.getElementById('bizIndustryCustom').style.display = 'block';
                // éš±è— L3 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L3 è‡ªå®šç¾©è¼¸å…¥
                document.getElementById('bizRole').style.display = 'none';
                document.getElementById('bizRoleCustom').style.display = 'block';
                // éš±è— L4 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L4 è‡ªå®šç¾©è¼¸å…¥
                document.getElementById('bizFramework').style.display = 'none';
                document.getElementById('bizFrameworkCustom').style.display = 'block';
            } else {
                customInput.style.display = 'none';
                // æ¢å¾© L2-L4 ä¸‹æ‹‰é¸å–®
                industrySelect.style.display = 'block';
                document.getElementById('bizIndustryCustom').style.display = 'none';
                document.getElementById('bizRole').style.display = 'block';
                document.getElementById('bizRoleCustom').style.display = 'none';
                document.getElementById('bizFramework').style.display = 'block';
                document.getElementById('bizFrameworkCustom').style.display = 'none';
            }
            
            // é‡ç½®å¾ŒçºŒé¸é …
            industrySelect.innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_industry') + ' --</option>';
            document.getElementById('bizRole').innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_industry_first') + ' --</option>';
            document.getElementById('bizFramework').innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_role_first') + ' --</option>';
            
            if (domain && domain !== 'custom' && bizData[domain]) {
                const industries = bizData[domain].industries;
                for (const [key, value] of Object.entries(industries)) {
                    const option = document.createElement('option');
                    option.value = key;
                    option.textContent = getTranslatedLabel(value.label);
                    industrySelect.appendChild(option);
                }
            }
        }

        // æ›´æ–°è§’è‰²é¸é …
        function updateBizRole() {
            const domain = document.getElementById('bizDomain').value;
            const industry = document.getElementById('bizIndustry').value;
            const roleSelect = document.getElementById('bizRole');
            const customInput = document.getElementById('bizIndustryCustom');
            
            // L2 é¸æ“‡è‡ªå®šç¾©æ™‚ï¼ŒL3-L4 ä¹Ÿåˆ‡æ›ç‚ºè‡ªå®šç¾©æ¨¡å¼
            if (industry === 'custom') {
                customInput.style.display = 'block';
                // éš±è— L3 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L3 è‡ªå®šç¾©è¼¸å…¥
                roleSelect.style.display = 'none';
                document.getElementById('bizRoleCustom').style.display = 'block';
                // éš±è— L4 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L4 è‡ªå®šç¾©è¼¸å…¥
                document.getElementById('bizFramework').style.display = 'none';
                document.getElementById('bizFrameworkCustom').style.display = 'block';
            } else {
                customInput.style.display = 'none';
                // æ¢å¾© L3-L4 ä¸‹æ‹‰é¸å–®
                roleSelect.style.display = 'block';
                document.getElementById('bizRoleCustom').style.display = 'none';
                document.getElementById('bizFramework').style.display = 'block';
                document.getElementById('bizFrameworkCustom').style.display = 'none';
            }
            
            roleSelect.innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_role') + ' --</option>';
            document.getElementById('bizFramework').innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_role_first') + ' --</option>';
            
            if (domain && industry && domain !== 'custom' && industry !== 'custom' && bizData[domain]?.industries[industry]) {
                const roles = bizData[domain].industries[industry].roles;
                roles.forEach(role => {
                    const option = document.createElement('option');
                    option.value = role;
                    option.textContent = getTranslatedLabel(roleLabels[role]) || role;
                    roleSelect.appendChild(option);
                });
            }
        }

        // æ›´æ–°æ¡†æ¶é¸é …
        function updateBizFramework() {
            const domain = document.getElementById('bizDomain').value;
            const industry = document.getElementById('bizIndustry').value;
            const role = document.getElementById('bizRole').value;
            const frameworkSelect = document.getElementById('bizFramework');
            const customInput = document.getElementById('bizRoleCustom');
            
            // L3 é¸æ“‡è‡ªå®šç¾©æ™‚ï¼ŒL4 ä¹Ÿåˆ‡æ›ç‚ºè‡ªå®šç¾©æ¨¡å¼
            if (role === 'custom') {
                customInput.style.display = 'block';
                // éš±è— L4 ä¸‹æ‹‰é¸å–®ï¼Œé¡¯ç¤º L4 è‡ªå®šç¾©è¼¸å…¥
                frameworkSelect.style.display = 'none';
                document.getElementById('bizFrameworkCustom').style.display = 'block';
            } else {
                customInput.style.display = 'none';
                // æ¢å¾© L4 ä¸‹æ‹‰é¸å–®
                frameworkSelect.style.display = 'block';
                document.getElementById('bizFrameworkCustom').style.display = 'none';
            }
            
            frameworkSelect.innerHTML = '<option value="">-- ' + getTranslatedLabel('biz_select_framework') + ' --</option>';
            
            if (role && role !== 'custom' && roleFrameworks[role]) {
                roleFrameworks[role].forEach(framework => {
                    const option = document.createElement('option');
                    option.value = framework;
                    if (framework === 'custom') {
                        option.textContent = getTranslatedLabel('biz_custom');
                    } else {
                        const fwKey = 'biz_fw_' + framework.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '');
                        option.textContent = getTranslatedLabel(fwKey) || framework;
                    }
                    frameworkSelect.appendChild(option);
                });
            }
        }

        // è™•ç†æ¡†æ¶é¸æ“‡è®ŠåŒ–
        function handleFrameworkChange() {
            const framework = document.getElementById('bizFramework').value;
            const customInput = document.getElementById('bizFrameworkCustom');
            
            if (framework === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
            }
        }

        // ç”Ÿæˆå•†æ¥­ Prompt (ä½¿ç”¨ AI æ·±åº¦ç”Ÿæˆ)
        async function generateBusinessPrompt() {
            const domainValue = document.getElementById('bizDomain').value;
            const industryValue = document.getElementById('bizIndustry').value;
            const roleValue = document.getElementById('bizRole').value;
            const frameworkValue = document.getElementById('bizFramework').value;
            
            // åˆ¤æ–·æ˜¯å¦è™•æ–¼è‡ªå®šç¾©æ¨¡å¼ï¼ˆL1 é¸æ“‡ custom æ™‚ï¼ŒL2-L4 éƒ½æ˜¯è‡ªå®šç¾©è¼¸å…¥ï¼‰
            const isL1Custom = domainValue === 'custom';
            const isL2Custom = industryValue === 'custom' || isL1Custom;
            const isL3Custom = roleValue === 'custom' || isL2Custom;
            
            // ç²å–å„å±¤ç´šçš„å€¼
            let domain, industry, role, framework;
            
            if (isL1Custom) {
                domain = document.getElementById('bizDomainCustom').value;
                industry = document.getElementById('bizIndustryCustom').value;
                role = document.getElementById('bizRoleCustom').value;
                framework = document.getElementById('bizFrameworkCustom').value;
            } else {
                domain = getTranslatedLabel(bizData[domainValue]?.label) || domainValue;
                
                if (isL2Custom) {
                    industry = document.getElementById('bizIndustryCustom').value;
                    role = document.getElementById('bizRoleCustom').value;
                    framework = document.getElementById('bizFrameworkCustom').value;
                } else {
                    industry = document.getElementById('bizIndustry').options[document.getElementById('bizIndustry').selectedIndex]?.text || '';
                    
                    if (isL3Custom) {
                        role = document.getElementById('bizRoleCustom').value;
                        framework = document.getElementById('bizFrameworkCustom').value;
                    } else {
                        role = getTranslatedLabel(roleLabels[roleValue]) || roleValue;
                        
                        if (frameworkValue === 'custom') {
                            framework = document.getElementById('bizFrameworkCustom').value;
                        } else {
                            // å–å¾—ç¿»è­¯å¾Œçš„æ¡†æ¶åç¨±
                            const fwKey = 'biz_fw_' + frameworkValue.toLowerCase().replace(/[^a-z0-9]+/g, '_').replace(/_+/g, '_').replace(/^_|_$/g, '');
                            framework = getTranslatedLabel(fwKey) || frameworkValue;
                        }
                    }
                }
            }
            
            const context = document.getElementById('bizContext').value;

            if (!domain || !industry || !role || !framework) {
                showPromptStatus(getTranslatedLabel('biz_fill_all_fields'), 'error');
                return;
            }

            // é¡¯ç¤º AI è™•ç†ä¸­ç‹€æ…‹
            const btn = document.getElementById('bizGenerateBtn');
            btn.disabled = true;
            btn.innerHTML = 'ğŸ¤– AI æ·±åº¦æ€è€ƒä¸­...';
            showPromptStatus('ğŸ”„ AI æ­£åœ¨åˆ†ææ‚¨çš„å°ˆæ¥­èƒŒæ™¯ä¸¦ç”Ÿæˆæ·±åº¦ Prompt...', 'info');

            try {
                const response = await fetch('/api/refine-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: 'business',
                        domain: domain,
                        industry: industry,
                        role: role,
                        framework: framework,
                        context: context
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'AI è™•ç†å¤±æ•—');
                }

                currentGeneratedPrompt = data.refinedPrompt;
                displayPromptResult(currentGeneratedPrompt);
                showPromptStatus('âœ… AI å·²ç”Ÿæˆå°ˆæ¥­ç´š System Promptï¼', 'success');

            } catch (error) {
                console.error('Business prompt generation error:', error);
                showPromptStatus('âŒ ' + error.message, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸš€ ' + getTranslatedLabel('biz_generate_prompt');
            }
        }

        // ç”Ÿæˆè»Ÿé«”é–‹ç™¼ Prompt (èª¿ç”¨ AI)
        async function generateCodingPrompt() {
            const input = document.getElementById('codingInput').value;
            const platform = document.getElementById('codingPlatform').value;
            const complexity = document.getElementById('codingComplexity').value;

            if (!input.trim()) {
                showPromptStatus('è«‹è¼¸å…¥æ‚¨çš„è»Ÿé«”éœ€æ±‚æè¿°', 'error');
                return;
            }

            const btn = document.getElementById('codingGenerateBtn');
            btn.disabled = true;
            btn.innerHTML = 'ğŸ”„ AI è™•ç†ä¸­...';

            try {
                const references = await prepareReferencesForAPI('coding');
                
                const response = await fetch('/api/refine-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: 'coding',
                        input: input,
                        platform: platform,
                        complexity: complexity,
                        references: references
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'AI è™•ç†å¤±æ•—');
                }

                currentGeneratedPrompt = data.refinedPrompt;
                displayPromptResult(currentGeneratedPrompt);
                showPromptStatus('âœ… PRD å·²ç”Ÿæˆï¼å¯è¤‡è£½ä½¿ç”¨æ–¼ Gemini / ChatGPT', 'success');

            } catch (error) {
                console.error('Coding prompt error:', error);
                showPromptStatus(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¤– AI è½‰è­¯ç‚ºçµæ§‹åŒ– PRD';
            }
        }

        // ç”Ÿæˆè¦–è¦ºç¹ªåœ– Prompt (èª¿ç”¨ AI)
        function toggleCustomModelInput() {
            const modelSelect = document.getElementById('imageModel');
            const customInput = document.getElementById('customModelName');
            if (modelSelect.value === 'custom') {
                customInput.style.display = 'block';
            } else {
                customInput.style.display = 'none';
                customInput.value = '';
            }
        }

        // ==================== åƒè€ƒè³‡æ–™ä¸Šå‚³åŠŸèƒ½ ====================
        const uploadedReferences = {
            coding: [],
            image: []
        };

        function handleDragOver(event, mode) {
            event.preventDefault();
            event.stopPropagation();
            const zone = document.getElementById(mode + 'UploadZone');
            zone.style.borderColor = mode === 'coding' ? '#2196F3' : '#9C27B0';
            zone.style.background = mode === 'coding' ? '#E3F2FD' : '#F3E5F5';
        }

        function handleDragLeave(event, mode) {
            event.preventDefault();
            event.stopPropagation();
            const zone = document.getElementById(mode + 'UploadZone');
            zone.style.borderColor = mode === 'coding' ? '#90CAF9' : '#CE93D8';
            zone.style.background = '#fff';
        }

        function handleDrop(event, mode) {
            event.preventDefault();
            event.stopPropagation();
            handleDragLeave(event, mode);
            
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                processFiles(files, mode);
            }
        }

        function handleFileSelect(event, mode) {
            const files = event.target.files;
            if (files.length > 0) {
                processFiles(files, mode);
            }
        }

        async function processFiles(files, mode) {
            for (let file of files) {
                const fileType = getFileType(file);
                const fileData = {
                    type: 'file',
                    fileType: fileType,
                    name: file.name,
                    size: file.size,
                    file: file
                };

                if (fileType === 'image') {
                    fileData.preview = await readFileAsDataURL(file);
                }

                uploadedReferences[mode].push(fileData);
            }
            updateUploadedList(mode);
        }

        function readFileAsDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                reader.readAsDataURL(file);
            });
        }

        function getFileType(file) {
            const ext = file.name.split('.').pop().toLowerCase();
            const mimeType = file.type;

            if (mimeType.startsWith('image/') || ['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp', 'svg'].includes(ext)) {
                return 'image';
            } else if (ext === 'pdf' || mimeType === 'application/pdf') {
                return 'pdf';
            } else if (['doc', 'docx'].includes(ext) || mimeType.includes('word')) {
                return 'word';
            } else if (['xls', 'xlsx'].includes(ext) || mimeType.includes('excel') || mimeType.includes('spreadsheet')) {
                return 'excel';
            } else if (['ppt', 'pptx'].includes(ext) || mimeType.includes('presentation')) {
                return 'ppt';
            } else if (ext === 'md') {
                return 'markdown';
            } else {
                return 'text';
            }
        }

        function addUrlReference(mode) {
            const inputId = mode + 'UrlInput';
            const urlInput = document.getElementById(inputId);
            const url = urlInput.value.trim();

            if (!url) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„ç¶²å€');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('è«‹è¼¸å…¥å®Œæ•´çš„ç¶²å€ (http:// æˆ– https://)');
                return;
            }

            const urlData = {
                type: 'url',
                url: url,
                name: url.length > 40 ? url.substring(0, 40) + '...' : url
            };

            uploadedReferences[mode].push(urlData);
            urlInput.value = '';
            updateUploadedList(mode);
        }

        function updateUploadedList(mode) {
            const container = document.getElementById(mode + 'UploadedItems');
            const list = document.getElementById(mode + 'UploadedList');
            const refs = uploadedReferences[mode];

            if (refs.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.style.display = 'block';
            list.innerHTML = '';

            refs.forEach((ref, index) => {
                const item = document.createElement('div');
                item.style.cssText = 'display: flex; align-items: center; gap: 6px; background: #f5f5f5; padding: 6px 10px; border-radius: 8px; font-size: 12px;';

                const icon = getFileIcon(ref);
                const name = ref.type === 'url' ? ref.name : ref.name;

                let preview = '';
                if (ref.type === 'file' && ref.fileType === 'image' && ref.preview) {
                    preview = `<img src="${ref.preview}" style="width: 24px; height: 24px; object-fit: cover; border-radius: 4px; margin-right: 4px;">`;
                }

                item.innerHTML = `
                    ${preview}
                    <span>${icon}</span>
                    <span style="max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name}</span>
                    <button type="button" onclick="removeReference('${mode}', ${index})" style="background: none; border: none; cursor: pointer; padding: 2px; color: #999; font-size: 14px;">âœ•</button>
                `;
                list.appendChild(item);
            });
        }

        function getFileIcon(ref) {
            if (ref.type === 'url') return 'ğŸ”—';
            switch (ref.fileType) {
                case 'image': return 'ğŸ–¼ï¸';
                case 'pdf': return 'ğŸ“„';
                case 'word': return 'ğŸ“';
                case 'excel': return 'ğŸ“Š';
                case 'ppt': return 'ğŸ“½ï¸';
                case 'markdown': return 'ğŸ“‹';
                default: return 'ğŸ“„';
            }
        }

        function removeReference(mode, index) {
            uploadedReferences[mode].splice(index, 1);
            updateUploadedList(mode);
        }

        async function prepareReferencesForAPI(mode) {
            const refs = uploadedReferences[mode];
            const preparedRefs = [];

            for (let ref of refs) {
                if (ref.type === 'url') {
                    preparedRefs.push({
                        type: 'url',
                        url: ref.url
                    });
                } else if (ref.type === 'file') {
                    if (ref.fileType === 'image') {
                        preparedRefs.push({
                            type: 'image',
                            name: ref.name,
                            data: ref.preview
                        });
                    } else {
                        const textContent = await readFileAsText(ref.file);
                        preparedRefs.push({
                            type: 'document',
                            fileType: ref.fileType,
                            name: ref.name,
                            content: textContent
                        });
                    }
                }
            }

            return preparedRefs;
        }

        function readFileAsText(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => resolve(e.target.result);
                reader.onerror = (e) => reject(e);
                
                if (file.type === 'application/pdf') {
                    resolve('[PDF æª”æ¡ˆ - éœ€è¦å¾Œç«¯è§£æ]');
                } else if (file.name.endsWith('.docx') || file.name.endsWith('.doc')) {
                    resolve('[Word æª”æ¡ˆ - éœ€è¦å¾Œç«¯è§£æ]');
                } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    resolve('[Excel æª”æ¡ˆ - éœ€è¦å¾Œç«¯è§£æ]');
                } else if (file.name.endsWith('.pptx') || file.name.endsWith('.ppt')) {
                    resolve('[PPT æª”æ¡ˆ - éœ€è¦å¾Œç«¯è§£æ]');
                } else {
                    reader.readAsText(file);
                }
            });
        }

        async function generateImagePrompt() {
            const input = document.getElementById('imageInput').value;
            const style = document.getElementById('imageStyle').value;
            const ratio = document.getElementById('imageRatio').value;
            const imageModel = document.getElementById('imageModel').value;
            const customModelName = document.getElementById('customModelName')?.value || '';
            const imageSteps = document.getElementById('imageSteps')?.value || '';
            const imageFormat = document.getElementById('imageFormat')?.value || '';
            
            const qualityTags = [];
            if (document.getElementById('imgQualityHD')?.checked) qualityTags.push('HD');
            if (document.getElementById('imgQuality8K')?.checked) qualityTags.push('8K');
            if (document.getElementById('imgQualityDetail')?.checked) qualityTags.push('highly detailed');
            if (document.getElementById('imgQualityLighting')?.checked) qualityTags.push('professional lighting');

            if (!input.trim()) {
                showPromptStatus('è«‹è¼¸å…¥æ‚¨æƒ³ç”Ÿæˆçš„ç•«é¢æè¿°', 'error');
                return;
            }

            if (imageModel === 'custom' && !customModelName.trim()) {
                showPromptStatus('è«‹è¼¸å…¥è‡ªå®šç¾©æ¨¡å‹åç¨±', 'error');
                return;
            }

            const btn = document.getElementById('imageGenerateBtn');
            btn.disabled = true;
            btn.innerHTML = 'ğŸ”„ AI è™•ç†ä¸­...';

            const modelNames = {
                'nanobanana': 'Nano Banana (FLUX)',
                'gpt': 'GPT (DALL-E 3)',
                'midjourney': 'Midjourney',
                'custom': customModelName
            };

            try {
                const references = await prepareReferencesForAPI('image');
                
                const response = await fetch('/api/refine-prompt', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        mode: 'image',
                        input: input,
                        style: style,
                        ratio: ratio,
                        qualityTags: qualityTags,
                        imageModel: imageModel,
                        customModelName: customModelName,
                        imageSteps: imageSteps,
                        imageFormat: imageFormat,
                        references: references
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'AI è™•ç†å¤±æ•—');
                }

                currentGeneratedPrompt = data.refinedPrompt;
                displayPromptResult(currentGeneratedPrompt);
                showPromptStatus(`âœ… ${modelNames[imageModel]} å°ˆç”¨ç¹ªåœ–æŒ‡ä»¤å·²ç”Ÿæˆï¼`, 'success');

            } catch (error) {
                console.error('Image prompt error:', error);
                showPromptStatus(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'ğŸ¨ AI ç”Ÿæˆç¹ªåœ–æŒ‡ä»¤';
            }
        }

        // é¡¯ç¤º Prompt çµæœ
        function displayPromptResult(prompt) {
            const resultDiv = document.getElementById('promptResult');
            resultDiv.innerHTML = prompt.replace(/\n/g, '<br>');
            document.getElementById('promptActions').style.display = 'flex';
        }

        // é¡¯ç¤ºç‹€æ…‹æç¤º
        function showPromptStatus(message, type) {
            const statusDiv = document.getElementById('promptStatus');
            statusDiv.style.display = 'block';
            statusDiv.style.background = type === 'success' ? '#d4edda' : '#f8d7da';
            statusDiv.style.color = type === 'success' ? '#155724' : '#721c24';
            statusDiv.innerHTML = message;
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        // ä¸€éµè¤‡è£½
        function copyPromptToClipboard() {
            if (!currentGeneratedPrompt) {
                showPromptStatus('æ²’æœ‰å¯è¤‡è£½çš„å…§å®¹', 'error');
                return;
            }

            navigator.clipboard.writeText(currentGeneratedPrompt).then(() => {
                showPromptStatus('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
            }).catch(err => {
                console.error('Copy failed:', err);
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = currentGeneratedPrompt;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showPromptStatus('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼', 'success');
            });
        }

        // å°å‡º Word
        async function exportPromptToWord() {
            if (!currentGeneratedPrompt) {
                showPromptStatus('æ²’æœ‰å¯å°å‡ºçš„å…§å®¹', 'error');
                return;
            }

            try {
                const response = await fetch('/api/export-prompt-word', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        prompt: currentGeneratedPrompt,
                        mode: currentPromptMode,
                        timestamp: new Date().toISOString()
                    })
                });

                const data = await response.json();

                if (!response.ok) {
                    throw new Error(data.message || 'å°å‡ºå¤±æ•—');
                }

                // ä¸‹è¼‰æ–‡ä»¶
                window.location.href = data.downloadUrl;
                showPromptStatus('âœ… Word æ–‡æª”å·²ç”Ÿæˆï¼Œæ­£åœ¨ä¸‹è¼‰...', 'success');

            } catch (error) {
                console.error('Word export error:', error);
                showPromptStatus(`âŒ å°å‡ºéŒ¯èª¤: ${error.message}`, 'error');
            }
        }
    </script>
    
    <!-- å¼•å…¥å¤šèªè¨€ç¿»è­¯ç³»çµ± -->
    <script src="/js/translations.js"></script>
    <script>
        // åˆå§‹åŒ–æ™‚æ‡‰ç”¨èªè¨€è¨­å®š
        document.addEventListener('DOMContentLoaded', function() {
            updatePageLanguage();
        });
    </script>
</body>
</html>